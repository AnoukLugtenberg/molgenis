var BAM_MAGIC=21840194,BAI_MAGIC=21578050;function BamFile(){}function Vob(a,b){this.block=a;this.offset=b}Vob.prototype.toString=function(){return""+this.block+":"+this.offset};function Chunk(a,b){this.minv=a;this.maxv=b}
function makeBam(a,b,c){var d=new BamFile;d.data=a;d.bai=b;d.bai.fetch(function(a){if(!a)return dlog("Couldn't access BAI");var b=new Uint8Array(a);if(readInt(b,0)!=BAI_MAGIC)return dlog("Not a BAI file");var l=readInt(b,4);d.indices=[];for(var m=8,p=1E9,q=0;q<l;++q){for(var r=m,t=readInt(b,m),m=m+4,s=0;s<t;++s){readInt(b,m);var v=readInt(b,m+4),m=m+(8+16*v)}for(var s=readInt(b,m),u=m+=4,z=0;z<s;++z)if(v=readVob(b,u),u+=8,v){u=v.block;0<v.offset&&(u+=65536);u<p&&(p=u);break}m+=8*s;0<t&&(d.indices[q]=
new Uint8Array(a,r,m-r))}d.data.slice(0,p).fetch(function(a){if(!a)return dlog("Couldn't access BAM");a=unbgzf(a,a.byteLength);a=new Uint8Array(a);readInt(a,0);for(var b=readInt(a,4),e="",m=0;m<b;++m)e+=String.fromCharCode(a[m+8]);e=readInt(a,b+8);b+=12;d.chrToIndex={};d.indexToChr=[];for(m=0;m<e;++m){for(var h=readInt(a,b),l="",p=0;p<h-1;++p)l+=String.fromCharCode(a[b+4+p]);readInt(a,b+h+4);d.chrToIndex[l]=m;0==l.indexOf("chr")?d.chrToIndex[l.substring(3)]=m:d.chrToIndex["chr"+l]=m;d.indexToChr.push(l);
b=b+8+h}if(d.indices)return c(d)})})}
BamFile.prototype.blocksForRange=function(a,b,c){var d=this.indices[a];if(!d)return[];a=reg2bins(b,c);for(var e=[],h=0;h<a.length;++h)e[a[h]]=!0;a=[];for(var l=[],h=readInt(d,0),m=4,p=0;p<h;++p){var q=readInt(d,m),r=readInt(d,m+4),m=m+8;if(e[q])for(var t=0;t<r;++t){var s=readVob(d,m),v=readVob(d,m+8);(4681>q?l:a).push(new Chunk(s,v));m+=16}else m+=16*r}h=readInt(d,m);e=null;b=Math.min(b>>14,h-1);c=Math.min(c>>14,h-1);for(h=b;h<=c;++h)(b=readVob(d,m+4+8*h))&&(!e||b.block<e.block||b.offset<e.offset)&&
(e=b);d=[];if(null!=e)for(h=0;h<l.length;++h)c=l[h],c.maxv.block>=e.block&&c.maxv.offset>=e.offset&&d.push(c);l=d;d=[];for(h=0;h<l.length;++h)d.push(l[h]);for(h=0;h<a.length;++h)d.push(a[h]);d.sort(function(a,b){var c=a.minv.block-b.minv.block;return 0!=c?c:a.minv.offset-b.minv.offset});a=[];if(0<d.length){l=d[0];for(h=1;h<d.length;++h)c=d[h],c.minv.block==l.maxv.block?l=new Chunk(l.minv,c.maxv):(a.push(l),l=c);a.push(l)}return a};
BamFile.prototype.fetch=function(a,b,c,d){function e(){if(q>=m.length)return d(p);if(r){var a=new Uint8Array(r);h.readBamRecords(a,m[q].minv.offset,p,b,c,l);r=null;++q;return e()}var s=m[q],a=s.minv.block;h.data.slice(a,s.maxv.block+65536-a).fetch(function(a){r=unbgzf(a,s.maxv.block-s.minv.block+1);return e()})}var h=this,l=this.chrToIndex[a],m;void 0===l?m=[]:(m=this.blocksForRange(l,b,c))||d(null,"Error in index fetch");var p=[],q=0,r;e()};
var SEQRET_DECODER="=ACxGxxxTxxxxxxN".split(""),CIGAR_DECODER="MIDNSHP=X???????".split("");function BamRecord(){}
BamFile.prototype.readBamRecords=function(a,b,c,d,e,h){for(;;){var l=readInt(a,b),l=b+l+4;if(l>=a.length)return c;var m=new BamRecord,p=readInt(a,b+4),q=readInt(a,b+8),r=readInt(a,b+12),t=(r&65280)>>8,s=r&255,r=readInt(a,b+16),v=(r&4294901760)>>16,u=r&65535,r=readInt(a,b+20);readInt(a,b+24);readInt(a,b+28);readInt(a,b+32);for(var z="",w=0;w<s-1;++w)z+=String.fromCharCode(a[b+36+w]);b=b+36+s;w="";for(s=0;s<u;++s){var x=readInt(a,b),w=w+(x>>4)+CIGAR_DECODER[x&15];b+=4}m.cigar=w;u="";s=r+1>>1;for(w=
0;w<s;++w)x=a[b+w],u+=SEQRET_DECODER[(x&240)>>4],u+=SEQRET_DECODER[x&15];b+=s;m.seq=u;u="";for(w=0;w<r;++w)u+=String.fromCharCode(a[b+w]+33);b+=r;m.quals=u;m.pos=q;m.mq=t;m.readName=z;m.segment=this.indexToChr[p];for(m.flag=v;b<l;){q=String.fromCharCode(a[b])+String.fromCharCode(a[b+1]);t=String.fromCharCode(a[b+2]);if("A"==t)t=String.fromCharCode(a[b+3]),b+=4;else if("i"==t||"I"==t)t=readInt(a,b+3),b+=7;else if("c"==t||"C"==t)t=a[b+3],b+=4;else if("s"==t||"S"==t)t=readShort(a,b+3),b+=5;else{if("f"==
t)throw"FIXME need floats";if("Z"==t||"H"==t)for(b+=3,t="";v=a[b++],0!=v;)t+=String.fromCharCode(v);else if("B"==t){t=String.fromCharCode(a[b+3]);v=readInt(a,b+4);if("i"==t||"I"==t||"f"==t)z=4,w="f"==t?readFloat:readInt;else if("s"==t||"S"==t)z=2,w=readShort;else if("c"==t||"C"==t)z=1,w=readByte;else throw"Unknown array type "+t;b+=8;t=[];for(u=0;u<v;++u)t.push(w(a,b)),b+=z}else throw"Unknown type "+t;}m[q]=t}if(!d||m.pos<=e&&m.pos+r>=d)void 0!==h&&p!=h||c.push(m);b=l}};
(function(){var a=new ArrayBuffer(8),b=new Uint8Array(a),c=new Float32Array(a);window.readFloat=function(a,e){b[0]=a[e];b[1]=a[e+1];b[2]=a[e+2];b[3]=a[e+3];return c[0]}})();function readInt64(a,b){return a[b+7]<<24|a[b+6]<<16|a[b+5]<<8|a[b+4]}function readInt(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function readShort(a,b){return a[b+1]<<8|a[b]}function readByte(a,b){return a[b]}
function readVob(a,b){var c=4294967296*(a[b+6]&255)+16777216*(a[b+5]&255)+65536*(a[b+4]&255)+256*(a[b+3]&255)+(a[b+2]&255),d=a[b+1]<<8|a[b];return 0==c&&0==d?null:new Vob(c,d)}
function unbgzf(a,b){b=Math.min(b||1,a.byteLength-100);for(var c=[],d=[0],e=0;d[0]<b;){var h=new Uint8Array(a,d[0],100),h=h[11]<<8|h[10],h=jszlib_inflate_buffer(a,12+h+d[0],Math.min(65536,a.byteLength-12-h-d[0]),d);d[0]+=8;e+=h.byteLength;c.push(h)}if(1==c.length)return c[0];d=new Uint8Array(e);for(h=e=0;h<c.length;++h){var l=new Uint8Array(c[h]);arrayCopy(l,0,d,e,l.length);e+=l.length}return d.buffer}
function reg2bin(a,b){--b;return a>>14==b>>14?4681+(a>>14):a>>17==b>>17?585+(a>>17):a>>20==b>>20?73+(a>>20):a>>23==b>>23?9+(a>>23):a>>26==b>>26?1+(a>>26):0}var MAX_BIN=37449;function reg2bins(a,b){var c,d=[];--b;d.push(0);for(c=1+(a>>26);c<=1+(b>>26);++c)d.push(c);for(c=9+(a>>23);c<=9+(b>>23);++c)d.push(c);for(c=73+(a>>20);c<=73+(b>>20);++c)d.push(c);for(c=585+(a>>17);c<=585+(b>>17);++c)d.push(c);for(c=4681+(a>>14);c<=4681+(b>>14);++c)d.push(c);return d}
var BIG_WIG_MAGIC=-2003829722,BIG_BED_MAGIC=-2021002517,BIG_WIG_TYPE_GRAPH=1,BIG_WIG_TYPE_VSTEP=2,BIG_WIG_TYPE_FSTEP=3,M1=256,M2=65536,M3=16777216,M4=4294967296;function bwg_readOffset(a,b){return a[b]+a[b+1]*M1+a[b+2]*M2+a[b+3]*M3+a[b+4]*M4}function BigWig(){}
BigWig.prototype.readChromTree=function(a){var b=this;this.chromsToIDs={};this.idsToChroms={};this.maxID=0;var c=this.unzoomedDataOffset,c=c+4-(c-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,c-this.chromTreeOffset).fetch(function(c){var e=new Uint8Array(c),h=new Int16Array(c),l=(new Int32Array(c))[2];bwg_readOffset(e,16);var m=function(a){var c=e[a],d=h[a/2+1];a+=4;for(var t=0;t<d;++t)if(0==c){a+=l;var s=bwg_readOffset(e,a);a+=8;s-=b.chromTreeOffset;m(s)}else{for(var s="",v=0;v<l;++v){var u=
e[a++];0!=u&&(s+=String.fromCharCode(u))}v=e[a+3]<<24|e[a+2]<<16|e[a+1]<<8|e[a+0];a+=8;b.chromsToIDs[s]=v;0==s.indexOf("chr")&&(b.chromsToIDs[s.substr(3)]=v);b.idsToChroms[v]=s;b.maxID=Math.max(b.maxID,v)}};m(32);a(b)})};function BigWigView(a,b,c,d){this.bwg=a;this.cirTreeOffset=b;this.cirTreeLength=c;this.isSummary=d}BED_COLOR_REGEXP=/^[0-9]+,[0-9]+,[0-9]+/;BigWigView.prototype.readWigData=function(a,b,c,d){a=this.bwg.chromsToIDs[a];if(void 0===a)return d([]);this.readWigDataById(a,b,c,d)};
BigWigView.prototype.readWigDataById=function(a,b,c,d){var e=this;if(this.cirHeader){var h=[],l=0;Date.now();var m=function(d,e,m,h){return(0>a||d==a)&&e<=c&&m>=b},p=function(a,b){l+=a.length;for(var c=4+32*e.cirBlockSize,d,m=0;m<a.length;++m){var h=new Range(a[m],a[m]+c);d=d?union(d,h):h}c=d.ranges();for(d=0;d<c.length;++d)q(a,c[d],b)},q=function(q,t,s,v){t.max();t.min();e.bwg.data.slice(t.min(),t.max()-t.min()).fetch(function(u){for(var v=0;v<q.length;++v)if(t.contains(q[v])){var w=u,x=q[v]-t.min(),
A=s,B=new Uint8Array(w),F=new Int16Array(w),w=new Int32Array(w),D=B[x],F=F[x/2+1],x=x+4;if(0!=D)for(D=0;D<F;++D){var G=x/4,C=w[G],J=w[G+1],I=w[G+2],G=w[G+3],N=bwg_readOffset(B,x+16),A=bwg_readOffset(B,x+24);(0>a||C<a||C==a&&J<=c)&&(0>a||I>a||I==a&&G>=b)&&h.push({offset:N,size:A});x+=32}else{for(var L=[],D=0;D<F;++D)G=x/4,C=w[G],J=w[G+1],I=w[G+2],G=w[G+3],N=bwg_readOffset(B,x+16),(0>a||C<a||C==a&&J<=c)&&(0>a||I>a||I==a&&G>=b)&&L.push(N),x+=24;0<L.length&&p(L,A+1)}--l;0==l&&e.fetchFeatures(m,h,d)}})};
p([e.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(m){e.cirHeader=m;m=new Int32Array(e.cirHeader);e.cirBlockSize=m[1];e.readWigDataById(a,b,c,d)})};
BigWigView.prototype.fetchFeatures=function(a,b,c){var d=this;b.sort(function(a,b){return(a.offset|0)-(b.offset|0)});if(0==b.length)c([]);else{var e=[],h=function(a,b,c,h){h||(h={});var l=new DASFeature;l._chromId=a;l.segment=d.bwg.idsToChroms[a];l.min=b;l.max=c;l.type="bigwig";for(k in h)l[k]=h[k];e.push(l)},l=function(){if(0==b.length)Date.now(),c(e);else{var m=b[0];if(m.data)d.parseFeatures(m.data,h,a),b.splice(0,1),l();else{for(var p=m.offset,q=m.size,m=1;m<b.length&&b[m].offset==p+q;)q+=b[m].size,
++m;d.bwg.data.slice(p,q).fetch(function(a){for(var c=0,e=0;c<q;){var m=b[e],h;0<d.bwg.uncompressBufSize?h=jszlib_inflate_buffer(a,c+2,m.size-2):(h=new Uint8Array(m.size),arrayCopy(new Uint8Array(a,c,m.size),0,h,0,m.size),h=h.buffer);m.data=h;c+=m.size;++e}l()})}}};l()}};
BigWigView.prototype.parseFeatures=function(a,b,c){var d=new Uint8Array(a);if(this.isSummary)for(var e=new Int16Array(a),h=new Int32Array(a),l=new Float32Array(a),d=a.byteLength/32,e=0;e<d;++e){a=h[8*e];var m=h[8*e+1],p=h[8*e+2],q=h[8*e+3],r=l[8*e+5],t=l[8*e+6];c(a,m+1,p)&&(q={type:"bigwig",score:t/q,maxScore:r},"bigbed"==this.bwg.type&&(q.type="density"),b(a,m+1,p,q))}else if("bigwig"==this.bwg.type)if(e=new Int16Array(a),h=new Int32Array(a),l=new Float32Array(a),a=h[0],m=h[1],p=h[3],q=h[4],r=d[20],
d=e[11],r==BIG_WIG_TYPE_FSTEP)for(e=0;e<d;++e)r=l[e+6],h=m+e*p+1,t=m+e*p+q,c(a,h,t)&&b(a,h,t,{score:r});else if(r==BIG_WIG_TYPE_VSTEP)for(e=0;e<d;++e)m=h[2*e+6]+1,p=m+q-1,r=l[2*e+7],c(a,m,p)&&b(a,m,p,{score:r});else if(r==BIG_WIG_TYPE_GRAPH)for(e=0;e<d;++e)m=h[3*e+6]+1,p=h[3*e+7],r=l[3*e+8],m>p&&(m=p),c(a,m,p)&&b(a,m,p,{score:r});else console.log("Currently not handling bwgType="+r);else if("bigbed"==this.bwg.type)for(l=0,h=this.bwg.definedFieldCount,e=this.bwg.schema;l<d.length;){a=d[l+3]<<24|d[l+
2]<<16|d[l+1]<<8|d[l+0];m=d[l+7]<<24|d[l+6]<<16|d[l+5]<<8|d[l+4];p=d[l+11]<<24|d[l+10]<<16|d[l+9]<<8|d[l+8];l+=12;for(r="";;)if(q=d[l++],0!=q)r+=String.fromCharCode(q);else break;var q={},s;s=0<r.length?r.split("\t"):[];0<s.length&&3<h&&(q.label=s[0]);1<s.length&&4<h&&(q.score=stringToInt(s[1]));2<s.length&&5<h&&(q.orientation=s[2]);5<s.length&&8<h&&(r=s[5],BED_COLOR_REGEXP.test(r)&&(q.itemRgb="rgb("+r+")"));if(s.length>h-3&&e)for(r=h-3;r<s.length;++r)q[e.fields[r+3].name]=s[r];if(c(a,m+1,p,s))if(12>
h)b(a,m+1,p,q);else{var p=s[3]|0,r=s[4]|0,t=s[6]|0,v=s[7].split(","),u=s[8].split(",");q.type="bb-transcript";var z=new DASGroup;z.id=s[0];z.type="bb-transcript";z.notes=[];q.groups=[z];if(9<s.length){var w=z=s[9];10<s.length&&(w=s[10]);s=new DASGroup;s.id=z;s.label=w;s.type="gene";q.groups.push(s)}s=null;for(z=0;z<t;++z)w=(u[z]|0)+m,w=new Range(w,w+(v[z]|0)),s=s?union(s,w):w;v=s.ranges();for(m=0;m<v.length;++m)t=v[m],b(a,t.min()+1,t.max(),q);if(r>p&&(m=intersection(s,new Range(p,r))))for(q.type=
"bb-translation",p=m.ranges(),m=0;m<p.length;++m)t=p[m],b(a,t.min()+1,t.max(),q)}}else dlog("Don't know what to do with "+this.bwg.type)};BigWigView.prototype.getFirstAdjacent=function(a,b,c,d){a=this.bwg.chromsToIDs[a];if(void 0===a)return d([]);this.getFirstAdjacentById(a,b,c,d)};
BigWigView.prototype.getFirstAdjacentById=function(a,b,c,d){var e=this;if(this.cirHeader){var h=null,l=-1,m=-1,p=0;Date.now();var q=function(a,b){p+=a.length;for(var c=4+32*e.cirBlockSize,d,m=0;m<a.length;++m){var h=new Range(a[m],a[m]+c);d=d?union(d,h):h}c=d.ranges();for(d=0;d<c.length;++d)r(a,c[d],b)},r=function(m,l,q,r){l.max();l.min();e.bwg.data.slice(l.min(),l.max()-l.min()).fetch(function(r){for(var x=0;x<m.length;++x)l.contains(m[x])&&(t(r,m[x]-l.min(),q),--p,0==p&&e.fetchFeatures(function(d,
e,m,h){return 0>c&&(d<a||m<b)||0<c&&(d>a||e>b)},[h],function(a){for(var b=null,e=-1,m=-1,h=0;h<a.length;++h){var l=a[h],p=l._chromId,q=l.min,r=l.max;if(null==b||0>c&&(p>e||r>m)||0<c&&(p<e||q<m))b=l,m=0>c?r:q,e=p}return null!=b?d([b]):d([])}))})},t=function(d,p,r){var t=new Uint8Array(d),w=new Int16Array(d);d=new Int32Array(d);var x=t[p],w=w[p/2+1];p+=4;if(0!=x)for(x=0;x<w;++x){var A=p/4,B=d[A],F=d[A+1],D=d[A+2],G=d[A+3],A=bwg_readOffset(t,p+16);r=bwg_readOffset(t,p+24);(0>c&&(B<a||B==a&&F<=b)||0<
c&&(D>a||D==a&&G>=b))&&!/_random/.exec(e.bwg.idsToChroms[B])&&(null==h||0>c&&(D>l||D==l&&G>m)||0<c&&(B<l||B==l&&F<m))&&(h={offset:A,size:r},m=0>c?G:F,l=0>c?D:B);p+=32}else{for(var C=t=-1,x=0;x<w;++x){A=p/4;B=d[A];F=d[A+1];D=d[A+2];G=d[A+3];A=d[A+4]<<32|d[A+5];if(0>c&&(B<a||B==a&&F<=b)&&D>=a||0<c&&(D>a||D==a&&G>=b)&&B<=a)if(0>t||G>C)t=A,C=0>c?G:F;p+=24}0<=t&&q([t],r+1)}};q([e.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(b){e.cirHeader=b;b=new Int32Array(e.cirHeader);
e.cirBlockSize=b[1];e.readWigDataById(a,min,max,d)})};BigWig.prototype.readWigData=function(a,b,c,d){this.getUnzoomedView().readWigData(a,b,c,d)};BigWig.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new BigWigView(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};
BigWig.prototype.getZoomedView=function(a){a=this.zoomLevels[a];a.view||(a.view=new BigWigView(this,a.indexOffset,4E3,!0));return a.view};function makeBwgFromURL(a,b,c){makeBwg(new URLFetchable(a,{credentials:c}),b,a)}function makeBwgFromFile(a,b){makeBwg(new BlobFetchable(a),b,"file")}
function makeBwg(a,b,c){var d=new BigWig;d.data=a;d.name=c;d.data.slice(0,512).salted().fetch(function(a){if(!a)return b(null,"Couldn't fetch file");var c=new Uint8Array(a),l=new Int16Array(a);a=new Int32Array(a);a[0]==BIG_WIG_MAGIC?d.type="bigwig":a[0]==BIG_BED_MAGIC?d.type="bigbed":b(null,"Not a supported format");d.version=l[2];d.numZoomLevels=l[3];d.chromTreeOffset=bwg_readOffset(c,8);d.unzoomedDataOffset=bwg_readOffset(c,16);d.unzoomedIndexOffset=bwg_readOffset(c,24);d.fieldCount=l[16];d.definedFieldCount=
l[17];d.asOffset=bwg_readOffset(c,36);d.totalSummaryOffset=bwg_readOffset(c,44);d.uncompressBufSize=a[13];d.extHeaderOffset=bwg_readOffset(c,56);d.zoomLevels=[];for(l=0;l<d.numZoomLevels;++l){var m=a[6*l+16],p=bwg_readOffset(c,24*l+72),q=bwg_readOffset(c,24*l+80);d.zoomLevels.push({reduction:m,dataOffset:p,indexOffset:q})}d.readChromTree(function(){d.getAutoSQL(function(a){d.schema=a;return b(d)})})})}
BigWig.prototype._tsFetch=function(a,b,c,d,e){var h=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var l=[],m=this.topLevelReductionCache,p=0;p<m.length;++p)m[p]._chromId==b&&l.push(m[p]);return e(l)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(m){h.topLevelReductionCache=m;return h._tsFetch(a,b,c,d,e)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(b,c,d,e)};
BigWig.prototype.thresholdSearch=function(a,b,c,d,e){function h(){if(0==m.length)return e(null);m.sort(function(a,b){var d=a.zoom-b.zoom;if(0!=d)return d;d=a.chrOrd-b.chrOrd;return 0!=d?d:a.min-b.min*c});var a=m.splice(0,1)[0];l._tsFetch(a.zoom,a.chr,a.min,a.max,function(l){var p=0<c?0:3E8;a.fromRef&&(p=b);for(var q=0;q<l.length;++q){var u=l[q],z;z=void 0!=u.maxScore?u.maxScore:u.score;if(0<c){if(z>d)if(0>a.zoom){if(u.min>p)return e(u)}else u.max>p&&m.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,
min:u.min,max:u.max,fromRef:a.fromRef})}else if(z>d)if(0>a.zoom){if(u.max<p)return e(u)}else u.min<p&&m.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,min:u.min,max:u.max,fromRef:a.fromRef})}h()})}c=0>c?-1:1;var l=this;a=this.chromsToIDs[a];for(var m=[{chrOrd:0,chr:a,zoom:l.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],p=1;p<=this.maxID+1;++p){var q=(a+c*p)%(this.maxID+1);0>q&&(q+=this.maxID+1);m.push({chrOrd:p,chr:q,zoom:l.zoomLevels.length-1,min:0,max:3E8})}h()};
BigWig.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);this.data.slice(this.asOffset,2048).fetch(function(b){var c=new Uint8Array(b);b="";for(var d=0;d<c.length&&0!=c[d];++d)b+=String.fromCharCode(c[d]);var c=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,e=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(b);if(e){d={declType:e[1],name:e[2],comment:e[4],fields:[]};b=b.substring(e[0]);for(e=c.exec(b);null!=e;e=c.exec(b))d.fields.push({type:e[1],name:e[2],comment:e[4]});return a(d)}})};
BigWig.prototype.getExtraIndices=function(a){var b=this;if(4>this.version||0==this.extHeaderOffset||"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,64).fetch(function(c){if(!c)return a(null,"Couldn't fetch extension header");var d=new Uint8Array(c),e=new Int16Array(c);new Int32Array(c);var h=e[1];c=bwg_readOffset(d,4);if(0==h)return a(null);b.data.slice(c,20*h).fetch(function(c){if(!c)return a(null,"Couldn't fetch index info");var d=new Uint8Array(c),e=new Int16Array(c);new Int32Array(c);
c=[];for(var q=0;q<h;++q){var r=e[10*q],t=e[10*q+1],s=bwg_readOffset(d,20*q+4),r=new BBIExtraIndex(b,r,t,s,e[10*q+8]);c.push(r)}a(c)})})};function BBIExtraIndex(a,b,c,d,e){this.bbi=a;this.type=b;this.fieldCount=c;this.offset=d;this.field=e}
BBIExtraIndex.prototype.lookup=function(a,b){var c=this;this.bbi.data.slice(this.offset,32).fetch(function(d){function e(d){c.bbi.data.slice(d,4+l*(m+p)).fetch(function(d){var h=new Uint8Array(d),l=new Uint16Array(d);new Uint32Array(d);l=l[1];d=4;if(0==h[0]){for(var q=null,u=0;u<l;++u){for(var z="",w=0;w<m;++w){var x=h[d++];0!=x&&(z+=String.fromCharCode(x))}w=readInt(h,d);d+=8;if(0>a.localeCompare(z)&&q){e(q);return}q=w}e(q)}else{for(u=0;u<l;++u){z="";for(w=0;w<m;++w)x=h[d++],0!=x&&(z+=String.fromCharCode(x));
if(z==a)return l=readInt(h,d),h=readInt(h,d+8),c.bbi.getUnzoomedView().fetchFeatures(function(b,d,e,m){if(m&&m.length>c.field-3)return m[c.field-3]==a},[{offset:l,size:h}],b);d+=p}return b([])}})}var h=new Uint8Array(d);new Int16Array(d);d=new Int32Array(d);var l=d[1],m=d[2],p=d[3];bwg_readOffset(h,16);e(c.offset+32)})};function BlobFetchable(a){this.blob=a}
BlobFetchable.prototype.slice=function(a,b){var c;c=this.blob.slice?b?this.blob.slice(a,a+b):this.blob.slice(a):b?this.blob.webkitSlice(a,a+b):this.blob.webkitSlice(a);return new BlobFetchable(c)};BlobFetchable.prototype.salted=function(){return this};BlobFetchable.prototype.fetch=function(a){var b=new FileReader;b.onloadend=function(c){a(bstringToBuffer(b.result))};b.readAsBinaryString(this.blob)};
function URLFetchable(a,b,c,d){d||("object"===typeof b?(d=b,b=void 0):d={});this.url=a;this.start=b||0;c&&(this.end=c);this.opts=d}URLFetchable.prototype.slice=function(a,b){if(0>a)throw"Bad slice "+a;var c=this.start,d=this.end,c=c&&a?c+a:a||c;return new URLFetchable(this.url,c,b&&c?c+b-1:d||b-1,this.opts)};var seed=0,isSafari=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");
URLFetchable.prototype.fetchAsText=function(a){var b=new XMLHttpRequest,c=this.url;if(isSafari||this.opts.salt)c=saltURL(c),c=c+"?salt="+b64_sha1(""+Date.now()+","+ ++seed);b.open("GET",c,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";b.setRequestHeader("Range","bytes="+this.start+"-"+this.end)}b.onreadystatechange=function(){if(4==b.readyState)return 200==b.status||206==b.status?a(b.responseText):a(null)};this.opts.credentials&&(b.withCredentials=!0);b.send("")};
URLFetchable.prototype.salted=function(){var a=shallowCopy(this.opts);a.salt=!0;return new URLFetchable(this.url,this.start,this.end,a)};
URLFetchable.prototype.fetch=function(a,b,c){var d=this;b=b||1;if(3<b)return a(null);var e=new XMLHttpRequest,h,l=this.url;if(isSafari||this.opts.salt)l=l+"?salt="+b64_sha1(""+Date.now()+","+ ++seed);e.open("GET",l,!0);e.overrideMimeType("text/plain; charset=x-user-defined");if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";e.setRequestHeader("Range","bytes="+this.start+"-"+this.end);h=this.end-this.start+1}e.responseType="arraybuffer";e.onreadystatechange=function(){if(4==e.readyState){if(200==
e.status||206==e.status){if(e.response){var m=e.response.byteLength;return!h||h==m||c&&m==c?a(e.response):d.fetch(a,b+1,m)}if(e.mozResponseArrayBuffer)return a(e.mozResponseArrayBuffer);m=e.responseText;return!h||h==m.length||c&&m.length==c?a(bstringToBuffer(e.responseText)):d.fetch(a,b+1,m.length)}return d.fetch(a,b+1)}};this.opts.credentials&&(e.withCredentials=!0);e.send("")};
function bstringToBuffer(a){if(!a)return null;for(var b=new Uint8Array(a.length),c=0;c<b.length;++c)b[c]=a.charCodeAt(c);return b.buffer}var molgenisUrl=location.hostname;""!=location.port&&(molgenisUrl=molgenisUrl+":"+location.port);var NS_SVG="http://www.w3.org/2000/svg",NS_HTML="http://www.w3.org/1999/xhtml",NS_XLINK="http://www.w3.org/1999/xlink";function Region(a,b,c){this.min=b;this.max=c;this.chr=a}
function Browser(a){a||(a={});this.uiPrefix="http://www.biodalliance.org/release-0.11/";this.sources=[];this.tiers=[];this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.karyoEndpoint=new DASSource("http://www.derkholm.net:8080/das/hsa_54_36p/");this.registry="http://www.dasregistry.org/das/sources";this.coordSystem={speciesName:"Human",
taxon:9606,auth:"NCBI",version:"36",ucscName:"hg18"};this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=1;this.zoomMin=10;this.zoomMax;this.origin=0;this.targetQuantRes=5;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.placards=[];this.maxViewWidth=5E5;this.reverseScrolling=!1;this.rulerLocation="center";this.tierBackgroundColors=
["rgb(245,245,245)","white"];this.minTierHeight=30;this.availableSources=new Observed;this.defaultSources=[];this.mappableSources={};this.hubs=[];this.hubObjects=[];this.sourceCache=new SourceCache;this.retina=!0;for(var b in a)this[b]=a[b];var c=this;window.addEventListener("load",function(a){c.realInit()},!1)}
Browser.prototype.realInit=function(){this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(var a=0;a<this.sources.length;++a)this.defaultSources.push(this.sources[a]);this.restoreStatus&&this.restoreStatus();var b=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolder=makeElement("div",null,{tabIndex:-1},{outline:"none",display:"inline-block",width:"100%"});removeChildren(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);
this.svgHolder=makeElement("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.tierHolder=makeElement("div",null,{className:"tier-holder"});this.svgHolder.appendChild(this.tierHolder);this.bhtmlRoot=makeElement("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(makeElement("span",["Powered by ",makeElement("a","Dalliance",{href:"http://www.biodalliance.org/"})," "+VERSION],{className:"powered-by"}));this.browserHolder.appendChild(this.bhtmlRoot);window.addEventListener("resize",
function(a){b.resizeViewer()},!1);this.ruler=makeElement("div",null,{className:"guideline"});this.ruler2=makeElement("div",null,{className:"guideline"},{backgroundColor:"gray",opacity:"0.5",zIndex:899});this.svgHolder.appendChild(this.ruler);this.svgHolder.appendChild(this.ruler2);setTimeout(function(){b.realInit2()},1)};
Browser.prototype.realInit2=function(){var a=this;this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.tierHolder.addEventListener("mousewheel",function(b){b.wheelDeltaX&&(b.stopPropagation(),b.preventDefault(),b=b.wheelDeltaX/5,a.reverseScrolling||
(b=-b),a.move(b))},!1);this.tierHolder.addEventListener("MozMousePixelScroll",function(b){1==b.axis&&(b.stopPropagation(),b.preventDefault(),0!=b.detail&&(b=b.detail/4,a.reverseScrolling&&(b=-b),a.move(b)))},!1);var b=function(b){if(13==b.keyCode){var c=!1;for(b=0;b<a.tiers.length;++b){var d=a.tiers[b];d.wantedLayoutHeight&&d.wantedLayoutHeight!=d.layoutHeight&&(d.layoutHeight=d.wantedLayoutHeight,d.placard=null,d.clipTier(),c=!0)}c&&a.arrangeTiers()}else if(32==b.keyCode||32==b.charCode)a.isSnapZooming?
(a.isSnapZooming=!1,c=a.savedZoom||10):(a.isSnapZooming=!0,c=a.savedZoom||1),a.savedZoom=a.zoomSliderValue,a.zoomSliderValue=c,a.zoom(Math.exp(1*c/a.zoomExpt)),a.snapZoomLockout=!0,b.stopPropagation(),b.preventDefault();else if(39==b.keyCode)b.stopPropagation(),b.preventDefault(),a.scrollArrowKey(b,-1);else if(37==b.keyCode)b.stopPropagation(),b.preventDefault(),a.scrollArrowKey(b,1);else if(38==b.keyCode||87==b.keyCode)if(b.stopPropagation(),b.preventDefault(),b.shiftKey)b=a.getSelectedTier(),0>
b||(b=a.tiers[b],c=b.forceHeight||b.subtiers[0].height,40<=c&&b.mergeConfig({height:c-10}));else if(b.ctrlKey){if(b=a.getSelectedTier(),!(0>b)&&(b=a.tiers[b],b.quantLeapThreshold)){var d=b.subtiers[0].height,e=b.subtiers[0].quant;e&&(c=1*e.min,e=1*e.max,d=(e-c)/d,b.mergeConfig({quantLeapThreshold:c+((Math.round((b.quantLeapThreshold-c)/d)|0)+1)*d}),b.notify("Threshold: "+formatQuantLabel(b.quantLeapThreshold)))}}else if(b.altKey){if(e=a.selectedTiers.length,0!=e){b=a.selectedTiers[0];for(var h=!0,
c=[],d=0;d<a.selectedTiers.length;++d)c.push(a.tiers[a.selectedTiers[d]]),0<d&&1!=a.selectedTiers[d]-a.selectedTiers[d-1]&&(h=!1);if(!(h&&0>=b)){for(d=a.selectedTiers.length-1;0<=d;--d)a.tiers.splice(a.selectedTiers[d],1);a.selectedTiers.splice(0,e);b=h?b-1:b;for(d=0;d<c.length;++d)a.tiers.splice(b+d,0,c[d]),a.selectedTiers.push(b+d);a.markSelectedTiers();a.notifyTierSelection();a.reorderTiers();a.notifyTier()}}}else b=a.getSelectedTier(),0<b?(a.setSelectedTier(b-1),b=a.tiers[a.getSelectedTier()],
c=b.holder.getBoundingClientRect(),(0>c.bottom-c.height||c.botton>window.innerHeight)&&b.holder.scrollIntoView(!0)):a.notifyTierSelectionWrap(-1);else if(40==b.keyCode||83==b.keyCode)if(b.stopPropagation(),b.preventDefault(),b.shiftKey)b=a.getSelectedTier(),0>b||(b=a.tiers[b],c=b.forceHeight||b.subtiers[0].height,b.mergeConfig({height:c+10}));else if(b.ctrlKey){if(b=a.getSelectedTier(),!(0>b)&&(b=a.tiers[b],b.quantLeapThreshold&&(d=b.subtiers[0].height,e=b.subtiers[0].quant)))c=1*e.min,e=1*e.max,
d=(e-c)/d,e=Math.round((b.quantLeapThreshold-c)/d)|0,1<e&&(b.mergeConfig({quantLeapThreshold:c+(e-1)*d}),b.notify("Threshold: "+formatQuantLabel(b.quantLeapThreshold)))}else if(b.altKey){if(e=a.selectedTiers.length,0!=e){b=a.selectedTiers[0];for(var l=0,c=[],d=0;d<a.selectedTiers.length;++d)c.push(a.tiers[a.selectedTiers[d]]),0<d&&(l+=a.selectedTiers[d]-a.selectedTiers[d-1]-1);h=0==l;if(!(h&&b+e>=a.tiers.length)){for(d=a.selectedTiers.length-1;0<=d;--d)a.tiers.splice(a.selectedTiers[d],1);a.selectedTiers.splice(0,
e);b=h?b+1:b+l;for(d=0;d<c.length;++d)a.tiers.splice(b+d,0,c[d]),a.selectedTiers.push(b+d);a.markSelectedTiers();a.notifyTierSelection();a.reorderTiers();a.notifyTier()}}}else b=a.getSelectedTier(),b<a.tiers.length-1&&(a.setSelectedTier(b+1),b=a.tiers[a.getSelectedTier()],c=b.holder.getBoundingClientRect(),(0>c.bottom-c.height||c.bottom>window.innerHeight)&&b.holder.scrollIntoView(c.height>window.innerHeight));else if(187==b.keyCode||61==b.keyCode)b.stopPropagation(),b.preventDefault(),a.zoomStep(-10);
else if(189==b.keyCode||173==b.keyCode)b.stopPropagation(),b.preventDefault(),a.zoomStep(10);else if(73==b.keyCode||105==b.keyCode)b.stopPropagation(),b.preventDefault(),b=a.getSelectedTier(),0>b||(d=a.tiers[b],d.infoVisible?(d.infoElement.style.display="none",d.updateHeight(),d.infoVisible=!1):(d.infoElement.style.display="block",d.updateHeight(),d.infoVisible=!0));else if(84==b.keyCode||116==b.keyCode)if(b.shiftKey)for(b.stopPropagation(),b.preventDefault(),b=0;b<a.tiers.length;++b)d=a.tiers[b],
d.dasSource.collapseSuperGroups&&(void 0===c&&(c=!d.bumped),d.bumped=c,d.layoutWasDone=!1,d.draw(),d.updateLabel());else b.ctrlKey||b.metaKey||(b.stopPropagation(),b.preventDefault(),b=a.getSelectedTier(),0>b||(d=a.tiers[b],d.dasSource.collapseSuperGroups&&(void 0===c&&(c=!d.bumped),d.bumped=c,d.layoutWasDone=!1,d.draw(),d.updateLabel())));else if(77==b.keyCode||109==b.keyCode)b.stopPropagation(),b.preventDefault(),1<a.selectedTiers.length&&a.mergeSelectedTiers()};this.browserHolder.addEventListener("focus",
function(c){a.browserHolder.addEventListener("keydown",b,!1)},!1);this.browserHolder.addEventListener("blur",function(c){a.browserHolder.removeEventListener("keydown",b,!1)},!1);this.hPopupHolder=makeElement("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var c=[],d=0;d<this.sources.length;++d){var e=this.sources[d],h={};this.restoredConfigs&&(h=this.restoredConfigs[d]);
e.disabled||(c.push(e),this.makeTier(e,h))}this.sources=c;a.arrangeTiers();a.refresh();a.setSelectedTier(1);a.positionRuler();for(c=0;c<this.tiers.length;++c)if(d=this.tiers[c],d.sequenceSource){d.sequenceSource.getSeqInfo(this.chr,function(b){b&&(a.currentSeqMax=b.length)});break}this.queryRegistry();for(var l in this.chains)this.queryRegistry(l,!0);if(this.hubs)for(d=0;d<this.hubs.length;++d)l=this.hubs[d],"string"==typeof l&&(l={url:l}),function(b){connectTrackHub(b.url,function(c,d){if(d)console.log(d);
else{var e;if(e=b.genome?c.genomes[b.genome]:c.genomes[a.coordSystem.ucscName])b.mapping&&(e.mapping=b.mapping),a.hubObjects.push(e)}},b)}(l)};Browser.prototype.touchStartHandler=function(a){a.stopPropagation();a.preventDefault();this.touchOriginX=a.touches[0].pageX;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};
Browser.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var b=a.touches[0].pageX;this.touchOriginX&&b!=this.touchOriginX&&this.move(b-this.touchOriginX);this.touchOriginX=b}else if(this.zooming&&2==a.touches.length){b=Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(b!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/2;var c=this.viewStart+a/this.scale|0;this.scale=this.zoomInitialScale*(b/this.zoomInitialSep);this.viewStart=c-a/this.scale|
0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=b}};Browser.prototype.touchEndHandler=function(a){a.stopPropagation();a.preventDefault()};Browser.prototype.touchCancelHandler=function(a){};Browser.prototype.makeTier=function(a,b){try{this.realMakeTier(a,b)}catch(c){console.log(c.stack)}};
Browser.prototype.realMakeTier=function(a,b){var c=this,d=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length],e=makeElement("canvas",null,{width:""+((this.featurePanelWidth|0)+2E3),height:"30",className:"viewport"}),h=makeElement("canvas",null,{width:+((this.featurePanelWidth|0)+2E3),height:"30",className:"viewport-overlay"}),l=makeElement("span",""),m=makeElement("div",[makeElement("i",null,{className:"fa fa-warning"})," ",l],{className:"placard"},{display:"none"}),p=makeElement("div",
"Exciting message",{},{backgroundColor:"black",color:"white",zIndex:5E3,position:"relative",top:"-25px",opacity:0,padding:"6px",borderRadius:"4px",display:"inline-block",transition:"opacity 0.6s ease-in-out",pointerEvents:"none"}),q=makeElement("div",[e,h],{className:"view-holder"});q.style.background=d;q.addEventListener("touchstart",function(a){return c.touchStartHandler(a)},!1);q.addEventListener("touchmove",function(a){return c.touchMoveHandler(a)},!1);q.addEventListener("touchend",function(a){return c.touchEndHandler(a)},
!1);q.addEventListener("touchcancel",function(a){return c.touchCancelHandler(a)},!1);var r=new DasTier(this,a,e,q,h,m,l,p,b);r.oorigin=this.viewStart;r.background=d;r.quantOverlay=makeElement("canvas",null,{width:"50",height:"56",className:"quant-overlay"});r.holder.appendChild(r.quantOverlay);var t=!1,s,v,u,z=function(a,b){var d=r.subtiers;if(d){var e=0;for(b-=MIN_PADDING;e<d.length&&b>d[e].height&&e<d.length-1;)b=b-d[e].height-MIN_PADDING,++e;if(!(e>=d.length))return d=d[e].glyphs,a-=(r.glyphCacheOrigin-
c.viewStart)*c.scale,glyphLookup(d,a,b)}},w=function(a){a.preventDefault();a.stopPropagation();a=a.clientX;"sequence"!==r.dasSource.tier_type&&a!=v&&(c.move(a-v),v=a);c.isDragging=!0},x=function(a){window.removeEventListener("mousemove",w,!0);window.removeEventListener("mouseup",x,!0)};q.addEventListener("mousedown",function(a){c.browserHolder.focus();a.preventDefault();q.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",w,!0);window.addEventListener("mouseup",x,!0);s=v=a;c.isDragging=
!1},!1);q.addEventListener("mousemove",function(a){var b=q.getBoundingClientRect(),d=a.clientX-b.left,e=a.clientY-b.top;u&&clearTimeout(u);t||(u=setTimeout(function(){var b=z(d,e);b&&0<b.length&&c.notifyFeatureHover(a,b[b.length-1],b,r)},1E3))});var A=null;q.addEventListener("mouseup",function(a){var b=q.getBoundingClientRect(),d=a.clientX-b.left,b=a.clientY-b.top,e=z(d,b);e&&0<e.length&&!c.isDragging&&(A?(clearTimeout(A),A=null,c.featureDoubleClick(e,d,b)):A=setTimeout(function(){A=null;c.notifyFeature(a,
e[e.length-1],e,r)},500));if(c.isDragging&&d!=s&&"sequence"===r.dasSource.tier_type){var b=c.viewStart+d/c.scale,h=c.viewStart+s/c.scale;b<h?(d=b|0,b=h|0):(d=h|0,b|=0);c.notifyRegionSelect(c.chr,d,b)}c.isDragging=!1},!1);q.addEventListener("mouseout",function(a){t=!1});r.removeButton=makeElement("i",null,{className:"fa fa-times"});r.bumpButton=makeElement("i",null,{className:"fa fa-plus-circle"});r.loaderButton=makeElement("img",null,{src:this.uiPrefix+"img/loader.gif"},{display:"none"});r.infoElement=
makeElement("div",r.dasSource.desc,{},{display:"none",maxWidth:"200px",whiteSpace:"normal",color:"rgb(100,100,100)"});r.nameButton=makeElement("div",[],{className:"tier-tab"});r.nameButton.appendChild(r.removeButton);a.pennant&&r.nameButton.appendChild(makeElement("img",null,{src:a.pennant,width:"16",height:"16"}));r.nameElement=makeElement("span",a.name);r.nameButton.appendChild(makeElement("span",[r.nameElement,r.infoElement],{},{display:"inline-block",marginLeft:"5px",marginRight:"5px"}));r.nameButton.appendChild(r.bumpButton);
r.nameButton.appendChild(r.loaderButton);r.label=makeElement("span",[r.nameButton],{className:"btn-group"},{zIndex:1001,position:"absolute",left:"2px",top:"2px",opacity:0.8,display:"inline-block"});d=makeElement("div",[q,m,r.label,p],{},{position:"relative",display:"block",textAlign:"center"});r.row=d;r.removeButton.addEventListener("click",function(b){b.stopPropagation();b.preventDefault();c.removeTier(a)},!1);r.nameButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();
if(a.shiftKey){a=-1;for(var b=0;b<c.tiers.length;++b)if(c.tiers[b]===r){a=b;break}0<=a&&(b=c.selectedTiers.indexOf(a),0<=b?c.selectedTiers.splice(b,1):(c.selectedTiers.push(a),c.selectedTiers.sort()),c.markSelectedTiers(),c.notifyTierSelection(),0<c.selectedTiers.length?c.browserHolder.focus():c.notifyTierSelectionWrap(-1))}else{for(b=0;b<c.tiers.length;++b)if(c.tiers[b]===r&&(c.browserHolder.focus(),1!=c.selectedTiers.length||c.selectedTiers[0]!=b)){c.setSelectedTier(b);return}r.infoVisible?(r.infoElement.style.display=
"none",r.updateHeight(),r.infoVisible=!1):(r.infoElement.style.display="block",r.updateHeight(),r.infoVisible=!0)}},!1);r.bumpButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();var b;r.dasSource.collapseSuperGroups&&(void 0===b&&(b=!r.bumped),r.bumped=b,r.layoutWasDone=!1,r.draw(),r.updateLabel())},!1);var B,F,D,G=!1,C=function(a){var b=r.label;a.stopPropagation();a.preventDefault();if(!B){B=b.cloneNode(!0);B.style.cursor="pointer";c.svgHolder.appendChild(B);b.style.visibility=
"hidden";for(var d=0;d<c.tiers.length;++d)if(c.tiers[d]===r){F=d;break}D=a.clientY}d=c.svgHolder.getBoundingClientRect();B.style.left=b.getBoundingClientRect().left-d.left+"px";B.style.top=a.clientY-d.top-10+"px";b=a.clientY-c.tierHolder.getBoundingClientRect().top;for(d=0;d<c.tiers.length;++d){var e=c.tiers[d].row.getBoundingClientRect(),b=b-(e.bottom-e.top);if(0>b){if(d<F&&a.clientY<D||d>F&&a.clientY>D){b=[];for(e=0;e<c.selectedTiers.length;++e)b.push(c.tiers[c.selectedTiers[e]]);c.tiers.splice(F,
1);c.tiers.splice(d,0,r);c.selectedTiers=[];for(e=0;e<c.tiers.length;++e)0<=b.indexOf(c.tiers[e])&&c.selectedTiers.push(e);F=d;D=a.clientY;c.reorderTiers();G=!0}break}}a=B.getBoundingClientRect();0>a.bottom-a.height?B.scrollIntoView(!0):a.bottom>window.innerHeight&&B.scrollIntoView(!1)},J=function(a){var b=r.label;a.stopPropagation();a.preventDefault();B&&(B.style.cursor="auto",c.svgHolder.removeChild(B),B=null,b.style.visibility=null);document.removeEventListener("mousemove",C,!1);document.removeEventListener("mouseup",
J,!1);if(G){for(a=0;a<c.tiers.length;++a)if(c.tiers[a]==r){c.setSelectedTier(a);break}c.notifyTier()}};r.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();G=!1;document.addEventListener("mousemove",C,!1);document.addEventListener("mouseup",J,!1)},!1);this.tierHolder.appendChild(d);this.tiers.push(r);r.init();r.currentlyHeight=50;this.updateHeight();r.updateLabel();r.featureSource&&r.featureSource.addActivityListener&&r.featureSource.addActivityListener(function(a){r.loaderButton.style.display=
0<a?"inline-block":"none"});r._updateFromConfig()};Browser.prototype.reorderTiers=function(){removeChildren(this.tierHolder);for(var a=0;a<this.tiers.length;++a)this.tierHolder.appendChild(this.tiers[a].row);this.tierHolder.appendChild(this.ruler);this.tierHolder.appendChild(this.ruler2);this.arrangeTiers()};Browser.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};
Browser.prototype.arrangeTiers=function(){for(var a=0;a<this.tiers.length;++a){var b=this.tiers[a];b.background=this.tierBackgroundColors[a%this.tierBackgroundColors.length];b.holder.style.background=b.background}};
Browser.prototype.refresh=function(){this.notifyLocation();var a=100/this.scale|0,b=1E3/this.scale|0,c=(this.viewStart+this.viewEnd)/2,d=c-this.origin;this.origin=c;this.scaleAtLastRedraw=this.scale;for(c=0;c<this.tiers.length;++c){var e=d;this.tiers[c].originHaxx&&(e+=this.tiers[c].originHaxx);this.tiers[c].originHaxx=e}d=this.targetQuantRes/this.scale;c=Math.max(1,(this.viewStart|0)-a);a=Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);e=Math.max(1,(this.viewStart|
0)-b);b=Math.min((this.viewEnd|0)+b,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){for(var h=null,l=0;l<this.tiers.length;++l)if(this.tiers[l].sequenceSource){h=this.tiers[l].sequenceSource;break}this.knownSpace=new KnownSpace(this.tiers,this.chr,e,b,d,h)}(h=this.knownSpace.bestCacheOverlapping(this.chr,c,a))&&h.min<=c&&h.max>=a?(this.drawnStart=Math.max(h.min,e),this.drawnEnd=Math.min(h.max,b)):(this.drawnStart=e,this.drawnEnd=b);this.knownSpace.viewFeatures(this.chr,
this.drawnStart,this.drawnEnd,d);this.drawOverlays()};function setSources(a,b,c){if(c)for(var d=0;d<b.length;++d)b[d].mapping=c;a.set(b)}
Browser.prototype.queryRegistry=function(a,b){var c,d;a?(c=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=new Observed),d=this.mappableSources[a]):(c=this.coordSystem,d=this.availableSources);var e=hex_sha1(miniJSONify(c));if(b){var h=localStorage["dalliance.registry."+e+".last_queried"];if(h)try{if(setSources(d,JSON.parse(localStorage["dalliance.registry."+e+".sources"]),a),432E5>(Date.now()|0)-(h|0))return}catch(l){console.log("Bad registry cache: "+l)}}(new DASRegistry(this.registry)).sources(function(b){for(var h=
[],l=0;l<b.length;++l){var r=b[l];if(r.coords&&0!=r.coords.length){var t=r.coords[0];t.taxon==c.taxon&&t.auth==c.auth&&t.version==c.version&&h.push(r)}}localStorage["dalliance.registry."+e+".sources"]=JSON.stringify(h);localStorage["dalliance.registry."+e+".last_queried"]=""+Date.now();setSources(d,h,a)},function(a){},c)};
Browser.prototype.move=function(a){var b=this.viewEnd-this.viewStart;this.viewStart-=a/this.scale;this.viewEnd=this.viewStart+b;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-b);1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+b);this.notifyLocation();for(a=0;a<this.tiers.length;++a)this.tiers[a].viewport.style.left=""+((-((this.viewStart-this.tiers[a].norigin)*this.scale)|0)-1E3)+"px",this.tiers[a].overlay.style.left=
""+((-((this.viewStart-this.tiers[a].oorigin)*this.scale)|0)-1E3)+"px";this.spaceCheck()};Browser.prototype.zoomStep=function(a){var b=1*this.zoomSliderValue;a=b+a;a<this.zoomMin&&(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=b&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};
Browser.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-
this.viewStart);this.refresh()};Browser.prototype.spaceCheck=function(a){this.knownSpace&&this.knownSpace.chr===this.chr?(a=100/this.scale|0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};
Browser.prototype.resizeViewer=function(a){var b=this.tierHolder.getBoundingClientRect().width|0,c=this.featurePanelWidth;this.featurePanelWidth=b|0;c!=this.featurePanelWidth&&(this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/c,b=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-b+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+b-1),this.positionRuler(),
a||this.spaceCheck(),this.notifyLocation())};Browser.prototype.addTier=function(a){a=new DASSource(a);a.disabled=!1;this.makeTier(a);this.markSelectedTiers();this.positionRuler();this.notifyTier()};function sourceDataURI(a){return a.uri?a.uri:a.bwgBlob?"file:"+a.bwgBlob.name:a.bamBlob?"file:"+a.bamBlob.name:a.bwgURI||a.bamURI||a.jbURI||a.twoBitURI||"http://www.biodalliance.org/magic/no_uri"}
function sourceStyleURI(a){return a.stylesheet_uri?a.stylesheet_uri:"sequence"==a.tier_type?"http://www.biodalliance.org/magic/sequence":sourceDataURI(a)}function sourcesAreEqual(a,b){if(sourceDataURI(a)!=sourceDataURI(b)||sourceStyleURI(a)!=sourceStyleURI(b)||a.mapping!=b.mapping)return!1;if(a.overlay){if(!b.overlay||b.overlay.length!=a.overlay.length)return!1;for(var c=0;c<a.overlay.length;++c)if(!sourcesAreEqual(a.overlay[c],b.overlay[c]))return!1}else if(b.overlay)return!1;return!0}
Browser.prototype.removeTier=function(a,b){var c=-1;if("undefined"!==typeof a.index&&0<=a.index&&a.index<this.tiers.length)c=a.index;else for(var d=0;d<this.tiers.length;++d)if(sourcesAreEqual(a,this.tiers[d].dasSource)){c=d;break}if(0>c)throw"Couldn't find requested tier";d=this.tiers[c];if(d.sequenceSource&&!b)throw"Can't remove sequence source tier";this.tierHolder.removeChild(d.row);this.tiers.splice(c,1);for(var d=[],e=0;e<this.selectedTiers.length;++e){var h=this.selectedTiers[e];h<c?d.push(h):
h>c&&d.push(h-1)}this.selectedTiers=d;this.markSelectedTiers();this.arrangeTiers();this.notifyTier()};
Browser.prototype.setLocation=function(a,b,c,d){d||(d=function(a){if(a)throw a;});var e=this;if(a&&a!=this.chr){for(var h,l=0;l<this.tiers.length;++l)if(this.tiers[l].sequenceSource){h=this.tiers[l].sequenceSource;break}if(!h)return d("Need a sequence source");h.getSeqInfo(a,function(l){if(l)return e._setLocation(a,b,c,l,d);var p;p=0==a.indexOf("chr")?a.substr(3):"chr"+a;h.getSeqInfo(p,function(h){return h?e._setLocation(p,b,c,h,d):d("Couldn't find sequence '"+a+"'")})})}else return this._setLocation(null,
b,c,null,d)};
Browser.prototype._setLocation=function(a,b,c,d,e){a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr=a,this.currentSeqMax=d.length);b|=0;c|=0;a=Math.max(10,c-b+1);1>b&&(b=1,c=b+a-1);c>this.currentSeqMax&&(c=this.currentSeqMax,b=Math.max(1,c-a+1));this.viewStart=b;this.viewEnd=c;b=this.featurePanelWidth/(this.viewEnd-this.viewStart);c=1E-4<Math.abs(b-this.scale);this.scale=b;this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.isSnapZooming=!1;this.savedZoom=
null;this.notifyLocation();if(c)this.refresh();else for(b=0;b<this.tiers.length;++b)this.tiers[b].viewport.style.left=""+((-((this.viewStart-this.tiers[b].norigin)*this.scale)|0)-1E3)+"px",this.tiers[b].overlay.style.left=""+((-((this.viewStart-this.tiers[b].oorigin)*this.scale)|0)-1E3)+"px";this.spaceCheck();return e()};Browser.prototype.addFeatureListener=function(a,b){this.featureListeners.push(a)};
Browser.prototype.notifyFeature=function(a,b,c,d){for(var e=0;e<this.featureListeners.length;++e)try{if(this.featureListeners[e](a,b,c,d))break}catch(h){console.log(h.stack)}};Browser.prototype.addFeatureHoverListener=function(a,b){this.featureHoverListeners.push(a)};Browser.prototype.notifyFeatureHover=function(a,b,c,d){for(var e=0;e<this.featureHoverListeners.length;++e)try{this.featureHoverListeners[e](a,b,c,d)}catch(h){console.log(h.stack)}};Browser.prototype.addViewListener=function(a,b){this.viewListeners.push(a)};
Browser.prototype.notifyLocation=function(){for(var a=0;a<this.viewListeners.length;++a)try{this.viewListeners[a](this.chr,this.viewStart|0,this.viewEnd|0,this.zoomSliderValue,{current:this.zoomSliderValue,min:this.zoomMin,max:this.zoomMax})}catch(b){console.log(b.stack)}};Browser.prototype.addTierListener=function(a){this.tierListeners.push(a)};Browser.prototype.notifyTier=function(){for(var a=0;a<this.tierListeners.length;++a)try{this.tierListeners[a]()}catch(b){console.log(b.stack)}};
Browser.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};Browser.prototype.notifyRegionSelect=function(a,b,c){for(var d=0;d<this.regionSelectListeners.length;++d)try{this.regionSelectListeners[d](a,b,c)}catch(e){console.log(e.stack)}};Browser.prototype.highlightRegion=function(a,b,c){this.highlights.push(new Region(a,b,c));var d=this.viewStart-1E3/this.scale,e=this.viewEnd+1E3/this.scale;a==this.chr&&b<e&&c>d&&this.drawOverlays()};
Browser.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};Browser.prototype.featuresInRegion=function(a,b,c){var d=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var e=this.tiers[a].currentFeatures||[],h=0;h<e.length;++h){var l=e[h];l.min<=c&&l.max>=b&&d.push(l)}return d};Browser.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};
Browser.prototype.setSelectedTier=function(a){this.selectedTiers=null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};Browser.prototype.markSelectedTiers=function(){for(var a=0;a<this.tiers.length;++a){var b=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?b.classList.add("active"):b.classList.remove("active")}0<this.selectedTiers.length&&this.browserHolder.focus()};Browser.prototype.addTierSelectionListener=function(a){this.tierSelectionListeners.push(a)};
Browser.prototype.notifyTierSelection=function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(b){console.log(b.stack)}};Browser.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};Browser.prototype.notifyTierSelectionWrap=function(a){for(var b=0;b<this.tierSelectionWrapListeners.length;++b)try{this.tierSelectionWrapListeners[b](a)}catch(c){console.log(c.stack)}};
Browser.prototype.positionRuler=function(){var a="none",b="",c="";"center"==this.rulerLocation?(a="block",b=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",b="0px"):"right"==this.rulerLocation?(a="block",c="0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=b;this.ruler.style.right=c;this.ruler2.style.display="center"==this.rulerLocation?"none":"block";this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var d=0;d<this.tiers.length;++d){var e=this.tiers[d],
h=e.quantOverlay,l;e.subtiers&&0<e.subtiers.length&&(l=e.subtiers[0].quant);h&&(h.style.display=l?a:"none",h.style.left=b,h.style.right=c)}};Browser.prototype.featureDoubleClick=function(a,b,c){if(a&&0!=a.length&&(f=a[a.length-1],f.min&&f.max)){c=((f.min|0)-(this.viewStart|0))*this.scale;var d=(f.max-f.min+1)*this.scale;a=((f.min|0)+(f.max|0))/2;10<d&&(b=1*(b-c)/d,0.3>b?a=f.min|0:0.7<b&&(a=(f.max|0)+1));b=this.viewEnd-this.viewStart;this.setLocation(null,a-b/2,a+b/2)}};
Browser.prototype.updateHeight=function(){for(var a=0,b=0;b<this.tiers.length;++b)a+=this.tiers[b].currentHeight||30;this.svgHolder.style.maxHeight=""+Math.max(a,500)+"px"};Browser.prototype.scrollArrowKey=function(a,b){this.reverseKeyScrolling&&(b=-b);if(a.ctrlKey){var c=!1;a.shiftKey&&(c=!0);this.leap(-1*b,c)}else this.move(a.shiftKey?100*b:25*b)};
Browser.prototype.leap=function(a,b){var c=this,d=(c.viewStart+c.viewEnd+1)/2|0,e=c.getSelectedTier();0>e||c.tiers[e].findNextFeature(c.chr,d,a,b,function(e){if(e){var l=e.min,m=e.max;b&&(0<a?l>d+1?m=l:(m++,l=m):m<d-1?(m++,l=m):m=l);var p=c.viewEnd-c.viewStart+1;parseFloat(p/2)==parseInt(p/2)&&p--;l=(l+m-p)/2+1;c.setLocation(e.segment,l,l+p-1)}else alert("no next feature")})};
function glyphLookup(a,b,c,d){d=d||[];for(var e=a.length-1;0<=e;--e){var h=a[e];if(!h.notSelectable&&h.min()<=b&&h.max()>=b&&(!h.minY||!(c<h.minY()||c>h.maxY()))){h.feature?d.push(h.feature):h.group&&d.push(h.group);if(h.glyphs)return glyphLookup(h.glyphs,b,c,d);if(h.glyph)return glyphLookup([h.glyph],b,c,d);break}}return d}var TAGVAL_NOTE_RE=/^([A-Za-z]+)=(.+)/;Browser.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};
function FeatureInfo(a,b,c){var d=pick(c.type,b.type),e=pick(c.label,b.label,c.id,b.id);e&&0!=e.indexOf("__dazzle")&&(d=d+": "+e);this.hit=a;this.feature=b;this.group=c;this.title=d;this.sections=[]}FeatureInfo.prototype.setTitle=function(a){this.title=a};FeatureInfo.prototype.add=function(a,b){"string"===typeof b&&(b=makeElement("span",b));this.sections.push({label:a,info:b})};
Browser.prototype.featurePopup=function(a,b,c,d){b=c.length;var e=0<=--b?c[b]:{},h=0<=--b?c[b]:{};c=new FeatureInfo(c,e,h);c.tier=d;b=this.featureInfoPlugins||[];for(fipi=0;fipi<b.length;++fipi)try{b[fipi](e,c)}catch(l){console.log(l.stack||l)}b=d.featureInfoPlugins||[];for(fipi=0;fipi<b.length;++fipi)try{b[fipi](e,c)}catch(m){console.log(m.stack||m)}this.removeAllPopups();d=makeElement("table",null,{className:"table table-striped table-condensed"});d.style.width="100%";d.style.margin="0px";b=0;if(e.method){var p=
makeElement("tr",[makeElement("th","Method"),makeElement("td",e.method)]);d.appendChild(p);++b}p=h.segment?h:e;p=makeElement("tr",[makeElement("th","Location"),makeElement("td",p.segment+":"+p.min+"-"+p.max)]);p.style.backgroundColor=this.tierBackgroundColors[b%this.tierBackgroundColors.length];d.appendChild(p);++b;void 0!==e.score&&null!==e.score&&"-"!=e.score&&(p=makeElement("tr",[makeElement("th","Score"),makeElement("td",""+e.score)]),d.appendChild(p),++b);(p=maybeConcat(h.links,e.links))&&0<
p.length&&(p=makeElement("tr",[makeElement("th","Links"),makeElement("td",p.map(function(a){return makeElement("div",makeElement("a",a.desc,{href:a.uri,target:"_new"}))}))]),d.appendChild(p),++b);e=maybeConcat(h.notes,e.notes);for(h=0;h<e.length;++h){var p="Note",q=e[h],r=q.match(TAGVAL_NOTE_RE);r&&(p=r[1],q=r[2]);p=makeElement("tr",[makeElement("th",p),makeElement("td",q)]);d.appendChild(p);++b}for(b=0;b<c.sections.length;++b)e=c.sections[b],d.appendChild(makeElement("tr",[makeElement("th",e.label),
makeElement("td",e.info)]));this.popit(a,c.title,d,{width:400})};function Chainset(a,b,c,d){this.uri=a;this.srcTag=b;this.destTag=c;this.coords=d;this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={}}function parseCigar(a){for(var b=[],c=RegExp("([0-9]*)([MIDS])","g"),d;null!=(d=c.exec(a));){var e=d[1];0==e.length&&(e=1);b.push({cnt:e|0,op:d[2]})}return b}
Chainset.prototype.fetchChainsTo=function(a){var b=this;(new DASSource(this.uri)).alignments(a,{},function(c){b.chainsByDest[a]||(b.chainsByDest[a]=[]);for(var d=0;d<c.length;++d)for(var e=c[d],h=0;h<e.blocks.length;++h){for(var l=e.blocks[h],m,p,q=0;q<l.segments.length;++q){var r=l.segments[q],t=e.objects[r.object];t.dbSource===b.srcTag?m=r:t.dbSource===b.destTag&&(p=r)}if(m&&p){for(var l={srcChr:e.objects[m.object].accession,srcMin:m.min|0,srcMax:m.max|0,srcOri:m.strand,destChr:e.objects[p.object].accession,
destMin:p.min|0,destMax:p.max|0,destOri:p.strand,blocks:[]},q=parseCigar(m.cigar),r=parseCigar(p.cigar),s=t=0,v=0,u=0;v<q.length&&u<r.length;)if("M"==q[v].op&&"M"==r[u].op){var z=Math.min(q[v].cnt,r[u].cnt);l.blocks.push([t,s,z]);q[v].cnt==z?++v:q[v].cnt-=z;r[u].cnt==z?++u:r[u]-=z;t+=z;s+=z}else"I"==q[v].op?s+=q[v++].cnt:"I"==r[u].op&&(t+=r[u++].cnt);pusho(b.chainsBySrc,l.srcChr,l);pusho(b.chainsByDest,l.destChr,l)}}if(b.postFetchQueues[a]){c=b.postFetchQueues[a];for(d=0;d<c.length;++d)c[d]();b.postFetchQueues[a]=
null}})};Chainset.prototype.mapPoint=function(a,b){for(var c=this.chainsBySrc[a]||[],d=0;d<c.length;++d){var e=c[d];if(b>=e.srcMin&&b<=e.srcMax){var h;h="-"==e.srcOri?e.srcMax-b:b-e.srcMin;for(var l=e.blocks,m=0;m<l.length;++m){var p=l[m],q=p[0],r=p[1],p=p[2];if(h>=q&&h<=q+p)return c=h-q,{seq:e.destChr,pos:"-"==e.destOri?e.destMax-r-c:c+r+e.destMin,flipped:e.srcOri!=e.destOri}}}}return null};
Chainset.prototype.unmapPoint=function(a,b){for(var c=this.chainsByDest[a]||[],d=0;d<c.length;++d){var e=c[d];if(b>=e.destMin&&b<=e.destMax){for(var d="-"==e.srcOri?e.destMax-b:b-e.destMin,h=e.blocks,l=0;l<h.length;++l){var m=h[l],c=m[0],p=m[1],m=m[2];if(d>=p&&d<=p+m)return d-=p,h=d+c+e.srcMin,h="-"==e.destOri?e.srcMax-c-d:d+c+e.srcMin,{seq:e.srcChr,pos:h,flipped:e.srcOri!=e.destOri}}break}}return null};
Chainset.prototype.sourceBlocksForRange=function(a,b,c,d){if(this.chainsByDest[a]){var e=this.unmapPoint(a,b),h=this.unmapPoint(a,c);e&&h&&e.seq==h.seq?d([new DASSegment(e.seq,e.pos,h.pos)]):d([])}else{var e=!this.postFetchQueues[a],l=this;pusho(this.postFetchQueues,a,function(){l.sourceBlocksForRange(a,b,c,d)});e&&this.fetchChainsTo(a)}};function DColour(a,b,c,d){this.red=a|0;this.green=b|0;this.blue=c|0;d&&(this.name=d)}
DColour.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};function hex2(a){y="00"+a.toString(16);return y.substring(y.length-2)}DColour.prototype.toHexString=function(){return"#"+hex2(this.red)+hex2(this.green)+hex2(this.blue)};
var palette={red:new DColour(255,0,0,"red"),green:new DColour(0,255,0,"green"),blue:new DColour(0,0,255,"blue"),yellow:new DColour(255,255,0,"yellow"),white:new DColour(255,255,255,"white"),black:new DColour(0,0,0,"black")},COLOR_RE=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,CSS_COLOR_RE=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;
function dasColourForName(a){var b=palette[a];b||((b=COLOR_RE.exec(a))?b=new DColour("0x"+b[1]|0,"0x"+b[2]|0,"0x"+b[3]|0,a):(b=CSS_COLOR_RE.exec(a))?b=new DColour(b[1]|0,b[2]|0,b[3]|0,a):(console.log("couldn't handle color: "+a),b=palette.black),palette[a]=b);return b}
function makeColourSteps(a,b,c){for(var d=[],e=0;e<c.length;++e)d.push(dasColourForName(c[e]));c=[];e=0;a:for(;e<a;++e){for(var h=b[0]+(b[b.length-1]-b[0])*(1*e/(a-1)),l=0;l<b.length-1;++l)if(h>=b[l]&&h<=b[l+1]){var h=(h-b[l])/(b[l+1]-b[l]),m=d[l],l=d[l+1],l=(new DColour(m.red*(1-h)+l.red*h|0,m.green*(1-h)+l.green*h|0,m.blue*(1-h)+l.blue*h|0)).toSvgString();c.push(l);continue a}throw"Bad step";}return c}
function makeGradient(a,b,c,d){return d?makeColourSteps(a,[0,0.5,1],[b,c,d]):makeColourSteps(a,[0,1],[b,c])}var dasLibErrorHandler=function(a){alert(a)},dasLibRequestQueue=[];function DASSegment(a,b,c,d){this.name=a;this.start=b;this.end=c;this.description=d}DASSegment.prototype.toString=function(){return this.name+":"+this.start+".."+this.end};DASSegment.prototype.isBounded=function(){return this.start&&this.end};
DASSegment.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};function DASSource(a,b){var c;"string"==typeof a?(this.uri=a,c=b||{}):c=a||{};for(var d in c)"function"!=typeof c[d]&&(this[d]=c[d]);this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function DASCoords(){}
function coordsMatch(a,b){return a.taxon==b.taxon&&a.auth==b.auth&&a.version==b.version}
DASSource.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(b){if(!b)return a([]);var c=[];b=b.getElementsByTagName("SEGMENT");for(var d=0;d<b.length;++d){var e=b[d],h=e.getAttribute("id"),l=e.getAttribute("size"),m;l?(m=1,l|=0):((m=e.getAttribute("start"))&&(m|=0),(l=e.getAttribute("stop"))&&(l|=0));var p=null;e.firstChild&&(p=e.firstChild.nodeValue);c.push(new DASSegment(h,m,l,p))}a(c)})};
function DASSequence(a,b,c,d,e){this.name=a;this.start=b;this.end=c;this.alphabet=d;this.seq=e}
DASSource.prototype.sequence=function(a,b){var c=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(c,function(a){if(a){var c=[];a=a.getElementsByTagName("SEQUENCE");for(var h=0;h<a.length;++h){var l=a[h],m=l.getAttribute("id"),p=l.getAttribute("start"),q=l.getAttribute("stop"),r=null;if(l.firstChild)for(var l=l.firstChild.nodeValue,r="",t=0;;){var s=l.indexOf("\n",t);if(0<=s)r+=l.substring(t,s),t=s+1;else{r+=l.substring(t);break}}c.push(new DASSequence(m,p,q,"DNA",r))}b(c)}else b([])})};
function DASFeature(){}function DASGroup(){}function DASLink(a,b){this.desc=a;this.uri=b}
DASSource.prototype.features=function(a,b,c){b=b||{};var d;if(this.features_uri)d=this.features_uri;else{var e=[];if(a)e.push(a.toDASQuery());else if(b.group)if(a=b.group,"string"==typeof a)e.push("group_id="+a);else for(var h=0;h<a.length;++h)e.push("group_id="+a[h]);if(b.adjacent)for(a=b.adjacent,"string"==typeof a&&(a=[a]),h=0;h<a.length;++h)e.push("adjacent="+a[h]);if(b.type)if("string"==typeof b.type)e.push("type="+b.type);else for(a=0;a<b.type.length;++a)e.push("type="+b.type[a]);b.maxbins&&
e.push("maxbins="+b.maxbins);0<e.length?d=this.dasBaseURI+"features?"+e.join(";"):c([],"No filters specified")}this.doCrossDomainRequest(d,function(a,b){if(a){for(var d=[],e={},h=a.getElementsByTagName("SEGMENT"),t=0;t<h.length;++t){var s=h[t],v=s.getAttribute("id");e[v]={min:s.getAttribute("start"),max:s.getAttribute("stop")};for(var s=s.getElementsByTagName("FEATURE"),u=0;u<s.length;++u){var z=s[u],w=new DASFeature;w.segment=v;w.id=z.getAttribute("id");w.label=z.getAttribute("label");var x=elementValue(z,
"START"),A=elementValue(z,"END");(x|0)>(A|0)?(w.min=A|0,w.max=x|0):(w.min=x|0,w.max=A|0);x=z.getElementsByTagName("TYPE");0<x.length&&(x=x[0],x.firstChild&&(w.type=x.firstChild.nodeValue),w.typeId=x.getAttribute("id"),w.typeCv=x.getAttribute("cvId"));w.type=elementValue(z,"TYPE");!w.type&&w.typeId&&(w.type=w.typeId);w.method=elementValue(z,"METHOD");(x=elementValue(z,"ORIENTATION"))||(x="0");w.orientation=x;w.score=elementValue(z,"SCORE");w.links=dasLinksOf(z);w.notes=dasNotesOf(z);x=z.getElementsByTagName("GROUP");
for(A=0;A<x.length;++A){var B=x[A],F=new DASGroup;F.type=B.getAttribute("type");F.id=B.getAttribute("id");F.links=dasLinksOf(B);F.notes=dasNotesOf(B);w.groups?w.groups.push(F):w.groups=Array(F)}if(w.notes)for(x=0;x<w.notes.length;++x)A=w.notes[x],0==A.indexOf("Genename=")&&(B=new DASGroup,B.type="gene",B.id=A.substring(9),w.groups?w.groups.push(B):w.groups=Array(B));x=z.getElementsByTagName("PART");if(0<x.length){B=[];for(A=0;A<x.length;++A)B.push(x[A].getAttribute("id"));w.parts=B}x=z.getElementsByTagName("PARENT");
if(0<x.length){z=[];for(A=0;A<x.length;++A)z.push(x[A].getAttribute("id"));w.parents=z}d.push(w)}}c(d,void 0,e)}else c([],"Failed request: "+(0==b.status?"server may not support CORS":"status="+b.status))},function(a){c([],a)})};function DASAlignment(a){this.type=a;this.objects={};this.blocks=[]}
DASSource.prototype.alignments=function(a,b,c){var d=this.dasBaseURI+"alignment?query="+a;this.doCrossDomainRequest(d,function(a){if(a){var b=[];a=a.getElementsByTagName("alignment");for(var l=0;l<a.length;++l){for(var m=a[l],p=new DASAlignment(m.getAttribute("alignType")),q=m.getElementsByTagName("alignObject"),r=0;r<q.length;++r){var t=q[r],t={id:t.getAttribute("intObjectId"),accession:t.getAttribute("dbAccessionId"),version:t.getAttribute("objectVersion"),dbSource:t.getAttribute("dbSource"),dbVersion:t.getAttribute("dbVersion")};
p.objects[t.id]=t}m=m.getElementsByTagName("block");for(q=0;q<m.length;++q){for(var t=m[q],r={order:t.getAttribute("blockOrder"),segments:[]},t=t.getElementsByTagName("segment"),s=0;s<t.length;++s){var v=t[s],v={object:v.getAttribute("intObjectId"),min:v.getAttribute("start"),max:v.getAttribute("end"),strand:v.getAttribute("strand"),cigar:elementValue(v,"cigar")};r.segments.push(v)}p.blocks.push(r)}b.push(p)}c(b)}else c([],"Failed request "+d)})};function DASStylesheet(){this.styles=[]}
DASStylesheet.prototype.pushStyle=function(a,b,c){a||(a={type:"default"});a=shallowCopy(a);b&&(a.zoom=b);a.style=c;this.styles.push(a)};function DASStyle(){}function parseGradient(a){var b=a.getAttribute("steps"),b=b?b|0:50,c=[],d=[];a=a.getElementsByTagName("STOP");for(var e=0;e<a.length;++e){var h=a[e];c.push(1*h.getAttribute("score"));d.push(h.firstChild.nodeValue)}return makeColourSteps(b,c,d)}
DASSource.prototype.stylesheet=function(a,b){var c,d=this.credentials;this.stylesheet_uri?(c=this.stylesheet_uri,d=!1):c=this.dasBaseURI+"stylesheet";doCrossDomainRequest(c,function(c){if(c){var d=new DASStylesheet;c=c.getElementsByTagName("TYPE");for(var l=0;l<c.length;++l){var m=c[l],p={};p.type=m.getAttribute("id");p.label=m.getAttribute("label");p.method=m.getAttribute("method");for(var m=m.getElementsByTagName("GLYPH"),q=0;q<m.length;++q){var r=m[q],t=r.getAttribute("zoom"),s=childElementOf(r),
r=new DASStyle;r.glyph=s.localName;for(s=s.firstChild;s;)s.nodeType==Node.ELEMENT_NODE&&(r[s.localName]="BGGRAD"==s.localName?parseGradient(s):s.firstChild.nodeValue),s=s.nextSibling;d.pushStyle(p,t,r)}}a(d)}else b&&b()},d)};function DASRegistry(a,b){b=b||{};this.uri=a;this.opts=b}
DASRegistry.prototype.sources=function(a,b,c){c||(c={});var d=[];c.taxon&&d.push("organism="+c.taxon);c.auth&&d.push("authority="+c.auth);c.version&&d.push("version="+c.version);c=this.uri;0<d.length&&(c=c+"?"+d.join("&"));doCrossDomainRequest(c,function(c){if(!c&&b)b();else{var d=[];c=c.getElementsByTagName("SOURCE");for(var l=0;l<c.length;++l){var m=c[l],p=m.getElementsByTagName("VERSION");if(!(1>p.length)){for(var q=p[0],r=q.getElementsByTagName("COORDINATES"),p=[],t=0;t<r.length;++t){var s=r[t],
v=new DASCoords;v.auth=s.getAttribute("authority");v.taxon=s.getAttribute("taxid");v.version=s.getAttribute("version");p.push(v)}for(var r=[],s=q.getElementsByTagName("CAPABILITY"),u,t=0;t<s.length;++t)v=s[t],r.push(v.getAttribute("type")),"das1:features"==v.getAttribute("type")&&(u=v.getAttribute("query_uri"),u=u.substring(0,u.length-8));t={};q=q.getElementsByTagName("PROP");for(s=0;s<q.length;++s)pusho(t,q[s].getAttribute("name"),q[s].getAttribute("value"));u&&(m=new DASSource(u,{source_uri:m.getAttribute("uri"),
name:m.getAttribute("title"),desc:m.getAttribute("description"),coords:p,props:t,capabilities:r}),d.push(m))}}a(d)}})};function elementValue(a,b){var c=a.getElementsByTagName(b);return 0<c.length&&c[0].firstChild?c[0].firstChild.nodeValue:null}function childElementOf(a){if(a.hasChildNodes()){a=a.firstChild;do{if(a.nodeType==Node.ELEMENT_NODE)return a;a=a.nextSibling}while(null!=a)}return null}
function dasLinksOf(a){for(var b=[],c=a.getElementsByTagName("LINK"),d=0;d<c.length;++d){var e=c[d];e.parentNode==a&&b.push(new DASLink(e.firstChild?e.firstChild.nodeValue:"Unknown",e.getAttribute("href")))}return b}function dasNotesOf(a){var b=[];a=a.getElementsByTagName("NOTE");for(var c=0;c<a.length;++c)a[c].firstChild&&b.push(a[c].firstChild.nodeValue);return b}
function doCrossDomainRequest(a,b,c,d){if(window.XDomainRequest){var e=new XDomainRequest;e.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(e.responseText);b(a)};e.open("get",a)}else Date.now(),e=new XMLHttpRequest,e.onreadystatechange=function(){4==e.readyState&&(200<=e.status||0==e.status)&&b(e.responseXML,e)},e.open("get",a,!0),c&&(e.withCredentials=!0),d&&e.setRequestHeader("X-DAS-Authorisation",d),e.setRequestHeader("Accept","application/xml,*/*");e.send("")}
DASSource.prototype.doCrossDomainRequest=function(a,b,c){var d;this.xUser&&(d="Basic "+btoa(this.xUser+":"+this.xPass));try{return doCrossDomainRequest(a,b,this.credentials,d)}catch(e){if(c)c(e);else throw e;}};Browser.prototype.removeAllPopups=function(){removeChildren(this.hPopupHolder);removeChildren(this.popupHolder)};
Browser.prototype.makeTooltip=function(a,b){var c=!1,d=this,e=null,h;h=function(b){c=!1;e&&(clearTimeout(e),e=null);a.removeEventListener("mouseout",h,!1)};var l;l=function(h){var p=h.clientX+window.scrollX,q=h.clientY+window.scrollY;e||(e=setTimeout(function(){var h=makeElement("div",[makeElement("div",null,{className:"tooltip-arrow"}),makeElement("div",b,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(q+20)+"px",left:""+Math.max(p-30,20)+"px"});d.hPopupHolder.appendChild(h);
var m;m=function(b){try{d.hPopupHolder.removeChild(h)}catch(e){}window.removeEventListener("mousemove",m,!1);c&&null!=a.offsetParent&&l(b)};window.addEventListener("mousemove",m,!1);e=null},1E3))};a.addEventListener("mouseover",function(b){c=!0;a.addEventListener("mouseout",h,!1);l(b)},!1);a.addEventListener("DOMNodeRemovedFromDocument",function(a){c=!1;e&&(clearTimeout(e),e=null)},!1)};
Browser.prototype.popit=function(a,b,c,d){var e=this;d||(d={});a||(a={});var h=d.width||200,l;a.clientX?(d=a.clientX,l=a.clientY):(d=500,l=50);d+=document.documentElement.scrollLeft||document.body.scrollLeft;l+=document.documentElement.scrollTop||document.body.scrollTop;var m=window.innerWidth,p=l+20,q=Math.min(d-h/2,m-h-30),r=makeElement("div");r.className="popover fade "+(a.clientX?"bottom ":"")+"in";r.style.display="block";r.style.position="absolute";r.style.top=""+p+"px";r.style.left=""+q+"px";
r.style.width=h+"px";276<h&&(r.style.maxWidth=h+"px");r.appendChild(makeElement("div",null,{className:"arrow"}));if(b){var t=makeElement("button","",{className:"close"});t.innerHTML="&times;";t.addEventListener("mouseover",function(a){t.style.color="red"},!1);t.addEventListener("mouseout",function(a){t.style.color="black"},!1);t.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();e.removeAllPopups()},!1);a=makeElement("h4",[makeElement("span",b,null,{maxWidth:"200px"}),t],
{},{paddingLeft:"10px",paddingRight:"10px"});var s,v,u,z;u=function(a){a.stopPropagation();a.preventDefault();q+=a.clientX-s;8>q&&(q=8);q>m-h-32&&(q=m-h-26);p+=a.clientY-v;p=Math.max(10,p);r.style.top=""+p+"px";r.style.left=""+Math.min(q,m-h-10)+"px";s=a.clientX;v=a.clientY};z=function(a){a.stopPropagation();a.preventDefault();window.removeEventListener("mousemove",u,!1);window.removeEventListener("mouseup",z,!1)};a.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();s=
a.clientX;v=a.clientY;window.addEventListener("mousemove",u,!1);window.addEventListener("mouseup",z,!1)},!1);r.appendChild(a)}r.appendChild(makeElement("div",c,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(r);var w={node:r,displayed:!0};r.addEventListener("DOMNodeRemoved",function(a){a.target==r&&(w.displayed=!1)},!1);return w};
function makeTreeTableSection(a,b,c){function d(){c?(e.className="fa fa-caret-down",b.style.display="table"):(e.className="fa fa-caret-right",b.style.display="none")}var e=makeElement("i");d();e.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c=!c;d()},!1);a=makeElement("h6",[e," ",a],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return makeElement("div",[a,b],{})}function dlog(a){console.log(a)}
var MIN_PADDING=3,DEFAULT_SUBTIER_MAX=100;function isDasBooleanTrue(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function SubTier(){this.glyphs=[];this.height=0;this.quant=null}SubTier.prototype.add=function(a){this.glyphs.push(a);this.height=Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};SubTier.prototype.hasSpaceFor=function(a){for(var b=0;b<this.glyphs.length;++b){var c=this.glyphs[b];if(c.min()<=a.max()&&c.max()>=a.min())return!1}return!0};var GLOBAL_GC;
function drawFeatureTier(a){GLOBAL_GC=a.viewport.getContext("2d");sortFeatures(a);var b=[],c={},d={},e;for(e in a.ungroupedFeatures)for(var h=a.ungroupedFeatures[e],l=0;l<h.length;++l){var m=h[l];if(!m.parts){var p=a.styleForFeature(m);if(p)if("LINEPLOT"==p.glyph)pusho(c,p.id,m),d[p.id]=p;else{var q=glyphForFeature(m,0,a.styleForFeature(m),a);q&&b.push(q)}}}for(var r in c)e=c[r],p=d[r],"LINEPLOT"==p.glyph&&b.push(makeLineGlyph(e,p,a));if(a.dasSource.collapseSuperGroups&&!a.bumped)for(var t in a.superGroups){c=
a.superGroups[t];a.groups[t]=shallowCopy(a.groups[t]);a.groups[t].type=a.groups[c[0]].type;d={};for(q=0;q<c.length;++q)if(e=a.groupedFeatures[c[q]]){for(p=0;p<e.length;++p)m=e[p],pusho(d,m.type,m);if(a.groups[t]&&!a.groups[t].links||0==a.groups[t].links.length)a.groups[t].links=a.groups[c[0]].links;delete a.groupedFeatures[c[q]]}for(var s in d){r=d[s];e=r[0];h=null;for(p=0;p<r.length;++p)m=r[p],m=new Range(m.min,m.max),h=h?union(h,m):m;h=h.ranges();for(l=0;l<h.length;++l){for(var v=h[l],u=((v.max()|
0)-(v.min()|0)+1)*c.length,z=0,p=0;p<r.length;++p)if(m=r[p],(m.min|0)<=v.max()&&(m.max|0)>=v.min())var w=Math.max(m.min|0,v.min()),m=Math.min(m.max|0,v.max()),z=z+(m-w+1);m=new DASFeature;for(k in e)m[k]=e[k];m.min=v.min();m.max=v.max();m.label&&1<c.length&&(m.label+=" ("+c.length+" vars)");m.visualWeight=1*z/u;pusho(a.groupedFeatures,t,m)}}delete a.superGroups[t]}var c=[],x;for(x in a.groupedFeatures)c.push(x);c.sort(function(b,c){var d=a.groupedFeatures[b][0].score-a.groupedFeatures[c][0].score;
return 0<d?-1:0==d?0:1});s={};for(m=0;m<c.length;++m)if(x=c[m],q=glyphsForGroup(a.groupedFeatures[x],0,a.groups[x],a,a.dasSource.collapseSuperGroups&&!a.bumped?"collapsed_gene":"tent"))q.group=a.groups[x],s[x]=q;for(t in a.superGroups){c=a.superGroups[t];x=[];m=1E10;d=-1E10;for(p=0;p<c.length;++p)r=s[c[p]],s[c[p]]=null,r&&(x.push(r),m=Math.min(m,r.min()),d=Math.max(d,r.max()));for(p=0;p<x.length;++p)r=x[p],b.push(new PaddedGlyph(r,m,d))}for(q in s)(r=s[q])&&b.push(r);t=new SubTier;x=[];s=a.dasSource.subtierMax||
DEFAULT_SUBTIER_MAX;c=0;a:for(;c<b.length;++c)if(q=b[c],q.bump&&(a.bumped||a.dasSource.collapseSuperGroups)){for(m=0;m<x.length;++m)if(d=x[m],d.hasSpaceFor(q)){d.add(q);continue a}x.length>=s?a.status="Too many overlapping features, truncating at "+s:(d=new SubTier,d.add(q),x.push(d))}else t.add(q);0<t.glyphs.length&&(x=[t].concat(x));for(m=0;m<x.length;++m)d=x[m],d.quant&&d.glyphs.unshift(new GridGlyph(d.height));for(m=0;m<x.length;++m)d=x[m],d.glyphs.sort(function(a,b){return(a.zindex||0)-(b.zindex||
0)});a.subtiers=x;a.glyphCacheOrigin=a.browser.viewStart}function formatQuantLabel(a){a=""+a;var b=a.indexOf(".");if(0>b)return a;var c=2;"-"==a.substring(0,1)&&++c;return b>=c?a.substring(0,b):a.substring(0,b+2)}
DasTier.prototype.paint=function(){var a=this.browser.retina&&1<window.devicePixelRatio,b=this.subtiers;if(b){var c=this.browser.featurePanelWidth+2E3;a&&(c*=2);var d=this.viewport.width|0;d<c-50&&(this.viewport.width=d=c);for(var c=MIN_PADDING,e=0;e<b.length;++e)c=c+b[e].height+MIN_PADDING;e=c+=6;a&&(e*=2);e!=this.viewport.height&&(this.viewport.height=e);Math.max(c,this.browser.minTierHeight);this.viewport.style.left="-1000px";this.viewport.style.width=a?""+d/2+"px":""+d+"px";this.viewport.style.height=
""+c+"px";this.layoutHeight=Math.max(c,this.browser.minTierHeight);this.holder.style.height=""+this.layoutHeight+"px";this.updateHeight();this.drawOverlay();this.norigin=this.browser.viewStart;c=this.viewport.getContext("2d");c.fillStyle=this.background;c.clearRect(0,0,d,e);c.restore();c.save();a&&c.scale(2,2);var h=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;c.translate(h,MIN_PADDING);for(e=0;e<b.length;++e){for(var l=null,m=b[e].glyphs,p=0;p<m.length;++p){var q=m[p];q.min()<
d-h&&q.max()>-h&&(q=m[p],q.draw(c),q.quant&&(l=q.quant))}c.translate(0,b[e].height+MIN_PADDING)}c.restore();l&&this.quantLeapThreshold&&this.featureSource&&sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(b=3+b[0].height*(1-(this.quantLeapThreshold-l.min)/(l.max-l.min)),c.save(),a&&c.scale(2,2),c.strokeStyle="red",c.lineWidth=0.3,c.beginPath(),c.moveTo(0,b),c.lineTo(5E3,b),c.stroke(),c.restore());this.paintQuant()}};
DasTier.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio,b;this.subtiers&&0<this.subtiers.length&&(b=this.subtiers[0].quant);if(b){var c=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var d=this.quantOverlay.getContext("2d");
a&&d.scale(2,2);d.fillStyle="white";d.globalAlpha=0.6;a=2;40<c&&(a=1+(c/20|0));var e=(c+2*MIN_PADDING)/(a-1),h=(b.max-b.min)/(a-1);if("right"==this.browser.rulerLocation){d.fillRect(20,0,30,20);d.fillRect(20,c-20+2*MIN_PADDING,30,20);for(var l=1;l<a-1;++l)d.fillRect(20,l*e-10,30,20)}else for(d.fillRect(0,0,30,20),d.fillRect(0,c-20+2*MIN_PADDING,30,20),l=1;l<a-1;++l)d.fillRect(0,l*e-10,30,20);d.globalAlpha=1;d.strokeStyle="black";d.lineWidth=1;d.beginPath();if("right"==this.browser.rulerLocation)for(d.moveTo(42,
MIN_PADDING),d.lineTo(50,MIN_PADDING),d.lineTo(50,c+MIN_PADDING),d.lineTo(42,c+MIN_PADDING),l=1;l<a-1;++l){var m=l*e;d.moveTo(50,m);d.lineTo(45,m)}else for(d.moveTo(8,MIN_PADDING),d.lineTo(0,MIN_PADDING),d.lineTo(0,c+MIN_PADDING),d.lineTo(8,c+MIN_PADDING),l=1;l<a-1;++l)m=l*e,d.moveTo(0,m),d.lineTo(5,m);d.stroke();d.fillStyle="black";if("right"==this.browser.rulerLocation)for(d.textAlign="right",d.fillText(formatQuantLabel(b.max),41,8),d.fillText(formatQuantLabel(b.min),41,c+MIN_PADDING),l=1;l<a-1;++l)m=
l*e,d.fillText(formatQuantLabel(1*b.max-l*h),41,m+3);else for(d.textAlign="left",d.fillText(formatQuantLabel(b.max),9,8),d.fillText(formatQuantLabel(b.min),9,c+MIN_PADDING),l=1;l<a-1;++l)m=l*e,d.fillText(formatQuantLabel(1*b.max-l*h),9,m+3)}else this.quantOverlay.style.display="none"}};
function glyphsForGroup(a,b,c,d,e){e=d.styleForFeature(c);var h,l=[];b=null;for(var m=0;m<a.length;++m){var p=a[m];p.orientation&&null==b&&(b=p.orientation);!h&&p.label&&(h=p.label);var q=d.styleForFeature(p);q&&!p.parts&&(p=glyphForFeature(p,0,q,d,null,!0))&&l.push(p)}if(0==l.length)return null;a="flat";d.dasSource.collapseSuperGroups&&!d.bumped?"+"===b?a="collapsed+":"-"===b&&(a="collapsed-"):"+"===b?a="hat+":"-"===b&&(a="hat-");d=null;if(h||e&&(e.LABEL||e.LABELS))d=c.label||h;c=new GroupGlyph(l,
a);d&&("+"===b?d=">"+d:"-"===b&&(d="<"+d),c=new LabelledGlyph(c,d,!1));c.bump=!0;return c}
function glyphForFeature(a,b,c,d,e,h){var l=d.browser.scale,m=d.browser.viewStart,p=c.glyph||"BOX",q=a.min,r=a.max,t=a.orientation,s=a.score,v=a.label||a.id,u=(q-m)*l,z=Math.max((r-m+1)*l,u+1),w=d.forceHeight||c.HEIGHT||e||12,x=w*=1,m=c.BUMP&&isDasBooleanTrue(c.BUMP),A;if("CROSS"===p||"EX"===p||"TRIANGLE"===p||"DOT"===p||"SQUARE"===p||"STAR"===p||"PLIMSOLL"===p)r=c.FGCOLOR||"black",q=c.BGCOLOR||"none",t=c.STROKECOLOR,isDasBooleanTrue(c.COLOR_BY_SCORE2)&&(l=c.BGGRAD||c._gradient,l||(l=makeGradient(50,
c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=l),w=a.score2,void 0==w&&r||(r=c.MIN2?1*c.MIN2:0,x=(1*(w||0)-r)/((c.MAX2?1*c.MAX2:1)-r)*l.length|0,0>x&&(x=0),x>=l.length&&(x=l.length-1),r=l[x])),w=d.forceHeight||c.HEIGHT||e||12,x=w*=1,e=c.SIZE||w,c.RSIZE&&(e=1*c.RSIZE*w),c.STROKETHRESHOLD&&e<1*c.STROKETHRESHOLD&&(t=null),e*=1,w=(u+z)/2,l=e/2,"EX"===p?r=new ExGlyph(w,e,r):"TRIANGLE"===p?r=new TriangleGlyph(w,e,c.DIRECTION||"N",c.LINEWIDTH||e,r,t):"DOT"===p?r=new DotGlyph(w,e,r,t):"PLIMSOLL"===p?r=new PlimsollGlyph(w,
e,0.2*e,r,t):"SQUARE"===p?r=new BoxGlyph(w-l,0,e,e,r,t):"STAR"===p?(p=5,c.POINTS&&(p=c.POINTS|0),r=new StarGlyph(w,l,p,r,t)):r=new CrossGlyph(w,e,r),q&&"none"!=q&&5<z-u&&(u=new BoxGlyph(u,0,z-u,e,q),r=new GroupGlyph([u,r])),isDasBooleanTrue(c.SCATTER)&&(q=d.quantMin(c),(e=d.quantMax(c))||(e=0>q?0:10),q||(q=0),1*s<1*q&&(s=q),1*s>1*e&&(s=e),d=(1*s-q)/(e-q),s=-1*q/(e-q),d>=s?(w=Math.max(1,(d-s)*x),b=b+(1-s)*x-w):(Math.max(1,(d-s)*x),b+=(1-s)*x),A={min:q,max:e},(isDasBooleanTrue(c.LABEL)||a.forceLabel)&&
v&&!h&&(r=new LabelledGlyph(r,v,!0),h=!0),r=new TranslatedGlyph(r,0,b-l,x));else if("HISTOGRAM"===p||"GRADIENT"===p&&"undefined"!==s)q=d.quantMin(c),(e=d.quantMax(c))||(e=0>q?0:10),q||(q=0),1*s<1*q&&(s=q),1*s>1*e&&(s=e),d=(1*s-q)/(e-q),s=-1*q/(e-q),"HISTOGRAM"===p&&(d>=s?(w=Math.max(1,(d-s)*x),b=b+(1-s)*x-w):(w=Math.max(1,(s-d)*x),b+=(1-s)*x),A={min:q,max:e}),r=c.FGCOLOR||null,q=c.BGCOLOR||c.COLOR1||"green",c.BGITEM&&a.itemRgb&&(q=a.itemRgb),s=c.ALPHA?1*c.ALPHA:null,c.BGGRAD&&(l=c.BGGRAD,x=d*l.length|
0,0>x&&(x=0),x>=l.length&&(x=l.length-1),q=l[x]),c.COLOR2&&(l=c._gradient,l||(l=makeGradient(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=l),x=d*l.length|0,0>x&&(x=0),x>=l.length&&(x=l.length-1),q=l[x]),r=new BoxGlyph(u,b,z-u,w,q,r,s);else if("HIDDEN"===p)r=new PaddedGlyph(null,u,z),h=!0;else if("ARROW"===p)d=c.FGCOLOR||"purple",b=isDasBooleanTrue(c.PARALLEL),q=isDasBooleanTrue(c.SOUTHWEST),r=isDasBooleanTrue(c.NORTHEAST),r=new ArrowGlyph(u,z,w,d,b,q,r);else if("ANCHORED_ARROW"===p)r=c.FGCOLOR||"none",
q=c.BGCOLOR||"green",r=new AArrowGlyph(u,z,w,q,r,t),r.bump=!0;else if("SPAN"===p)r=c.FGCOLOR||"black",r=new SpanGlyph(u,z,w,r);else if("LINE"===p)r=c.FGCOLOR||"black",r=new LineGlyph(u,z,w,c.STYLE||"solid",t,r);else if("PRIMERS"===p)r=c.FGCOLOR||"black",q=c.BGCOLOR||"red",r=new PrimersGlyph(u,z,w,q,r);else if("TEXT"===p)d=c.STRING||"text",q=c.FGCOLOR||"black",r=new TextGlyph(u,z,w,q,d);else if("TOOMANY"===p)r=c.FGCOLOR||"gray",q=c.BGCOLOR||"orange",r=new TooManyGlyph(u,z,w,q,r);else if("POINT"===
p)w=d.forceHeight||c.HEIGHT||30,q=d.quantMin(c),e=d.quantMax(c),d=(1*s-q)/(e-q),b=(s-1*q)*(1*w/(e-q))|0,A={min:q,max:e},q=c.FGCOLOR||c.COLOR1||"black",c.COLOR2&&(l=c._gradient,l||(l=makeGradient(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=l),x=d*l.length|0,0>x&&(x=0),x>=l.length&&(x=l.length-1),q=l[x]),r=new PointGlyph((u+z)/2,w-b,w,q);else if("__SEQUENCE"===p){p=e=a.seq;x=t=a.quals;b=isDasBooleanTrue(c.__INSERTIONS);s=[];if(a.cigar)for(var B=parseCigar(a.cigar),x=p="",F=cursor=0;F<B.length;++F){var D=
B[F];if("M"==D.op)p+=e.substr(cursor,D.cnt),x+=t.substr(cursor,D.cnt),cursor+=D.cnt;else if("D"==D.op)for(var G=0;G<D.cnt;++G)p+="-",x+="Z";else if("I"==D.op){var G=e.substr(cursor,D.cnt),C=new TriangleGlyph(u+p.length*l,5,"S",5,"red");b&&(C=new LabelledGlyph(C,G,!1,"center","above","7px sans-serif"));C.feature={label:"Insertion: "+G,type:"insertion",method:"insertion"};s.push(C);cursor+=D.cnt}else"S"==D.op?cursor+=D.cnt:console.log("unknown cigop"+D.op)}l=null;if(d.currentSequence&&(e=d.currentSequence.start|
0,B=d.currentSequence.end|0,e<=r&&B>=q)){t=Math.max(q,e);B=Math.min(r,B);for(l=d.currentSequence.seq.substr(t-e,B-t+1);q<t;)l="N"+l,t--;for(;r>B;)l+="N",B++}r=new SequenceGlyph(u,z,w,p,l,c.__SEQCOLOR,x);b&&(r=new TranslatedGlyph(r,0,7));0<s.length&&(s.splice(0,0,r),r=new GroupGlyph(s))}else{if("__NONE"===p)return null;r=c.FGCOLOR||null;q=c.BGCOLOR||c.COLOR1||"green";c.BGITEM&&a.itemRgb&&(q=a.itemRgb);r=new BoxGlyph(u,0,z-u,w,q,r)}(isDasBooleanTrue(c.LABEL)||a.forceLabel)&&v&&!h&&(r=new LabelledGlyph(r,
v,!1));m&&(r.bump=!0);r.feature=a;A&&(r.quant=A);c.ZINDEX&&(r.zindex=c.ZINDEX|0);return r}
DasTier.prototype.styleForFeature=function(a){var b=zoomForScale(this.browser.scale);if(!this.stylesheet)return null;for(var c=null,d=this.stylesheet.styles,e=0;e<d.length;++e){var h=d[e];if(!(h.zoom&&h.zoom!=b||h.orientation&&h.orientation!=a.orientation)){var l=h._labelRE;l&&l.test||(l=RegExp("^"+h.label+"$"),h._labelRE=l);if(!h.label||l.test(a.label))if(l=h._methodRE,l&&l.test||(l=RegExp("^"+h.method+"$"),h._methodRE=l),!h.method||l.test(a.method)){if(h.type)if("default"==h.type){c||(c=h.style);
continue}else if(l=h._typeRE,l&&l.test||(l=RegExp("^"+h.type+"$"),h._typeRE=l),!l.test(a.type))continue;return h.style}}}return c};
function makeLineGlyph(a,b,c){var d=c.browser.viewStart,e=c.browser.scale,h=c.forceHeight||b.HEIGHT||30,l=c.quantMin(b);c=c.quantMax(b);for(var m=1*h/(c-l),p=b.FGCOLOR||b.COLOR1||"black",q=[],r=0;r<a.length;++r){var t=a[r],s=h-((t.score-1*l)*m|0);q.push((((t.min|0)+(t.max|0))/2-d)*e);q.push(s)}a=new LineGraphGlyph(q,p,h);a.quant={min:l,max:c};b.ZINDEX&&(a.zindex=b.ZINDEX|0);return a}
DasTier.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||0};DasTier.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};var MIN_TILE=100,rulerTileColors=["black","white"],baseColors={A:"green",C:"blue",G:"black",T:"red"},steps=[1,2,5];
function tileSizeForScale(a,b){b||(b=MIN_TILE);for(var c=steps.length;a*steps[c%steps.length]*Math.pow(10,c/steps.length|0)<b;)++c;return steps[c%steps.length]*Math.pow(10,c/steps.length|0)}
function drawSeqTier(a,b){var c=a.browser.retina&&1<window.devicePixelRatio,d=a.browser.scale,e=a.browser.viewStart-1E3/d|0,h=a.browser.viewEnd+2E3/d,l=a.browser.currentSeqMax,m=a.browser.featurePanelWidth+2E3;c&&(m*=2);var p=a.viewport.width|0;p<m-50&&(a.viewport.width=p=m);m=50;b&&b.seq&&(m+=25);var q=m;c&&(q*=2);a.viewport.height=q;a.viewport.style.height=""+m+"px";a.viewport.style.width=c?""+p/2+"px":""+p+"px";a.holder.style.height=""+m+"px";a.layoutHeight=m;a.updateHeight();m=a.viewport.getContext("2d");
m.clearRect(0,0,p,a.viewport.height);c&&m.scale(2,2);m.translate(1E3,0);c=h;0<l&&l<h&&(c=l);p=tileSizeForScale(d);q=Math.max(0,(e/p|0)*p);for(l=a.browser.viewStart;q<=c;)m.fillStyle=0==q/p%2?"white":"black",m.strokeStyle="black",m.fillRect((q-l)*d,8,p*d,3),m.strokeRect((q-l)*d,8,p*d,3),m.fillStyle="black",m.fillText(formatLongInt(q),(q-l)*d,22),q+=p;if(b&&b.seq)for(;e<=h;++e)e>=b.start&&e<=b.end&&(c=b.seq.substr(e-b.start,1).toUpperCase(),(p=baseColors[c])||(p="gray"),m.fillStyle=p,8<=d?m.fillText(c,
(e-l)*d,52):m.fillRect((e-l)*d,42,d,12));a.norigin=a.browser.viewStart;a.viewport.style.left="-1000px"}
function svgSeqTier(a,b){var c=a.browser.scale,d=a.browser.viewStart-1E3/c|0,e=a.browser.viewEnd+2E3/c,h=a.browser.currentSeqMax,l=e;0<h&&h<e&&(l=h);for(var m=tileSizeForScale(c),p=Math.max(0,(d/m|0)*m),h=a.browser.viewStart,q=makeElementNS(NS_SVG,"g",[],{fontSize:"8pt"});p<=l;)q.appendChild(makeElementNS(NS_SVG,"rect",null,{x:(p-h)*c,y:8,width:m*c,height:3,fill:0==p/m%2?"white":"black",stroke:"black"})),q.appendChild(makeElementNS(NS_SVG,"text",formatLongInt(p),{x:(p-h)*c,y:28,fill:"black",stroke:"none"})),
p+=m;if(b&&b.seq)for(;d<=e;++d)d>=b.start&&d<=b.end&&(l=b.seq.substr(d-b.start,1).toUpperCase(),(m=baseColors[l])||(m="gray"),8<=c?q.appendChild(makeElementNS(NS_SVG,"text",l,{x:(d-h)*c,y:52,fill:m})):q.appendChild(makeElementNS(NS_SVG,"rect",null,{x:(d-h)*c,y:42,width:c,height:12,fill:m})));return q}
function sortFeatures(a){for(var b=a.browser.drawnStart,c=a.browser.drawnEnd,d={},e={},h={},l={},m={},p={},q={},r={},t=[],s,v,u,z=function(){u={};for(var b=0;b<a.currentFeatures.length;++b){var c=a.currentFeatures[b];c.id&&(u[c.id]=c)}},w=function(a){var b=[];if(a.parents)for(var c=0;c<a.parents.length;++c){var d=a.parents[c],e=u[d];e&&"SO:0000704"==e.typeCv&&pushnew(b,d)}return b},x=0;x<a.currentFeatures.length;++x){var A=a.currentFeatures[x];if(!A.parts){var B=A.min<=c&&A.max>=b;if(A.min&&A.max){if(A.score&&
"."!=A.score&&"-"!=A.score){sc=1*A.score;if(!s||sc<s)s=sc;if(!v||sc>v)v=sc}var F=[],D=null;if(A.groups)for(var G=0;G<A.groups.length;++G){var C=A.groups[G],J=C.id;if("gene"==C.type)D=J,p[J]=C;else if("translation"!=C.type){pusho(e,J,A);p[J]=C;F.push(J);C=l[J];if(!C||A.min<C)l[J]=A.min;C=m[J];if(!C||A.max>C)m[J]=A.max}}if(A.parents)for(u||z(),G=0;G<A.parents.length;++G){var C=A.parents[G],I=u[C];I&&(I.parts||(I.parts=[A]),pushnewo(e,C,I),pusho(e,C,A),p[C]||(p[C]={type:I.type,id:I.id,label:I.label||
I.id}),F.push(C),C=w(I),0<C.length&&(D=C[0],I=u[C[0]],p[C[0]]={type:I.type,id:I.id,label:I.label||I.id},a.dasSource.collapseSuperGroups||(a.dasSource.collapseSuperGroups=!0)))}if(0==F.length)B&&pusho(d,A.type,A);else if(D)for(C=0;C<F.length;++C)J=F[C],pushnewo(q,D,J),r[J]=D}else t.push(A)}}for(J in e)m[J]>=b&&l[J]<=c&&(h[J]=e[J]);a.ungroupedFeatures=d;a.groupedFeatures=h;a.groups=p;a.superGroups=q;a.groupsToSupers=r;s&&(0<s?s=0:0>v&&(v=0),a.currentFeaturesMinScore=s,a.currentFeaturesMaxScore=v)}
TAGVAL_NOTE_RE=/^([A-Za-z]+)=(.+)/;Browser.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};function FeatureInfo(a,b,c){var d=pick(c.type,b.type),e=pick(c.label,b.label,c.id,b.id);e&&0!=e.indexOf("__dazzle")&&(d=d+": "+e);this.hit=a;this.feature=b;this.group=c;this.title=d;this.sections=[]}FeatureInfo.prototype.setTitle=function(a){this.title=a};
FeatureInfo.prototype.add=function(a,b){"string"===typeof b&&(b=makeElement("span",b));this.sections.push({label:a,info:b})};
Browser.prototype.featurePopup=function(a,b,c,d){b=c.length;var e=0<=--b?c[b]:{},h=0<=--b?c[b]:{};c=new FeatureInfo(c,e,h);c.tier=d;b=this.featureInfoPlugins||[];for(fipi=0;fipi<b.length;++fipi)try{b[fipi](e,c)}catch(l){console.log(l.stack||l)}b=d.featureInfoPlugins||[];for(fipi=0;fipi<b.length;++fipi)try{b[fipi](e,c)}catch(m){console.log(m.stack||m)}this.removeAllPopups();d=makeElement("table",null,{className:"table table-striped table-condensed"});d.style.width="100%";d.style.margin="0px";b=0;if(e.method){var p=
makeElement("tr",[makeElement("th","Method"),makeElement("td",e.method)]);d.appendChild(p);++b}p=h.segment?h:e;p=makeElement("tr",[makeElement("th","Location"),makeElement("td",p.segment+":"+p.min+"-"+p.max)]);p.style.backgroundColor=this.tierBackgroundColors[b%this.tierBackgroundColors.length];d.appendChild(p);++b;void 0!==e.score&&null!==e.score&&"-"!=e.score&&(p=makeElement("tr",[makeElement("th","Score"),makeElement("td",""+e.score)]),d.appendChild(p),++b);(p=maybeConcat(h.links,e.links))&&0<
p.length&&(p=makeElement("tr",[makeElement("th","Links"),makeElement("td",p.map(function(a){return makeElement("div",makeElement("a",a.desc,{href:a.uri,target:"_new"}))}))]),d.appendChild(p),++b);e=maybeConcat(h.notes,e.notes);for(h=0;h<e.length;++h){var p="Note",q=e[h],r=q.match(TAGVAL_NOTE_RE);r&&(p=r[1],q=r[2]);p=makeElement("tr",[makeElement("th",p),makeElement("td",q)]);d.appendChild(p);++b}for(b=0;b<c.sections.length;++b)e=c.sections[b],d.appendChild(makeElement("tr",[makeElement("th",e.label),
makeElement("td",e.info)]));this.popit(a,c.title,d,{width:400})};function Karyoscape(a,b){this.browser=a;this.dsn=b;this.svg=makeElementNS(NS_SVG,"g");this.width=250}Karyoscape.prototype.update=function(a,b,c){this.start=b;this.end=c;if(this.chr&&a==this.chr)this.setThumb();else{this.chr=a;removeChildren(this.svg);var d=this;this.dsn.features(new DASSegment(a),{type:"karyotype"},function(b,c,l){d.chrLen=l&&l[a]&&l[a].max?l[a].max:null;d.karyos=b||[];d.redraw()})}};
var karyo_palette={gneg:"white",gpos25:"rgb(200,200,200)",gpos33:"rgb(180,180,180)",gpos50:"rgb(128,128,128)",gpos66:"rgb(100,100,100)",gpos75:"rgb(64,64,64)",gpos100:"rgb(0,0,0)",gpos:"rgb(0,0,0)",gvar:"rgb(100,100,100)",acen:"rgb(100,100,100)",stalk:"rgb(100,100,100)"};
Karyoscape.prototype.redraw=function(){removeChildren(this.svg);this.karyos=this.karyos.sort(function(a,b){return(a.min|0)-(b.min|0)});0<this.karyos.length?this.chrLen||(this.chrLen=this.karyos[this.karyos.length-1].max):(this.chrLen||(alert("Warning: insufficient data to set up spatial navigator"),this.chrLen=2E8),this.karyos.push({min:1,max:this.chrLen,label:"gneg"}));for(var a=null,b=0;b<this.karyos.length;++b){var c=this.karyos[b],d=1*c.min/this.chrLen*this.width,e=1*c.max/this.chrLen*this.width,
h=karyo_palette[c.label];h&&e>d&&(d=makeElementNS(NS_SVG,"rect",null,{x:d,y:"stalk"==c.label||"acen"==c.label?5:0,width:e-d,height:"stalk"==c.label||"acen"==c.label?5:15,stroke:"none",fill:h}),"g"==c.label.substring(0,1)&&(e=new Range(c.min,c.max),a=null==a?e:union(a,e)),this.browser.makeTooltip(d,c.id),this.svg.appendChild(d))}if(a){for(var a=a.ranges(),b="M 0 10 L 0 0",c="M 0 5 L 0 15",l=h=0;l<a.length;++l)e=a[l],d=1*e.min()/this.chrLen*this.width,e=1*e.max()/this.chrLen*this.width,0.75<d-h&&(b+=
" M "+d+" 0",c+=" M "+d+" 15"),b+=" L "+e+" 0",c+=" L "+e+" 15",h=e;0.75<this.width-h?(b+=" M "+this.width+" 0",c+=" M "+this.width+" 15"):(b+=" L "+this.width+" 0",c+=" L "+this.width+" 15");b+=" L "+this.width+" 10";c+=" L "+this.width+" 5";this.svg.appendChild(makeElementNS(NS_SVG,"path",null,{d:b+" "+c,stroke:"black",strokeWidth:2,fill:"none"}))}this.thumb=makeElementNS(NS_SVG,"rect",null,{x:50,y:-5,width:8,height:25,fill:"blue",fillOpacity:0.5,stroke:"none"});this.svg.appendChild(this.thumb);
this.setThumb();var m=this,p,q=function(a){a.stopPropagation();a.preventDefault();a=Math.max(-4,Math.min(a.clientX+p,m.width-4));m.thumb.setAttribute("x",a)},r=function(a){a.stopPropagation();a.preventDefault();if(m.onchange)m.onchange(1*((m.thumb.getAttribute("x")|0)+4)/m.width,!0);document.removeEventListener("mousemove",q,!0);document.removeEventListener("mouseup",r,!0)};this.thumb.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();p=m.thumb.getAttribute("x")-a.clientX;
document.addEventListener("mousemove",q,!0);document.addEventListener("mouseup",r,!0)},!1)};Karyoscape.prototype.setThumb=function(){var a=1*(((this.start|0)+(this.end|0))/2)/this.chrLen*this.width;this.thumb&&this.thumb.setAttribute("x",a-4)};function FetchPool(){this.reqs=[];this.awaitedFeatures={}}FetchPool.prototype.addRequest=function(a){this.reqs.push(a)};FetchPool.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};
function KSCacheBaton(a,b,c,d,e,h){this.chr=a;this.min=b;this.max=c;this.scale=d;this.features=e||[];this.status=h}KSCacheBaton.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};function KnownSpace(a,b,c,d,e,h){this.tierMap=a;this.chr=b;this.min=c;this.max=d;this.scale=e;this.seqSource=h||new DummySequenceSource;this.viewCount=0;this.featureCache={};this.latestViews={}}
KnownSpace.prototype.bestCacheOverlapping=function(a,b,c){return(a=this.featureCache[this.tierMap[0]])?a:null};KnownSpace.prototype.viewFeatures=function(a,b,c,d){if(d!=d)throw"viewFeatures called with silly scale";if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";1>b&&(b=1);this.min=b;this.max=c;this.scale=d;this.pool&&this.pool.abortAll();this.pool=new FetchPool;this.awaitedSeq=new Awaited;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(this.tierMap)};
function filterFeatures(a,b,c){var d=[];featuresByGroup={};for(var e=0;e<a.length;++e){var h=a[e];h.min&&h.max?h.groups&&0<h.groups.length?pusho(featuresByGroup,h.groups[0].id,h):h.min<=c&&h.max>=b&&d.push(h):d.push(h)}for(var l in featuresByGroup){a=featuresByGroup[l];for(var m=1E11,p=-1E11,e=0;e<a.length;++e)h=a[e],m=Math.min(m,h.min),p=Math.max(p,h.max);if(m<=c||p>=b)for(e=0;e<a.length;++e)d.push(a[e])}return d}KnownSpace.prototype.invalidate=function(a){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a]))};
KnownSpace.prototype.startFetchesForTiers=function(a){for(var b=this,c=this.awaitedSeq,d=!1,e,h=0;h<a.length;++h)try{this.startFetchesFor(a[h],c)&&(d=!0)}catch(l){a[h].updateStatus(l),console.log("Error fetching tier source"),console.log(l),e=l}if(d&&!this.seqWasFetched){this.seqWasFetched=!0;var m=this.min,p=this.max;if(this.cs&&this.cs.start<=m&&this.cs.end>=p)return a=this.cs.start==m&&this.cs.end==p?this.cs:new DASSequence(this.cs.name,m,p,this.cs.alphabet,this.cs.seq.substring(m-this.cs.start,
p+1-this.cs.start)),c.provide(a);this.seqSource.fetch(this.chr,m,p,this.pool,function(a,d){if(d){if(!b.cs||m<=b.cs.start&&p>=b.cs.end||m>=b.cs.end||p<=b.cs.start||p-m>b.cs.end-b.cs.start)b.cs=d;c.provide(d)}else dlog("Noseq: "+miniJSONify(a)),c.provide(null)})}if(e)throw e;};
KnownSpace.prototype.startFetchesFor=function(a,b){var c=this,d=this.viewCount,e=a.getSource()||new DummyFeatureSource,h=a.needsSequence(this.scale),l=c.featureCache[a],m=a.getDesiredTypes(this.scale);if(void 0===m)return!1;if(l&&l.chr===this.chr&&l.min<=this.min&&l.max>=this.max){var p=l.features;if(l.min<this.min||l.max>this.max)p=filterFeatures(p,this.min,this.max);c.provision(a,l.chr,Math.max(l.min,this.min),Math.min(l.max,this.max),l.scale,m,p,l.status,h?b:null);p=e.getScales();if(l.scale<=this.scale||
!p)return h}e.instrument&&console.log("Starting  fetch "+d+" ("+this.min+", "+this.max+")");e.fetch(this.chr,this.min,this.max,this.scale,m,this.pool,function(p,r,t){e.instrument&&console.log("Finishing fetch "+d);if(!((c.latestViews[a]||-1)>d)){if(!l||c.min<l.min||c.max>l.max)c.featureCache[a]=new KSCacheBaton(c.chr,c.min,c.max,t,r,p);c.latestViews[a]=d;c.provision(a,c.chr,c.min,c.max,t,m,r,p,h?b:null)}});return h};
KnownSpace.prototype.provision=function(a,b,c,d,e,h,l,m,p){if(m)a.updateStatus(m);else{m=!1;for(var q=a.getSource();MappedFeatureSource.prototype.isPrototypeOf(q)||CachingFeatureSource.prototype.isPrototypeOf(q)||OverlayFeatureSource.prototype.isPrototypeOf(q);)q=OverlayFeatureSource.prototype.isPrototypeOf(q)?q.sources[0]:q.source;if(BWGFeatureSource.prototype.isPrototypeOf(q)||BAMFeatureSource.prototype.isPrototypeOf(q))m=!0;if(!q.opts||!q.opts.forceReduction&&!q.opts.noDownsample)if(e<this.scale/
2&&200<l.length||m&&h&&1==h.length&&0<=h.indexOf("density"))l=downsample(l,this.scale);p?p.await(function(h){a.viewFeatures(b,c,d,e,l,h)}):a.viewFeatures(b,c,d,e,l)}};var __DS_SCALES=[1,2,5];function ds_scale(a){return __DS_SCALES[a%__DS_SCALES.length]*Math.pow(10,a/__DS_SCALES.length|0)}function DSBin(a,b,c){this.scale=a;this.cnt=this.tot=0;this.hasScore=!1;this.min=b;this.max=c;this.lap=0;this.covered=null}
DSBin.prototype.score=function(){return 0==this.cnt?0:this.hasScore?this.tot/this.cnt:this.lap/coverage(this.covered)};DSBin.prototype.feature=function(a){a.score&&(this.tot+=a.score,this.hasScore=!0);var b=a.max|0;a=Math.max(this.min,a.min|0);b=Math.min(this.max,b);this.lap+=1*(b-a+1);++this.cnt;b=new Range(a,b);this.covered=this.covered?union(this.covered,b):b};
function downsample(a,b){Date.now();for(var c=0;ds_scale(c+1)<b;)++c;for(var c=ds_scale(c),d=[],e=-1E10,h=1E10,l=0;l<a.length;++l){var m=a[l];if(m.groups&&0<m.groups.length)return a;for(var p=m.min/c|0,q=m.max/c|0,e=Math.max(e,q),h=Math.min(h,p);p<=q;++p){var r=d[p];r||(r=new DSBin(c,p*c,(p+1)*c-1),d[p]=r);r.feature(m)}}l=[];for(p=h;p<=e;++p)if(r=d[p])m=new DASFeature,m.segment=a[0].segment,m.min=p*c+1,m.max=(p+1)*c,m.score=r.score(),m.type="density",l.push(m);Date.now();return l}
var hexcase=0,b64pad="";function hex_sha1(a){return rstr2hex(rstr_sha1(str2rstr_utf8(a)))}function b64_sha1(a){return rstr2b64(rstr_sha1(str2rstr_utf8(a)))}function any_sha1(a,b){return rstr2any(rstr_sha1(str2rstr_utf8(a)),b)}function hex_hmac_sha1(a,b){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}function b64_hmac_sha1(a,b){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}
function any_hmac_sha1(a,b,c){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)),c)}function sha1_vm_test(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==hex_sha1("abc").toLowerCase()}function rstr_sha1(a){return binb2rstr(binb_sha1(rstr2binb(a),8*a.length))}
function rstr_hmac_sha1(a,b){var c=rstr2binb(a);16<c.length&&(c=binb_sha1(c,8*a.length));for(var d=Array(16),e=Array(16),h=0;16>h;h++)d[h]=c[h]^909522486,e[h]=c[h]^1549556828;c=binb_sha1(d.concat(rstr2binb(b)),512+8*b.length);return binb2rstr(binb_sha1(e.concat(c),672))}function rstr2hex(a){try{hexcase}catch(b){hexcase=0}for(var c=hexcase?"0123456789ABCDEF":"0123456789abcdef",d="",e,h=0;h<a.length;h++)e=a.charCodeAt(h),d+=c.charAt(e>>>4&15)+c.charAt(e&15);return d}
function rstr2b64(a){try{b64pad}catch(b){b64pad=""}for(var c="",d=a.length,e=0;e<d;e+=3)for(var h=a.charCodeAt(e)<<16|(e+1<d?a.charCodeAt(e+1)<<8:0)|(e+2<d?a.charCodeAt(e+2):0),l=0;4>l;l++)c=8*e+6*l>8*a.length?c+b64pad:c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>6*(3-l)&63);return c}
function rstr2any(a,b){var c=b.length,d=[],e,h,l,m,p=Array(Math.ceil(a.length/2));for(e=0;e<p.length;e++)p[e]=a.charCodeAt(2*e)<<8|a.charCodeAt(2*e+1);for(;0<p.length;){m=[];for(e=l=0;e<p.length;e++)if(l=(l<<16)+p[e],h=Math.floor(l/c),l-=h*c,0<m.length||0<h)m[m.length]=h;d[d.length]=l;p=m}c="";for(e=d.length-1;0<=e;e--)c+=b.charAt(d[e]);d=Math.ceil(8*a.length/(Math.log(b.length)/Math.log(2)));for(e=c.length;e<d;e++)c=b[0]+c;return c}
function str2rstr_utf8(a){for(var b="",c=-1,d,e;++c<a.length;)d=a.charCodeAt(c),e=c+1<a.length?a.charCodeAt(c+1):0,55296<=d&&56319>=d&&56320<=e&&57343>=e&&(d=65536+((d&1023)<<10)+(e&1023),c++),127>=d?b+=String.fromCharCode(d):2047>=d?b+=String.fromCharCode(192|d>>>6&31,128|d&63):65535>=d?b+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(b+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return b}
function str2rstr_utf16le(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)&255,a.charCodeAt(c)>>>8&255);return b}function str2rstr_utf16be(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)>>>8&255,a.charCodeAt(c)&255);return b}function rstr2binb(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(c=0;c<8*a.length;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<24-c%32;return b}
function binb2rstr(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>24-c%32&255);return b}
function binb_sha1(a,b){a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;for(var c=Array(80),d=1732584193,e=-271733879,h=-1732584194,l=271733878,m=-1009589776,p=0;p<a.length;p+=16){for(var q=d,r=e,t=h,s=l,v=m,u=0;80>u;u++){c[u]=16>u?a[p+u]:bit_rol(c[u-3]^c[u-8]^c[u-14]^c[u-16],1);var z=safe_add(safe_add(bit_rol(d,5),sha1_ft(u,e,h,l)),safe_add(safe_add(m,c[u]),sha1_kt(u))),m=l,l=h,h=bit_rol(e,30),e=d,d=z}d=safe_add(d,q);e=safe_add(e,r);h=safe_add(h,t);l=safe_add(l,s);m=safe_add(m,v)}return[d,e,h,l,m]}
function sha1_ft(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function sha1_kt(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function safe_add(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}function bit_rol(a,b){return a<<b|a>>>32-b}
Browser.prototype.openExportPanel=function(a){var b=this;if("export"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{a=makeElement("div",null,{className:"tier-edit"},{textAlign:"center"});a.appendChild(makeElement("p","Export current view as SVG"));var c=makeElement("input",null,{type:"checkbox",checked:!0}),d=makeElement("input",null,{type:"checkbox",checked:!0}),e=makeElement("button","Export",{className:"btn btn-primary"});e.addEventListener("click",function(a){removeChildren(h);
h.appendChild(makeElement("a","SVG created, click here to download",{href:URL.createObjectURL(b.makeSVG({highlights:c.checked,ruler:d.checked?b.rulerLocation:"none"})),download:"dalliance-view.svg",type:"image/svg+xml"}))},!1);var h=makeElement("p",""),l=makeElement("table",[makeElement("tr",[makeElement("th","Include highlights",{},{width:"200px",textAlign:"right"}),makeElement("td",c)]),makeElement("tr",[makeElement("th","Include vertical guideline"),makeElement("td",d)])]);a.appendChild(l);a.appendChild(e);
a.appendChild(h);this.showToolPanel(a);this.setUiMode("export")}};
Browser.prototype.makeSVG=function(a){a=a||{};var b=document.implementation.createDocument(NS_SVG,"svg",null),c=makeElementNS(NS_SVG,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});b.documentElement.appendChild(c);var d=makeElementNS(NS_SVG,"a",makeElementNS(NS_SVG,"text","Graphics from Dalliance "+VERSION,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fill:"black",fontSize:"12pt",textAnchor:"middle",fill:"blue"}));d.setAttribute("xmlns:xlink",NS_XLINK);d.setAttribute("xlink:href","http://www.biodalliance.org/");
c.appendChild(d);d=makeElementNS(NS_SVG,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});d=makeElementNS(NS_SVG,"clipPath",d,{id:"featureClip"});c.appendChild(d);for(var d=70,e=makeElementNS(NS_SVG,"g",null,{}),h=0;h<this.tiers.length;++h){var l=this.tiers[h],m=makeElementNS(NS_SVG,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),p=makeElementNS(NS_SVG,"g"),q=d,r=makeElementNS(NS_SVG,"rect",null,{x:0,y:q,width:"10000",height:50,fill:l.background});m.appendChild(r);if("sequence"===
l.dasSource.tier_type){var t=svgSeqTier(l,l.currentSequence);m.appendChild(makeElementNS(NS_SVG,"g",t,{transform:"translate(200, "+d+")"}));d+=80}else{if(!l.subtiers)continue;for(var t=(l.glyphCacheOrigin-this.viewStart)*this.scale,s=!1,v=0;v<l.subtiers.length;++v){for(var u=l.subtiers[v],z=[],w=0;w<u.glyphs.length;++w)z.push(u.glyphs[w].toSVG());m.appendChild(makeElementNS(NS_SVG,"g",z,{transform:"translate("+(200+t)+", "+d+")"}));if(u.quant){var s=!0,z=u.quant,x=u.height,w=2;40<x&&(w=1+(x/20|0));
var x=x/(w-1),A=(z.max-z.min)/(w-1),B=new SVGPath;B.moveTo(205,d);B.lineTo(200,d);B.lineTo(200,d+u.height);B.lineTo(205,d+u.height);for(var F=1;F<w-1;++F){var D=F*x;B.moveTo(200,d+D);B.lineTo(203,d+D)}p.appendChild(makeElementNS(NS_SVG,"path",null,{d:B.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"}));p.appendChild(makeElementNS(NS_SVG,"text",formatQuantLabel(z.max),{x:197,y:d+7,textAnchor:"end"}));p.appendChild(makeElementNS(NS_SVG,"text",formatQuantLabel(z.min),{x:197,y:d+u.height,textAnchor:"end"}));
for(F=1;F<w-1;++F)D=F*x,p.appendChild(makeElementNS(NS_SVG,"text",formatQuantLabel(1*z.max-F*A),{x:197,y:d+D+3,textAnchor:"end"}))}d+=u.height+3}d+=10}p.appendChild(makeElementNS(NS_SVG,"text",l.dasSource.name,{x:200-(s?20:12),y:(d+q+5)/2,fontSize:"12pt",textAnchor:"end"}));r.setAttribute("height",d-q);e.appendChild(makeElementNS(NS_SVG,"g",[m,p]))}if(a.highlights)for(s=this.highlights||[],h=0;h<s.length;++h)x=s[h],x.chr==this.chr&&x.min<this.viewEnd&&x.max>this.viewStart&&(l=(Math.max(x.min,this.viewStart)-
this.viewStart)*this.scale,m=(Math.min(x.max,this.viewEnd)-this.viewStart)*this.scale,e.appendChild(makeElementNS(NS_SVG,"rect",null,{x:200+l,y:70,width:m-l,height:d-70,stroke:"none",fill:"red",fillOpacity:0.3})));s=-1;"center"==a.ruler?s=200+(this.viewEnd-this.viewStart+1)*this.scale/2:"left"==a.ruler?s=200:"right"==a.ruler&&(s=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=s&&e.appendChild(makeElementNS(NS_SVG,"line",null,{x1:s,y1:70,x2:s,y2:d,stroke:"blue"}));c.appendChild(e);b.documentElement.setAttribute("width",
this.featurePanelWidth+20+200);b.documentElement.setAttribute("height",d+50);return new Blob([(new XMLSerializer).serializeToString(b)],{type:"image/svg+xml"})};function Range(a,b){if("number"!=typeof a||"number"!=typeof b)throw"Bad range "+a+","+b;this._min=a;this._max=b}Range.prototype.min=function(){return this._min};Range.prototype.max=function(){return this._max};Range.prototype.contains=function(a){return a>=this._min&&a<=this._max};Range.prototype.isContiguous=function(){return!0};
Range.prototype.ranges=function(){return[this]};Range.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};function _Compound(a){this._ranges=a}_Compound.prototype.min=function(){return this._ranges[0].min()};_Compound.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};_Compound.prototype.contains=function(a){for(var b=0;b<this._ranges.length;++b)if(this._ranges[b].contains(a))return!0;return!1};_Compound.prototype.isContiguous=function(){return 1<this._ranges.length};
_Compound.prototype.ranges=function(){return this._ranges};_Compound.prototype.toString=function(){for(var a="",b=0;b<this._ranges.length;++b)0<b&&(a+=","),a+=this._ranges[b].toString();return a};function union(a,b){for(var c=a.ranges().concat(b.ranges()).sort(rangeOrder),d=[],e=c[0],h=1;h<c.length;++h){var l=c[h];l.min()>e.max()+1?(d.push(e),e=l):l.max()>e.max()&&(e=new Range(e.min(),l.max()))}d.push(e);return 1==d.length?d[0]:new _Compound(d)}
function intersection(a,b){for(var c=a.ranges(),d=b.ranges(),e=c.length,h=d.length,l=0,m=0,p=[];l<e&&m<h;){a=c[l];b=d[m];var q=Math.max(a.min(),b.min()),r=Math.min(a.max(),b.max());r>=q&&p.push(new Range(q,r));a.max()>b.max()?++m:++l}return 0==p.length?null:1==p.length?p[0]:new _Compound(p)}function coverage(a){var b=0;a=a.ranges();for(var c=0;c<a.length;++c)var d=a[c],b=b+(d.max()-d.min()+1);return b}
function rangeOrder(a,b){return a.min()<b.min()?-1:a.min()>b.min()?1:a.max()<b.max()?-1:b.max()>a.max()?1:0}var THUB_STANZA_REGEXP=/\n\s*\n/,THUB_PARSE_REGEXP=/(\w+) +(.+)\n?/,THUB_SUBGROUP_REGEXP=/subGroup[1-9]/,THUB_PENNANT_PREFIX="http://genome.ucsc.edu/images/";function TrackHub(a){this.genomes={};this.url=a}function TrackHubTrack(){}TrackHubTrack.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};function TrackHubDB(a){this.hub=a}
TrackHubDB.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);textXHR(this.absURL,function(c,d){if(d)return a(null,d);c=c.replace(/\#.*/g,"");c=c.replace("\\\n"," ");var e=[],h={};stanzas=c.split(THUB_STANZA_REGEXP);for(var l=0;l<stanzas.length;++l){var m=stanzas[l].split(THUB_PARSE_REGEXP),p=new TrackHubTrack;p._db=b;for(var q=0;q<m.length-2;q+=3){var r=m[q+1],t=m[q+2];if(r.match(THUB_SUBGROUP_REGEXP)){p.subgroups||(p.subgroups={});for(var r=t.split(/\s/),t=r[0],s=
{name:r[1],tags:[],titles:[]},v=2;v<r.length;++v){var u=r[v].split(/=/);s.tags.push(u[0]);s.titles.push(u[1])}p.subgroups[t]=s}else if("subGroups"===r)for(r=t.split(/(\w+)=(\w+)/),p.sgm={},v=0;v<r.length-2;v+=3)p.sgm[r[v+1]]=r[v+2];else p[m[q+1]]=m[q+2]}p.track&&(p.type||p.container)&&(e.push(p),h[p.track]=p)}l=[];m=[];for(r=0;r<e.length;++r)p=e[r],q=!0,p.parent&&(ptoks=p.parent.split(/\s+/),t=h[ptoks[0]])&&(p._parent=t,t.children||(t.children=[]),t.children.push(p),t&&(q=!1)),p.compositeTrack?m.push(p):
q&&l.push(p);for(e=0;e<m.length;++e){h=m[e];p=!1;for(q=0;q<h.children.length;++q)r=h.children[q],r.view&&(l.push(r),p=!0);p||l.push(h)}b._tracks=l;return a(b._tracks,null)},{credentials:this.credentials})};
function connectTrackHub(a,b,c){c=c||{};c.salt=!0;textXHR(a,function(d,e){if(e)return b(null,e);var h=d.split(THUB_PARSE_REGEXP),l=new TrackHub(a);c.credentials&&(l.credentials=c.credentials);for(var m=0;m<h.length-2;m+=3)l[h[m+1]]=h[m+2];if(l.genomesFile){var p=relativeURL(a,l.genomesFile);textXHR(p,function(a,d){if(d)return b(null,d);stanzas=a.split(THUB_STANZA_REGEXP);for(var e=0;e<stanzas.length;++e){var h=stanzas[e].split(THUB_PARSE_REGEXP),m=new TrackHubDB(l);c.credentials&&(m.credentials=c.credentials);
for(var u=0;u<h.length-2;u+=3)m[h[u+1]]=h[u+2];m.twoBitPath&&(m.twoBitPath=relativeURL(p,m.twoBitPath));m.genome&&m.trackDb&&(m.absURL=relativeURL(p,m.trackDb),l.genomes[m.genome]=m)}b(l)},c)}else b(null,"No genomesFile")},c)}
TrackHubTrack.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&(a.mapping=this._db.mapping);var b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant=THUB_PENNANT_PREFIX+b[0]);if(b=this.get("searchTrix"))a.trixURI=relativeURL(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var c=0;c<b.length;++c){var d=b[c],e=d.toDallianceSource();a.overlay.push(e);if(e.style)for(var h=
0;h<e.style.length;++h){var l=e.style[h];l.method=d.shortLabel;"transparentOverlay"==this.aggregate&&(l.style.ALPHA=0.5);a.style.push(l)}}return a}typeToks=this.type.split(/\s+/);if("bigBed"==typeToks[0])return b=typeToks[1]|0,c="+"==typeToks[2],a.bwgURI=relativeURL(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&c&&(a.collapseSuperGroups=!0),a;if("bigWig"==typeToks[0])return a.bwgURI=relativeURL(this._db.absURL,this.bigDataUrl),a.style=
this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&"on"==this.yLineOnOff&&(a.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==typeToks[0])return a.bamURI=relativeURL(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=!0),a;console.log("Unsupported "+this.type)};
TrackHubTrack.prototype.bigwigStyles=function(){var a,b;3<=typeToks.length&&(a=1*typeToks[1],b=1*typeToks[2]);var c;if(this.maxHeightPixels){var d=this.maxHeightPixels.split(/:/);3==d.length?c=d[1]|0:console.log("maxHeightPixels should be of the form max:default:min")}d="bars";this.graphTypeDefault&&(d=this.graphTypeDefault);var e="black",h=null;this.color&&(e="rgb("+this.color+")");this.altColor&&(h="rgb("+this.altColor+")");var l=new DASStylesheet,m=new DASStyle;m.glyph="points"==d?"POINT":"HISTOGRAM";
h?(m.COLOR1=e,m.COLOR2=h):m.BGCOLOR=e;m.HEIGHT=c||30;if(a||b)m.MIN=a,m.MAX=b;l.pushStyle({type:"default"},null,m);return l.styles};
TrackHubTrack.prototype.bigbedStyles=function(){var a="on"==(""+this.get("itemRgb")).toLowerCase(),b=this.get("visibility")||"full",c=this.get("color"),c=c?"rgb("+c+")":"blue",d=new DASStylesheet,e=new DASStyle;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR=c;e.HEIGHT="full"==b||"pack"==b?12:8;e.BUMP="full"==b||"pack"==b;e.LABEL="full"==b||"pack"==b;e.ZINDEX=20;a&&(e.BGITEM=!0);(b=this.get("colorByStrand"))?(b=b.split(/\s+/),c=shallowCopy(e),c.BGCOLOR="rgb("+b[0]+")",d.pushStyle({type:"bigwig",orientation:"+"},
null,c),e=shallowCopy(e),e.BGCOLOR="rgb("+b[1]+")",d.pushStyle({type:"bigwig",orientation:"-"},null,e)):d.pushStyle({type:"bigwig"},null,e);e=new DASStyle;e.glyph="BOX";e.FGCOLOR="black";a&&(e.BGITEM=!0);e.BGCOLOR="red";e.HEIGHT=10;e.BUMP=!0;e.ZINDEX=20;d.pushStyle({type:"bb-translation"},null,e);a=new DASStyle;a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR="white";a.HEIGHT=10;a.ZINDEX=10;a.BUMP=!0;a.LABEL=!0;d.pushStyle({type:"bb-transcript"},null,a);return d.styles};
function THUB_COMPARE(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}var __tier_idSeed=0;
function DasTier(a,b,c,d,e,h,l,m,p){this.config=p||{};this.id="tier"+ ++__tier_idSeed;this.browser=a;this.dasSource=new DASSource(b);this.viewport=c;this.holder=d;this.overlay=e;this.placard=h;this.placardContent=l;this.req=null;this.layoutHeight=25;this.bumped=!0;this.notifier=m;this.styleIdSeed=0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.y=0;this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);
this.initSources();var q=this;this.featureSource&&this.featureSource.getDefaultFIPs&&this.featureSource.getDefaultFIPs(function(a){a&&q.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&this.featureSource.addReadinessListener(function(a){q.notify(a,-1)});this.listeners=[]}DasTier.prototype.toString=function(){return this.id};DasTier.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};
DasTier.prototype.init=function(){var a=this;if(a.dasSource.style)this.setStylesheet({styles:a.dasSource.style}),this.browser.refreshTier(this);else{var b;b=a.dasSource.stylesheet_uri?new DASFeatureSource(a.dasSource):a.getSource();a.status="Fetching stylesheet";b.getStyleSheet(function(b,d){if(d){a.error="No stylesheet";b=new DASStylesheet;var e=new DASStyle;e.glyph="BOX";e.BGCOLOR="blue";e.FGCOLOR="black";b.pushStyle({type:"default"},null,e);a.setStylesheet(b)}else a.setStylesheet(b),b.geneHint&&
(a.dasSource.collapseSuperGroups=!0,a.bumped=!1,a.updateLabel());a.browser.refreshTier(a)})}};DasTier.prototype.setStylesheet=function(a){this.stylesheet=shallowCopy(a);for(a=0;a<this.stylesheet.styles.length;++a){var b=this.stylesheet.styles[a]=shallowCopy(this.stylesheet.styles[a]);b._methodRE=b._labelRE=b._typeRE=null;b.style=shallowCopy(b.style);b.style.id="style"+ ++this.styleIdSeed}};DasTier.prototype.getSource=function(){return this.featureSource};
DasTier.prototype.getDesiredTypes=function(a){a=[];var b=!1,c=zoomForScale(this.browser.scale);if(this.stylesheet){for(var d=this.stylesheet.styles,e=0;e<d.length;++e){var h=d[e];if(!h.zoom||h.zoom==c)if(h.type&&"default"!=h.type)pushnew(a,h.type);else{b=!0;break}}return b?null:a}};DasTier.prototype.needsSequence=function(a){return"sequence"===this.dasSource.tier_type&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob)&&20>a?!0:!1};
DasTier.prototype.viewFeatures=function(a,b,c,d,e,h){this.currentFeatures=e;this.currentSequence=h;this.knownChr=a;this.knownStart=b;this.knownEnd=c;this.error=this.status=null;this.draw()};DasTier.prototype.updateStatus=function(a){a?(this.currentFeatures=[],this.currentSequence=null,this.error=a,this.placardContent.innerText=a,this.placard.style.display="block",this.holder.style.display="none"):(this.placard.style.display="none",this.holder.style.display="block");this.updateHeight()};
DasTier.prototype.draw=function(){var a=this.currentSequence;"sequence"===this.dasSource.tier_type?drawSeqTier(this,a):drawFeatureTier(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};function zoomForScale(a){return 0.2<a?"high":0.01<a?"medium":"low"}
DasTier.prototype.findNextFeature=function(a,b,c,d,e){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*c/2|0,this.featureSource.quantFindNextFeature(a,b,c,this.quantLeapThreshold,e);else{if(this.knownStart&&b>=this.knownStart&&b<=this.knownEnd&&this.currentFeatures){for(var h=null,l=0;l<this.currentFeatures.length;++l){var m=this.currentFeatures[l];if(m.min&&m.max&&!(m.parents&&0<m.parents.length))if(0>c)if(1==d&&m.max>=b&&m.min<b){if(!h||m.min>h.min||m.min==h.min&&m.max<
h.max)h=m}else m.max<b&&(!h||m.max>h.max||m.max==h.max&&m.min<h.min||m.min==h.mmin&&h.max>=b)&&(h=m);else if(1==d&&m.min<=b&&m.max>b){if(!h||m.max<h.max||m.max==h.max&&m.min>h.min)h=m}else m.min>b&&(!h||m.min<h.min||m.min==h.min&&m.max>h.max||m.max==h.max&&h.min<=b)&&(h=m)}if(h)return e(h);b=0>c?this.knownStart:this.knownEnd}this.featureSource.findNextFeature(a,b,c,e)}};
DasTier.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};DasTier.prototype.updateHeight=function(){this.currentHeight=Math.max(this.layoutHeight,Math.max(this.holder.clientHeight,this.label.clientHeight+4));"none"!==this.placard.style.display&&(this.currentHeight=Math.max(this.currentHeight,52));this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};
DasTier.prototype.drawOverlay=function(){var a=this.browser,b=this.overlay.getContext("2d");this.overlay.height=this.viewport.height;for(var c=a.viewStart-1E3/a.scale,d=a.viewStart-1E3/a.scale,e=a.viewEnd+1E3/a.scale,h=0;h<a.highlights.length;++h){var l=a.highlights[h];l.chr==a.chr&&l.min<e&&l.max>d&&(b.globalAlpha=0.3,b.fillStyle="red",b.fillRect((l.min-c)*a.scale,0,(l.max-l.min)*a.scale,this.overlay.height))}this.oorigin=a.viewStart;this.overlay.style.left="-1000px"};
DasTier.prototype.notify=function(a,b){b=b||2E3;this.notifierFadeTimeout&&(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=null);if(a){if(this.notifier.textContent=a,this.notifier.style.opacity=0.8,0<b){var c=this;this.notifierFadeTimeout=setTimeout(function(){c.notifier.style.opacity=0;c.notifierFadeTimeout=null},b)}}else this.notifier.style.opacity=0};DasTier.prototype.setConfig=function(a){this.config=a||{};this._updateFromConfig();this.notifyTierListeners()};
DasTier.prototype.mergeConfig=function(a){for(var b in a)this.config[b]=a[b];this._updateFromConfig();this.notifyTierListeners()};
DasTier.prototype._updateFromConfig=function(){var a=!1;this.nameElement.innerText=this.config.name||this.dasSource.name;this.config.height&&this.config.height!=this.forceHeight&&(this.forceHeight=this.config.height,a=!0);void 0!=this.config.forceMinDynamic&&this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,a=!0);var b=void 0!=this.config.forceMin?this.config.forceMin:this.dasSource.forceMin;void 0!=b&&this.forceMin!=b&&(this.forceMin=b,a=!0);void 0!=
this.config.forceMaxDynamic&&this.forceMaxDynamic!=this.config.forceMaxDynamic&&(this.forceMaxDynamic=this.config.forceMaxDynamic,a=!0);b=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;void 0!=b&&this.forceMax!=b&&(this.forceMax=b,a=!0);b=null;void 0!=this.config.quantLeapThreshold?b=this.config.quantLeapThreshold:void 0!=this.dasSource.quantLeapThreshold&&(b=this.dasSource.quantLeapThreshold);b!=this.quantLeapThreshold&&(this.quantLeapThreshold=b,a=!0);a&&this.scheduleRedraw()};
DasTier.prototype.scheduleRedraw=function(){if(this.currentFeatures){var a=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){a.draw();a.redrawTimeout=null},10))}};DasTier.prototype.addTierListener=function(a){this.listeners.push(a)};DasTier.prototype.notifyTierListeners=function(a){for(var b=0;b<this.listeners.length;++b)try{this.listeners[b](a)}catch(c){console.log(c)}this.browser.notifyTier()};
Browser.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b)if(sourcesAreEqual(this.tiers[b].dasSource,a))return this.tiers[b];return!1};Browser.prototype.makeButton=function(a,b){var c=makeElement("a",a,{href:"#"});b&&this.makeTooltip(c,b);return makeElement("li",c)};function activateButton(a,b){for(var c=0;c<a.length;++c){var d=a[c];d===b?d.classList.add("active"):d.classList.remove("active")}}
Browser.prototype.showTrackAdder=function(a){function b(a){P.style.display="none";R.style.display="none";S.style.display="none";H=!1;removeChildren(E);for(var b=makeElement("div",null,{},{width:"100%"}),c=[],d=0;d<a.length;++d)c.push(a[d]);c.sort(function(a,b){return a.shortLabel.toLowerCase().trim().localeCompare(b.shortLabel.toLowerCase().trim())});a=[];for(var e=[],d=0;d<c.length;++d){var h=c[d];h.children&&0<h.children.length&&"multiWig"!=h.container?a.push(h):e.push(h)}0<e.length&&a.push({shortLabel:"Others",
priority:-1E8,children:e});a.sort(THUB_COMPARE);for(var l=[],c=0;c<a.length;++c){h=e=a[c];!h.dimensions&&h._parent&&h._parent.dimensions&&(h=h._parent);d={};if(h.dimensions)for(var m=h.dimensions.split(/(\w+)=(\w+)/),p=0;p<m.length-2;p+=3)d[m[p+1]]=m[p+2];if(d.dimX&&d.dimY){for(var q=d.dimX,r=d.dimY,d=h.subgroups[q],m=h.subgroups[r],p={},s=0;s<e.children.length;++s){var u=e.children[s],h=u.sgm[q],v=u.sgm[r];p[h]||(p[h]={});p[h][v]=u}r=makeElement("table",null,{className:"table table-striped table-condensed"},
{tableLayout:"fixed"});h=makeElement("tr");h.appendChild(makeElement("th",null,{},{width:"150px",height:"100px"}));for(v=0;v<d.titles.length;++v)q=makeElement("th",makeElement("div",d.titles[v],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),h.appendChild(q);r.appendChild(h);for(var w=makeElement("tbody",null,{className:"table table-striped table-condensed"}),
z=0;z<m.titles.length;++z){var v=m.tags[z],x=makeElement("tr");x.appendChild(makeElement("th",m.titles[z]),{});for(var A=0;A<d.titles.length;++A){var h=d.tags[A],D=makeElement("td");if(p[h]&&p[h][v]){h=p[h][v];s=h.toDallianceSource();if(!s)continue;q=makeElement("tr");u=makeElement("td");u.style.textAlign="center";var B=makeElement("input");B.type="checkbox";B.dalliance_source=s;U&&(B.dalliance_mapping=U);l.push(B);D.appendChild(B);B.addEventListener("change",function(a){a.target.checked?t.addTier(a.target.dalliance_source):
t.removeTier(a.target.dalliance_source)})}x.appendChild(D)}w.appendChild(x)}r.appendChild(w);b.appendChild(makeTreeTableSection(e.shortLabel,r,0==c))}else{m=makeElement("tbody",null,{className:"table table-striped table-condensed"});p=makeElement("table",m,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});v=0;e.children.sort(THUB_COMPARE);for(d=0;d<e.children.length;++d)if(h=e.children[d],s=h.toDallianceSource())q=makeElement("tr"),u=makeElement("td",null,{},{width:"30px"}),
u.style.textAlign="center",B=makeElement("input"),B.type="checkbox",B.dalliance_source=s,U&&(B.dalliance_mapping=U),l.push(B),u.appendChild(B),B.addEventListener("change",function(a){a.target.checked?t.addTier(a.target.dalliance_source):t.removeTier(a.target.dalliance_source)}),q.appendChild(u),r=makeElement("td"),r.appendChild(document.createTextNode(h.shortLabel)),h.longLabel&&0<h.longLabel.length&&t.makeTooltip(r,h.longLabel),q.appendChild(r),m.appendChild(q),++v;b.appendChild(makeTreeTableSection(e.shortLabel,
p,0==c))}}var C=function(){for(var a=0;a<l.length;++a){var b=l[a],c=t.currentlyActive(b.dalliance_source);c?(b.checked=!0,b.disabled=null!=c.sequenceSource):b.checked=!1}};C();t.addTierListener(function(a){C()});E.appendChild(b)}function c(){activateButton(s,G);H="bin";P.style.display="none";R.style.display="inline";S.style.display="none";removeChildren(E);var a=makeElement("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(makeElement("h3","Add custom URL-based data"));a.appendChild(makeElement("p",
["You can add indexed binary data hosted on an web server that supports CORS (",makeElement("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(makeElement("br"));a.appendChild(document.createTextNode("URL: "));I=makeElement("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});a.appendChild(I);a.appendChild(makeElement("br"));a.appendChild(makeElement("b","- or -"));
a.appendChild(makeElement("br"));a.appendChild(document.createTextNode("File: "));O=makeElement("input",null,{type:"file"});a.appendChild(O);a.appendChild(makeElement("p",'Clicking the "Add" button below will initiate a series of test queries.'));E.appendChild(a);I.focus()}function d(){activateButton(s,C);P.style.display="none";R.style.display="inline";S.style.display="none";H="hub-connect";P.style.visibility="hidden";removeChildren(E);var a=makeElement("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});
a.appendChild(makeElement("h3","Connect to a track hub."));a.appendChild(makeElement("p",['Enter the top-level URL (usually points to a file called "hub.txt" of a UCSC-style track hub']));I=makeElement("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild(I);E.appendChild(a);I.focus()}function e(){activateButton(s,D);P.style.display="none";R.style.display="inline";S.style.display="none";H="das";removeChildren(E);var a=makeElement("div",null,
{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(makeElement("h3","Add custom DAS data"));a.appendChild(makeElement("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));a.appendChild(makeElement("br"));I=makeElement("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild(I);a.appendChild(makeElement("p",
'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));E.appendChild(a);I.focus()}function h(){if(H)if("das"===H){var a=I.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);var b=new DASSource({name:"temporary",uri:a});X(b)}else"bin"===H?(b={name:"temporary"},(a=O.files)&&0<a.length&&a[0]?(b.bwgBlob=a[0],b.noPersist=!0):(a=I.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),b.bwgURI=a),b=new DASSource(b),
Y(b)):"reset"===H?e():"reset-bin"===H?c():"reset-hub"===H?d():"prompt-bai"===H?(a=O.files)&&0<a.length&&a[0]?(M.baiBlob=a[0],q(M)):p(M):"finalize"===H||"finalize-bin"===H?(M.name=N.value,b=L.value,M.mapping="__default__"!=b?b:void 0,K&&(M.maxbins=K.checked),1<Q.value.length&&1<T.value.length&&(dlog("password"),M.xUser=Q.value,M.xPass=T.value),t.addTier(M),"finalize-bin"==H?c():e()):"hub-connect"===H&&(a=I.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),l(a));else t.removeAllPopups()}function l(a,
c,d){console.log("ntah");c=c||{};connectTrackHub(a,function(e,h){if(h){if(!d)return l(a,{credentials:!0},!0);removeChildren(E);E.appendChild(makeElement("h2","Error connecting to track hub"));E.appendChild(makeElement("p",h));H="reset-hub"}else{var m=null,p=null,q;for(q in e.genomes){var r=null,u=!1;if(q==t.coordSystem.ucscName)u=!0;else for(var v in t.chains)q==t.chains[v].coords.ucscName&&(r=v,u=!0);u&&(hc={url:a,genome:q},c.credentials&&(hc.credentials=!0),r&&(hc.mapping=r,e.genomes[q].mapping=
r),t.hubs.push(hc),t.hubObjects.push(e.genomes[q]),u=F(e.genomes[q]),J.appendChild(u),r&&m||(m=e.genomes[q],p=u))}m?(t.notifyTier(),activateButton(s,p),m.getTracks(function(a,c){b(a)})):(removeChildren(E),E.appendChild(makeElement("h2","No data for this genome")),E.appendChild(makeElement("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),E.appendChild(makeElement("p","coordSystem.ucscName = "+t.coordSystem.ucscName)),H="reset-hub")}},
c)}function m(a,b){var c=a.uri;if(b){var d=/(.+)\/[^\/]+\/?/.exec(c);d&&(c=d[1]+"/sources")}(new DASRegistry(c,{credentials:a.credentials})).sources(function(c){if(!c||0==c.length)return b?V(a):m(a,!0);var d=null;if(1==c.length)d=c[0];else for(var e=0;e<c.length;++e)if(c[e].uri===a.uri){d=c[e];break}e=c=!1;if(d&&(a.name=d.name,a.desc=d.desc,a.maxbins=d.maxbins?!0:!1,d.capabilities&&(a.capabilities=d.capabilities),e=!0,d.coords&&1==d.coords.length))if(d=d.coords[0],coordsMatch(d,t.coordSystem))c=!0;
else if(t.chains)for(var h in t.chains)coordsMatch(d,t.chains[h].coords)&&(a.mapping=h,c=!0);return V(a,c,e)},function(){return b?V(a):m(a,!0)})}function p(a){P.style.display="none";R.style.display="inline";S.style.display="inline";removeChildren(E);H="prompt-bai";E.appendChild(makeElement("h2","Select an index file"));E.appendChild(makeElement("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file"));
E.appendChild(document.createTextNode("Index file: "));O=makeElement("input",null,{type:"file"});E.appendChild(O);M=a}function q(a){(a.baiBlob?new BlobFetchable(a.baiBlob):new URLFetchable(a.bwgURI+".bai")).slice(0,256).fetch(function(b){var c=!1;b&&(b=new Uint8Array(b),c=readInt(b,0)==BAI_MAGIC);if(c){if(b=/\/?([^/]+?)(.bam)?$/.exec(a.bwgURI||a.bwgBlob.name))a.name=b[1];a.bamURI=a.bwgURI;a.bamBlob=a.bwgBlob;a.bwgURI=void 0;a.bwgBlob=void 0;return V(a,!1,!1,!0)}return r("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}
function r(a){P.style.display="none";R.style.display="inline";S.style.display="inline";removeChildren(E);a=a||"Custom data format not recognized";E.appendChild(makeElement("h2","Error adding custom data"));E.appendChild(makeElement("p",a));E.appendChild(makeElement("p","Currently supported formats are bigBed, bigWig, and BAM."));H="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var t=this;a=makeElement("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",
boxSizing:"border-box",MozBoxSizing:"border-box",verticalAlign:"top"});var s=[],v,u,z=this.makeButton("Registry","Browse compatible datasources from the DAS registry");s.push(z);for(var w in this.mappableSources)(function(a){var b=t.makeButton(t.chains[a].srcTag,"Browse datasources mapped from "+t.chains[a].srcTag);s.push(b);b.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();activateButton(s,b);v(t.mappableSources[a],a)},!1)})(w);w={};for(var x=0;x<this.defaultSources.length;++x){var A=
this.defaultSources[x],B=A.group||"Defaults";w[B]?w[B].push(A):w[B]=[A]}var F=function(a){var c=a.hub,e=makeElement("i",null,{className:"fa fa-times"}),h=c.shortLabel||"Unknown";a.mapping&&(h=h+" ("+a.genome+")");var h=makeElement("span",[h," ",e]),l=t.makeButton(h,c.longLabel);s.push(l);l.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();activateButton(s,l);removeChildren(E);E.appendChild(makeElement("div",makeElement("img",null,{src:t.uiPrefix+"img/loader.gif"},{marginLeft:"auto",
marginRight:"auto",marginTop:"100px"}),null,{textAlign:"center"}));P.style.display="none";R.style.display="none";S.style.display="none";a.getTracks(function(a,c){c&&console.log(c);b(a)})},!1);e.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();for(b=0;b<t.hubObjects.length;++b)if(t.hubObjects[b].absURL=a.absURL){t.hubObjects.splice(b,1);break}t.notifyTier();J.removeChild(l);activateButton(s,C);d()},!1);return l};for(B in w)(function(a,b){var c=t.makeButton(a,"Browse the default set of data for this browser");
c.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();activateButton(s,c);v(new Observed(b))},!1);s.push(c)})(B,w[B]);var D=this.makeButton("Custom","Add arbitrary DAS data");s.push(D);var G=this.makeButton("Binary","Add data in bigwig or bigbed format");s.push(G);for(B=0;B<this.hubObjects.length;++B)F(this.hubObjects[B]);var C=this.makeButton("+","Connect to a new track-hub");s.push(C);activateButton(s,z);var J=makeElement("ul",s,{className:"nav nav-tabs"},{marginBottom:"0px"});
a.appendChild(J);var I,N,L,K,O,Q,T,H=!1,M=null,B=makeElement("form",null,{},{display:"inline-block",width:"100%"});B.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();h();return!1},!0);var E=makeElement("div");E.style.position="relative";E.style.overflow="scroll";B.appendChild(E);var U,W;v=function(a,b){P.style.display="none";R.style.display="none";S.style.display="none";W&&W.removeListener(u);U=b;W=a;W.addListenerAndFire(u)};u=function(a){H=!1;var b=[];removeChildren(E);
if(a){for(var c=makeElement("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),d=makeElement("table",c,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),e=0,h=[],l=0;l<a.length;++l)h.push(a[l]);h.sort(function(a,b){return a.name.toLowerCase().trim().localeCompare(b.name.toLowerCase().trim())});for(l=0;l<h.length;++l){a=h[l];var m=makeElement("tr"),p=makeElement("td",null,{},{width:"30px"});p.style.textAlign="center";if(!a.props||a.props.cors){var q=
makeElement("input");q.type="checkbox";q.dalliance_source=a;U&&(q.dalliance_mapping=U);p.appendChild(q);b.push(q);q.addEventListener("change",function(a){a.target.checked?t.addTier(a.target.dalliance_source):t.removeTier(a.target.dalliance_source)})}else p.appendChild(document.createTextNode("!")),t.makeTooltip(p,makeElement("span",["This data source isn't accessible because it doesn't support ",makeElement("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));m.appendChild(p);p=makeElement("td");
p.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&t.makeTooltip(p,a.desc);m.appendChild(p);c.appendChild(m);++e}var r=function(){for(var a=0;a<b.length;++a){var c=b[a],d=t.currentlyActive(c.dalliance_source);d?(c.checked=!0,c.disabled=null!=d.sequenceSource):c.checked=!1}};r();t.addTierListener(function(a){r()});E.appendChild(d)}else E.appendChild(makeElement("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};z.addEventListener("click",
function(a){a.preventDefault();a.stopPropagation();activateButton(s,z);v(t.availableSources)},!1);G.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c()},!1);C.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();d()},!1);D.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();e()},!1);var R=makeElement("button","Add",{className:"btn btn-primary"});R.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();
h()},!1);var X=function(a,b){var c=t.knownSpace;if(c){var d=Math.max(c.min,(c.min+c.max-100)/2)|0,c=new DASSegment(c.chr,d,Math.min(d+99,c.max));a.features(c,{},function(c,d){if(d)b?(removeChildren(E),E.appendChild(makeElement("h2","Custom data not found")),E.appendChild(makeElement("p","DAS uri: "+a.uri+" is not answering features requests")),H="reset"):(dlog("retrying with credentials"),a.credentials=!0,X(a,!0));else{var e=/\/([^/]+)\/?$/.exec(a.uri);e&&(a.name=e[1]);m(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},
Y=function(a,b){(a.bwgURI?new URLFetchable(a.bwgURI,null,null,{credentials:a.credentials}):new BlobFetchable(a.bwgBlob)).slice(0,65536).salted().fetch(function(c,d){if(c){var e=new Uint8Array(c),h=readInt(e,0);if(h==BIG_WIG_MAGIC||h==BIG_BED_MAGIC){if(e=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/.exec(a.bwgURI||a.bwgBlob.name))a.name=e[1];return V(a,!1,!1,!0)}if(31!=e[0]||139!=e[1])return r();e=unbgzf(c);e=new Uint8Array(e);h=readInt(e,0);return h==BAM_MAGIC?a.bwgBlob?p(a):q(a):r()}b||(a.credentials=
!0,Y(a,!0));removeChildren(E);E.appendChild(makeElement("h2","Custom data not found"));a.bwgURI?E.appendChild(makeElement("p","Data URI: "+a.bwgURI+" is not accessible.")):E.appendChild(makeElement("p","File access failed, are you using an up-to-date browser?"));d&&E.appendChild(makeElement("p",""+d));E.appendChild(makeElement("p","If in doubt, please check that the server where the file is hosted supports CORS."));H="reset-bin"})},V=function(a,b,c,d){P.style.display="none";R.style.display="inline";
S.style.display="inline";removeChildren(E);E.appendChild(makeElement("h2","Add custom data: step 2"));E.appendChild(document.createTextNode("Label: "));N=makeElement("input","",{value:a.name});E.appendChild(N);Q=makeElement("input","");T=makeElement("input","");E.appendChild(makeElement("br"));E.appendChild(makeElement("br"));E.appendChild(makeElement("h4","Coordinate system: "));L=makeElement("select",null);L.appendChild(makeElement("option",t.coordSystem.auth+t.coordSystem.version,{value:"__default__"}));
if(t.chains)for(var e in t.chains){var h=t.chains[e].coords;L.appendChild(makeElement("option",h.auth+h.version,{value:e}))}L.value=a.mapping||"__default__";E.appendChild(L);b?E.appendChild(makeElement("p","(Based on server response, probably doesn't need changing.)")):(E.appendChild(makeElement("p",[makeElement("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),E.appendChild(makeElement("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));
d||(E.appendChild(document.createTextNode("Quantitative: ")),K=makeElement("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(K.checked=a.maxbins),E.appendChild(K),c?E.appendChild(makeElement("p","(Based on server response, probably doesn't need changing.)")):E.appendChild(makeElement("p",[makeElement("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&E.appendChild(makeElement("p",[makeElement("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));
N.focus();H="bin"===H||"prompt-bai"===H?"finalize-bin":"finalize";M=a},S=makeElement("button","Cancel",{className:"btn"});S.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===H?c():e()},!1);var P=makeElement("button","Refresh",{className:"btn"});P.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();t.queryRegistry(U)},!1);this.makeTooltip(P,"Click to re-fetch data from the DAS registry");w=makeElement("div",[R," ",S," ",P]);w.style.margin=
"10px";B.appendChild(w);a.appendChild(B);v(t.availableSources);this.showToolPanel(a);this.setUiMode("add")}};var TWOBIT_MAGIC=440477507;function TwoBitFile(){}
function makeTwoBit(a,b){var c=new TwoBitFile;c.data=a;c.data.slice(0,1024).fetch(function(a){if(!a)return b(null,"Couldn't access data");a=new Uint8Array(a);if(readInt(a,0)!=TWOBIT_MAGIC)return b(null,"Not a .2bit fie");var e=readInt(a,4);if(0!=e)return b(null,"Unsupported version "+e);c.seqCount=readInt(a,8);c.seqDict={};for(var e=16,h=0;h<c.seqCount;++h){for(var l=a[e++],m="",p=1;p<=l;++p)m+=String.fromCharCode(a[e++]);l=readInt(a,e);e+=4;c.seqDict[m]=new TwoBitSeq(c,l)}return b(c)})}
TwoBitFile.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};TwoBitFile.prototype.fetch=function(a,b,c,d){var e=this.getSeq(a);if(e)e.fetch(b,c,d);else return d(null,"Couldn't find "+a)};function TwoBitSeq(a,b){this.tbf=a;this.offset=b}
TwoBitSeq.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,8).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);b._length=readInt(c,0);b.nBlockCnt=readInt(c,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);for(var e=null,h=0;h<b.nBlockCnt;++h)var l=readInt(c,4*h),m=readInt(c,4*(h+b.nBlockCnt)),l=new Range(l,l+m-1),e=e?union(e,l):l;b.nBlocks=e;b.mBlockCnt=readInt(c,8*b.nBlockCnt);
b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+b.mBlockCnt);return a()})})};var TWOBIT_TABLE=["T","C","A","G"];
TwoBitSeq.prototype.fetch=function(a,b,c){--a;--b;var d=this;this.init(function(e){if(e)return c(null,e);var h=a>>2;e=b+3>>2;if(0>h||e>d.seqLength)return c("Coordinates out of bounds: "+a+":"+b);d.tbf.data.slice(d.seqOffset+h,e-h).fetch(function(e){function m(a){for(;t<=a;){var b=t&3,c=p[(t>>2)-h];r+=TWOBIT_TABLE[0==b?c>>6&3:1==b?c>>4&3:2==b?c>>2&3:c&3];++t}}if(null==e)return c("SeqFetch failed");var p=new Uint8Array(e);e=[];if(d.nBlocks){var q=intersection(new Range(a,b),d.nBlocks);q&&(e=q.ranges())}for(var r=
"",t=a,q=0;q<e.length;++q){var s=e[q];if(t>s.min())throw"N mismatch...";for(t<s.min()&&m(s.min()-1);t<s.max();)r+="N",++t}t<b&&m(b);return c(r)})})};TwoBitSeq.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b._length)})};var NUM_REGEXP=/[0-9]+/;function stringToNumbersArray(a){for(var b=[],c;c=NUM_REGEXP.exec(a);)b.push(c[0]),a=a.substring(c.index+c[0].length);return b}var STRICT_NUM_REGEXP=/^[0-9]+$/;
function stringToInt(a){a=a.replace(RegExp(",","g"),"");return STRICT_NUM_REGEXP.test(a)?a|0:null}function pushnew(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function pusho(a,b,c){a[b]?a[b].push(c):a[b]=[c]}function pushnewo(a,b,c){var d=a[b];if(d){for(a=0;a<d.length;++a)if(d[a]==c)return;d.push(c)}else a[b]=[c]}function pick(a,b,c,d){if(a)return a;if(b)return b;if(c)return c;if(d)return d}function pushnew(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}
function maybeConcat(a,b){var c=[];if(a)for(var d=0;d<a.length;++d)pushnew(c,a[d]);if(b)for(d=0;d<b.length;++d)pushnew(c,b[d]);return c}function arrayIndexOf(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function arrayRemove(a,b){var c=arrayIndexOf(a,b);return 0<=c?(a.splice(c,1),!0):!1}
function makeElement(a,b,c,d){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var e=0;e<b.length;++e){var h=b[e];"string"==typeof h&&(h=document.createTextNode(h));a.appendChild(h)}}if(c)for(var l in c)a[l]=c[l];if(d)for(l in d)a.style[l]=d[l];return a}function makeElementNS(a,b,c,d){a=document.createElementNS(a,b);if(c)for(c instanceof Array||(c=[c]),b=0;b<c.length;++b){var e=c[b];"string"==typeof e&&(e=document.createTextNode(e));a.appendChild(e)}setAttrs(a,d);return a}
var attr_name_cache={};function setAttr(a,b,c){var d=attr_name_cache[b];if(!d){for(var d="",e=0;e<b.length;++e)var h=b.substring(e,e+1),l=h.toLowerCase(),d=l!=h?d+"-"+l:d+h;attr_name_cache[b]=d}a.setAttribute(d,c)}function setAttrs(a,b){if(b)for(var c in b)setAttr(a,c,b[c])}function removeChildren(a){if(a&&a.childNodes)for(;0<a.childNodes.length;)a.removeChild(a.firstChild)}
function miniJSONify(a,b){if("undefined"===typeof a)return"undefined";if(null==a)return"null";if("string"==typeof a)return"'"+a+"'";if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a){if(a instanceof Array){for(var c=null,d=0;d<a.length;++d)c=(null==c?"":c+", ")+miniJSONify(a[d],b);return"["+(c?c:"")+"]"}b=b||{};c=null;for(d in a)b[d]||void 0!=d&&"function"!=typeof a[d]&&(c=(null==c?"":c+", ")+d+": "+miniJSONify(a[d],b));return"{"+(c?c:"")+"}"}return typeof a}
function shallowCopy(a){n={};for(k in a)n[k]=a[k];return n}function Observed(a){this.value=a;this.listeners=[]}Observed.prototype.addListener=function(a){this.listeners.push(a)};Observed.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};Observed.prototype.removeListener=function(a){arrayRemove(this.listeners,a)};Observed.prototype.get=function(){return this.value};Observed.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};
function Awaited(){this.queue=[]}Awaited.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};Awaited.prototype.await=function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};__dalliance_saltSeed=0;function saltURL(a){return a+"?salt="+b64_sha1(""+Date.now()+","+ ++__dalliance_saltSeed)}
function textXHR(a,b,c){c.salt&&(a=saltURL(a));var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(300<=d.status?b(null,"Error code "+d.status):b(d.responseText))};d.open("GET",a,!0);d.responseType="text";c&&c.credentials&&(d.withCredentials=!0);d.send("")}function relativeURL(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;var c=a.lastIndexOf("/");return 0<=c?a.substr(0,c+1)+b:b}
"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});var VERSION={CONFIG:4,MAJOR:0,MINOR:10,MICRO:5,PATCH:"",BRANCH:"dev",toString:function(){var a=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(a+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(a=a+"-"+this.BRANCH);return a}};function formatLongInt(a){return(a|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}
Browser.prototype.initUI=function(a,b){document.head.appendChild(makeElement("link","",{rel:"stylesheet",href:this.uiPrefix+"css/bootstrap-scoped.css"}));document.head.appendChild(makeElement("link","",{rel:"stylesheet",href:this.uiPrefix+"css/dalliance-scoped.css"}));document.head.appendChild(makeElement("link","",{rel:"stylesheet",href:this.uiPrefix+"css/font-awesome.min.css"}));var c=this;c.disableDefaultFeaturePopup||this.addFeatureListener(function(a,b,d,e){c.featurePopup(a,b,d,e);updateMolgenisTable(molgenisUrl,
c.chr,d[0])});a.classList.add("dalliance");var d=makeElement("div",null,{className:"btn-toolbar toolbar"}),e=c.coordSystem.speciesName+" "+c.coordSystem.auth+c.coordSystem.version;this.setDocumentTitle&&(document.title=e+" :: dalliance");var h=makeElement("input","",{className:"loc-field"});c.makeTooltip(h,"Enter a genomic location or gene name");var l=makeElement("p","",{className:"loc-status"}),m=makeElement("a",[makeElement("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),p=makeElement("input",
"",{type:"range",min:100,max:250},{className:"zoom-slider"}),q=makeElement("a",[makeElement("i",null,{className:"fa fa-search-minus"})],{className:"btn"}),r=makeElement("a",[makeElement("i",null,{className:"fa fa-plus"})],{className:"btn"}),t=makeElement("a",[makeElement("i",null,{className:"fa fa-bookmark"})],{className:"btn"}),s=makeElement("a",[makeElement("i",null,{className:"fa fa-print"})],{className:"btn"});makeElement("a",[makeElement("i",null,{className:"fa fa-refresh"})],{className:"btn"});
var v=makeElement("a",[makeElement("i",null,{className:"fa fa-cogs"})],{className:"btn"}),u=makeElement("a",[makeElement("i",null,{className:"fa fa-question"})],{className:"btn"}),z=makeElement("a",[makeElement("i",null,{className:"fa fa-road"})],{className:"btn"});c.makeTooltip(z,"Configure currently selected track(s) (E)");var w=makeElement("a",[makeElement("i",null,{className:"fa fa-chevron-left"})],{className:"btn"}),x=makeElement("a",[makeElement("i",null,{className:"fa fa-chevron-right"})],
{className:"btn pull-right"}),A=makeElement("div",[r,z,s,v,u],{className:"btn-group pull-right"});this.setUiMode=function(a){this.uiMode=a;var b={help:u,add:r,opts:v,"export":s,tier:z},c;for(c in b)c==a?b[c].classList.add("active"):b[c].classList.remove("active")};d.appendChild(x);d.appendChild(A);d.appendChild(w);this.noTitle||d.appendChild(makeElement("div",makeElement("h4",e,{},{margin:"0px"}),{className:"btn-group title"}));d.appendChild(makeElement("div",[h,l],{className:"btn-group loc-group"}));
d.appendChild(makeElement("div",[m,makeElement("span",p,{className:"btn"}),q],{className:"btn-group"}));a.appendChild(d);a.appendChild(b);this.addViewListener(function(a,b,d,e,l){h.value=a+":"+formatLongInt(b)+".."+formatLongInt(d);p.min=l.min;p.max=l.max;p.value=l.current;c.storeStatus&&c.storeViewStatus()});this.addTierListener(function(){c.storeStatus&&c.storeTierStatus()});h.addEventListener("keydown",function(a){40==a.keyCode&&(a.preventDefault(),a.stopPropagation(),c.setSelectedTier(0));if(10==
a.keyCode||13==a.keyCode)if(a.preventDefault(),a=h.value.split(":",3),2==a.length)if(-1!=a[1].indexOf("..")){var b=a[1].split(".."),d=b[0].replace(/,/g,""),b=b[1].replace(/,/g,"");parseInt(d,10)<parseInt(b,10)&&c.setLocation(a[0],d,b)}else-1!=a[1].indexOf(";")?(b=a[1].split(";"),d=b[0].replace(/,/g,""),b=b[1].replace(/,/g,""),parseInt(d,10)<parseInt(b,10)&&c.setLocation(a[0],d,b)):c.setLocation(a[0],a[1].replace(/,/g,""))},!1);this.addRegionSelectListener(function(a,b,c){});this.addTierListener(function(){c.storeStatus&&
c.storeStatus()});var B;r.addEventListener("click",function(a){B&&B.displayed?c.removeAllPopups():B=c.showTrackAdder(a)},!1);c.makeTooltip(r,"Add a new track from the registry or an indexed file. (A)");m.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.zoomStep(-10)},!1);c.makeTooltip(m,"Zoom in (+)");q.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.zoomStep(10)},!1);c.makeTooltip(q,"Zoom out (-)");p.addEventListener("change",function(a){c.zoomSliderValue=
1*p.value;c.zoom(Math.exp(1*p.value/c.zoomExpt))},!1);p.min=c.zoomMin;p.max=c.zoomMax;t.addEventListener("click",function(a){a.stopPropagation();a.preventDefault()},!1);c.makeTooltip(t,"Favourite regions");s.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.openExportPanel()},!1);c.makeTooltip(s,"Export publication-quality SVG.");v.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.toggleOptsPopup(a)},!1);c.makeTooltip(v,"Configure options.");
u.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.toggleHelpPopup(a)});c.makeTooltip(u,"Help; Keyboard shortcuts. (H)");z.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();1==c.selectedTiers.length&&c.openTierPanel(c.tiers[c.selectedTiers[0]])},!1);w.addEventListener("click",function(a){c.leap(c.reverseKeyScrolling?1:-1,!1)},!1);x.addEventListener("click",function(a){c.leap(c.reverseKeyScrolling?-1:1,!1)},!1);c.addTierSelectionWrapListener(function(a){0>
a&&(c.setSelectedTier(null),h.focus())});c.addTierSelectionListener(function(a){"tier"===c.uiMode&&(0==a.length?(c.hideToolPanel(),c.manipulatingTier=null,c.uiMode="none"):(a=c.tiers[a[0]],a!=c.manipulatingTier&&c.openTierPanel(a)))});updateMolgenisTable(molgenisUrl,c.chr,null);var F=function(a){if(65==a.keyCode||97==a.keyCode)a.preventDefault(),a.stopPropagation(),c.showTrackAdder();else if(72==a.keyCode||104==a.keyCode)a.stopPropagation(),a.preventDefault(),c.toggleHelpPopup(a);else if(69==a.keyCode||
101==a.keyCode)a.stopPropagation(),a.preventDefault(),1==c.selectedTiers.length&&c.openTierPanel(c.tiers[c.selectedTiers[0]])};a.addEventListener("focus",function(b){a.addEventListener("keydown",F,!1)},!1);a.addEventListener("blur",function(b){a.removeEventListener("keydown",F,!1)},!1);a.addEventListener("keydown",function(a){27===a.keyCode&&(a.preventDefault(),a.stopPropagation(),c.uiMode="none",c.hideToolPanel(),c.selectedTiers&&0<c.selectedTiers.length&&c.browserHolder.focus())},!1)};
Browser.prototype.showToolPanel=function(a,b){this.activeToolPanel&&this.svgHolder.removeChild(this.activeToolPanel);var c;c=b?a:makeElement("div",a,{},{overflowY:"auto",width:"100%"});this.activeToolPanel=makeElement("div",[makeElement("div",null,{className:"tool-divider"}),c],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer()};
Browser.prototype.hideToolPanel=function(){this.activeToolPanel&&this.svgHolder.removeChild(this.activeToolPanel);this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};Browser.prototype.toggleHelpPopup=function(a){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(a=makeElement("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.uiPrefix+"help/index.html",seamless:"seamless",className:"help-panel"}),this.showToolPanel(a,!0),this.setUiMode("help"))};
Browser.prototype.toggleOptsPopup=function(a){var b=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{a=makeElement("div",null,{className:"form-horizontal"},{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var c=makeElement("table");c.cellPadding=5;var d=makeElement("input","",{type:"checkbox",checked:b.reverseScrolling});d.addEventListener("change",function(a){b.reverseScrolling=d.checked;b.storeStatus()},!1);c.appendChild(makeElement("tr",
[makeElement("td","Reverse trackpad scrolling",{align:"right"}),makeElement("td",d)]));var e=makeElement("input","",{type:"checkbox",checked:b.reverseKeyScrolling});e.addEventListener("change",function(a){b.reverseKeyScrolling=e.checked;b.storeStatus()},!1);c.appendChild(makeElement("tr",[makeElement("td","Reverse scrolling buttons and keys",{align:"right"}),makeElement("td",e)]));var h=makeElement("select");h.appendChild(makeElement("option","Left",{value:"left"}));h.appendChild(makeElement("option",
"Center",{value:"center"}));h.appendChild(makeElement("option","Right",{value:"right"}));h.appendChild(makeElement("option","None",{value:"none"}));h.value=b.rulerLocation;h.addEventListener("change",function(a){b.rulerLocation=h.value;b.positionRuler();for(a=0;a<b.tiers.length;++a)b.tiers[a].paintQuant();b.storeStatus()},!1);c.appendChild(makeElement("tr",[makeElement("td","Vertical guideline",{align:"right"}),makeElement("td",h)]));a.appendChild(c);c=makeElement("button","Reset browser",{className:"btn"},
{marginLeft:"auto",marginRight:"auto",display:"block"});c.addEventListener("click",function(a){b.reset()},!1);a.appendChild(c);this.showToolPanel(a);this.setUiMode("opts")}};function BoxGlyph(a,b,c,d,e,h,l,m){this.x=a;this.y=b;this._width=c;this._height=d;this.fill=e;this.stroke=h;this._alpha=l;this._radius=m||0}
BoxGlyph.prototype.draw=function(a){var b=this._radius;a.beginPath();0<b?(a.moveTo(this.x+b,this.y),a.lineTo(this.x+this._width-b,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+b,b),a.lineTo(this.x+this._width,this.y+this._height-b),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-b,this.y+this._height,b),a.lineTo(this.x+b,this.y+this._height),a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-b,b),a.lineTo(this.x,this.y+b),a.arcTo(this.x,this.y,this.x+
b,this.y,b)):(a.lineJoin="miter",a.lineCap="square",a.moveTo(this.x,this.y),a.lineTo(this.x+this._width,this.y),a.lineTo(this.x+this._width,this.y+this._height),a.lineTo(this.x,this.y+this._height),a.lineTo(this.x,this.y));a.closePath();null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha);this.fill&&(a.fillStyle=this.fill,a.fill());this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.stroke());null!=this._alpha&&a.restore()};
BoxGlyph.prototype.toSVG=function(){var a=makeElementNS(NS_SVG,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",strokeWidth:0.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};BoxGlyph.prototype.min=function(){return this.x};BoxGlyph.prototype.max=function(){return this.x+this._width};BoxGlyph.prototype.height=function(){return this.y+this._height};
function GroupGlyph(a,b){this.glyphs=a;this.connector=b;this.h=a[0].height();var c=new Range(a[0].min(),a[0].max());for(g=1;g<a.length;++g){var d=a[g],c=union(c,new Range(d.min(),d.max()));this.h=Math.max(this.h,d.height())}this.coverage=c}
GroupGlyph.prototype.draw=function(a){for(var b=0;b<this.glyphs.length;++b){var c=this.glyphs[b];c.draw(a)}for(var b=this.coverage.ranges(),d=1;d<b.length;++d){var c=b[d],e=b[d-1];if(e&&c.min()>e.max()){var e=e.max(),c=c.min(),h=(e+c)/2;a.beginPath();"hat+"===this.connector?(a.moveTo(e,this.h/2),a.lineTo(h,0),a.lineTo(c,this.h/2)):"hat-"===this.connector?(a.moveTo(e,this.h/2),a.lineTo(h,this.h),a.lineTo(c,this.h/2)):"collapsed+"===this.connector?(a.moveTo(e,this.h/2),a.lineTo(c,this.h/2),4<c-e&&(a.moveTo(h-
2,this.h/2-5),a.lineTo(h+2,this.h/2),a.lineTo(h-2,this.h/2+5))):"collapsed-"===this.connector?(a.moveTo(e,this.h/2),a.lineTo(c,this.h/2),4<c-e&&(a.moveTo(h+2,this.h/2-5),a.lineTo(h-2,this.h/2),a.lineTo(h+2,this.h/2+5))):(a.moveTo(e,this.h/2),a.lineTo(c,this.h/2));a.stroke()}}};function SVGPath(){this.ops=[]}SVGPath.prototype.moveTo=function(a,b){this.ops.push("M "+a+" "+b)};SVGPath.prototype.lineTo=function(a,b){this.ops.push("L "+a+" "+b)};SVGPath.prototype.closePath=function(){this.ops.push("Z")};
SVGPath.prototype.toPathData=function(){return this.ops.join(" ")};
GroupGlyph.prototype.toSVG=function(){for(var a=makeElementNS(NS_SVG,"g"),b=0;b<this.glyphs.length;++b)a.appendChild(this.glyphs[b].toSVG());for(var b=this.coverage.ranges(),c=1;c<b.length;++c){var d=b[c],e=b[c-1];if(e&&d.min()>e.max()){var e=e.max(),d=d.min(),h=(e+d)/2,l=new SVGPath;"hat+"===this.connector?(l.moveTo(e,this.h/2),l.lineTo(h,0),l.lineTo(d,this.h/2)):"hat-"===this.connector?(l.moveTo(e,this.h/2),l.lineTo(h,this.h),l.lineTo(d,this.h/2)):"collapsed+"===this.connector?(l.moveTo(e,this.h/
2),l.lineTo(d,this.h/2),4<d-e&&(l.moveTo(h-2,this.h/2-5),l.lineTo(h+2,this.h/2),l.lineTo(h-2,this.h/2+5))):"collapsed-"===this.connector?(l.moveTo(e,this.h/2),l.lineTo(d,this.h/2),4<d-e&&(l.moveTo(h+2,this.h/2-5),l.lineTo(h-2,this.h/2),l.lineTo(h+2,this.h/2+5))):(l.moveTo(e,this.h/2),l.lineTo(d,this.h/2));e=makeElementNS(NS_SVG,"path",null,{d:l.toPathData(),fill:"none",stroke:"black",strokeWidth:0.5});a.appendChild(e)}}return a};GroupGlyph.prototype.min=function(){return this.coverage.min()};
GroupGlyph.prototype.max=function(){return this.coverage.max()};GroupGlyph.prototype.height=function(){return this.h};function LineGraphGlyph(a,b,c){this.points=a;this.color=b;this._height=c||50}LineGraphGlyph.prototype.min=function(){return this.points[0]};LineGraphGlyph.prototype.max=function(){return this.points[this.points.length-2]};LineGraphGlyph.prototype.height=function(){return this._height};
LineGraphGlyph.prototype.draw=function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var b=0;b<this.points.length;b+=2){var c=this.points[b],d=this.points[b+1];0==b?a.moveTo(c,d):a.lineTo(c,d)}a.stroke();a.restore()};LineGraphGlyph.prototype.toSVG=function(){for(var a=new SVGPath,b=0;b<this.points.length;b+=2){var c=this.points[b],d=this.points[b+1];0==b?a.moveTo(c,d):a.lineTo(c,d)}return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};
function LabelledGlyph(a,b,c,d,e,h){this.glyph=a;this.text=b;this.anchor=d||"left";this.align=e||"below";h&&(this.font=h);this.font&&(GLOBAL_GC.save(),GLOBAL_GC.font=this.font);b=GLOBAL_GC.measureText(b);this.font&&GLOBAL_GC.restore();this.textLen=b.width;this.textHeight=5;this.bump=a.bump;this.measured=!c}
LabelledGlyph.prototype.toSVG=function(){var a=this.glyph.toSVG(),b={};"above"==this.align?(a=makeElementNS(NS_SVG,"g",a,{transform:"translate(0, "+(this.textHeight|2)+")"}),b.y=this.textHeight):b.y=this.glyph.height()+15;this.font&&(b.fontSize=7);b.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return makeElementNS(NS_SVG,"g",[a,makeElementNS(NS_SVG,"text",this.text,b)])};LabelledGlyph.prototype.min=function(){return this.glyph.min()};
LabelledGlyph.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};LabelledGlyph.prototype.height=function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+2):a+20);return a};
LabelledGlyph.prototype.draw=function(a){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();a.fillStyle="black";this.font&&(a.save(),a.font=this.font);var b;b="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();a.fillText(this.text,b,"above"==this.align?this.textHeight:this.glyph.height()+15);this.font&&a.restore()};function CrossGlyph(a,b,c){this._x=a;this._height=b;this._stroke=c}
CrossGlyph.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-b,b);a.lineTo(this._x+b,b);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};CrossGlyph.prototype.toSVG=function(){var a=this._height/2,b=new SVGPath;b.moveTo(this._x,0);b.lineTo(this._x,this._height);b.moveTo(this._x-a,a);b.lineTo(this._x+a,a);return makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};
CrossGlyph.prototype.min=function(){return this._x-this._height/2};CrossGlyph.prototype.max=function(){return this._x+this._height/2};CrossGlyph.prototype.height=function(){return this._height};function ExGlyph(a,b,c){this._x=a;this._height=b;this._stroke=c}ExGlyph.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x-b,0);a.lineTo(this._x+b,this._height);a.moveTo(this._x-b,this._height);a.lineTo(this._x+b,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};
ExGlyph.prototype.toSVG=function(){var a=this._height/2,b=new SVGPath;b.moveTo(this._x-a,0);b.lineTo(this._x+a,this._height);b.moveTo(this._x-a,this._height);b.lineTo(this._x+a,0);return makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};ExGlyph.prototype.min=function(){return this._x-this._height/2};ExGlyph.prototype.max=function(){return this._x+this._height/2};ExGlyph.prototype.height=function(){return this._height};
function PathGlyphBase(a,b){this._stroke=a;this._fill=b}PathGlyphBase.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};PathGlyphBase.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||"none"})};
PathGlyphBase.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};function TriangleGlyph(a,b,c,d,e,h){PathGlyphBase.call(this,h,e);this._x=a;this._height=b;this._dir=c;this._width=d}TriangleGlyph.prototype=Object.create(PathGlyphBase.prototype);
TriangleGlyph.prototype.drawPath=function(a){var b=this._height/2,c=this._width/2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-c,0),a.lineTo(this._x+c,0)):"W"===this._dir?(a.moveTo(this._x+c,b),a.lineTo(this._x-c,0),a.lineTo(this._x-c,this._height)):"E"===this._dir?(a.moveTo(this._x-c,b),a.lineTo(this._x+c,0),a.lineTo(this._x+c,this._height)):(a.moveTo(this._x,0),a.lineTo(this._x+c,this._height),a.lineTo(this._x-c,this._height));a.closePath()};
TriangleGlyph.prototype.min=function(){return this._x-this._height/2};TriangleGlyph.prototype.max=function(){return this._x+this._height/2};TriangleGlyph.prototype.height=function(){return this._height};function DotGlyph(a,b,c,d){this._x=a;this._height=b;this._fill=c;this._stroke=d}DotGlyph.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};
DotGlyph.prototype.toSVG=function(){var a=this._height/2;return makeElementNS(NS_SVG,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};DotGlyph.prototype.min=function(){return this._x-this._height/2};DotGlyph.prototype.max=function(){return this._x+this._height/2};DotGlyph.prototype.height=function(){return this._height};function PaddedGlyph(a,b,c){this.glyph=a;this._min=b;this._max=c;a&&(this.bump=a.bump)}
PaddedGlyph.prototype.draw=function(a){this.glyph&&this.glyph.draw(a)};PaddedGlyph.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():makeElementNS(NS_SVG,"g")};PaddedGlyph.prototype.min=function(){return this._min};PaddedGlyph.prototype.max=function(){return this._max};PaddedGlyph.prototype.height=function(){return this.glyph?this.glyph.height():1};function AArrowGlyph(a,b,c,d,e,h){PathGlyphBase.call(this,e,d);this._min=a;this._max=b;this._height=c;this._ori=h}
AArrowGlyph.prototype=Object.create(PathGlyphBase.prototype);AArrowGlyph.prototype.min=function(){return this._min};AArrowGlyph.prototype.max=function(){return this._max};AArrowGlyph.prototype.height=function(){return this._height};
AArrowGlyph.prototype.drawPath=function(a){var b=this._max,c=this._min,d=this._height,e=0,h=0,l=this._height+2,m=0.333333*this._height;this._ori&&("+"===this._ori?h=0.5*this._height:"-"===this._ori&&(e=0.5*this._height));b-c<l&&(c=(b+c-l)/2,b=c+l);a.moveTo(c+e,0+m);a.lineTo(b-h,0+m);a.lineTo(b-h,0);a.lineTo(b,0+this._height/2);a.lineTo(b-h,0+d);a.lineTo(b-h,0+m+m);a.lineTo(c+e,0+m+m);a.lineTo(c+e,0+d);a.lineTo(c,0+d/2);a.lineTo(c+e,0);a.lineTo(c+e,0+m)};
function SpanGlyph(a,b,c,d){PathGlyphBase.call(this,d,null);this._min=a;this._max=b;this._height=c}SpanGlyph.prototype=Object.create(PathGlyphBase.prototype);SpanGlyph.prototype.min=function(){return this._min};SpanGlyph.prototype.max=function(){return this._max};SpanGlyph.prototype.height=function(){return this._height};SpanGlyph.prototype.drawPath=function(a){var b=this._min,c=this._max,d=this._height,e=d/2;a.moveTo(b,e);a.lineTo(c,e);a.moveTo(b,0);a.lineTo(b,d);a.moveTo(c,0);a.lineTo(c,d)};
function LineGlyph(a,b,c,d,e,h){this._min=a;this._max=b;this._height=c;this._style=d;this._strand=e;this._stroke=h}LineGlyph.prototype.min=function(){return this._min};LineGlyph.prototype.max=function(){return this._max};LineGlyph.prototype.height=function(){return this._height};LineGlyph.prototype.drawPath=function(a){var b=this._min,c=this._max,d=this._height,e=d/2;"hat"===this._style?(a.moveTo(b,e),a.lineTo((b+c)/2,"-"===this._strand?d:0)):a.moveTo(b,e);a.lineTo(c,e)};
LineGlyph.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};LineGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return makeElementNS(NS_SVG,"path",null,a)};
function PrimersGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._fill=d;this._stroke=e}PrimersGlyph.prototype.min=function(){return this._min};PrimersGlyph.prototype.max=function(){return this._max};PrimersGlyph.prototype.height=function(){return this._height};PrimersGlyph.prototype.drawStemPath=function(a){var b=this._max,c=this._height/2;a.moveTo(this._min,c);a.lineTo(b,c)};
PrimersGlyph.prototype.drawTrigsPath=function(a){var b=this._min,c=this._max,d=this._height,e=d/2;a.moveTo(b,0);a.lineTo(b+d,e);a.lineTo(b,d);a.lineTo(b,0);a.moveTo(c,0);a.lineTo(c-d,e);a.lineTo(c,d);a.lineTo(c,0)};PrimersGlyph.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};
PrimersGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawStemPath(a);var b=new SVGPath;this.drawTrigsPath(b);return makeElementNS(NS_SVG,"g",[makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:this._fill||"none"})])};function ArrowGlyph(a,b,c,d,e,h,l){PathGlyphBase.call(this,null,d);this._min=a;this._max=b;this._height=c;this._color=d;this._parallel=e;this._sw=h;this._ne=l}ArrowGlyph.prototype=Object.create(PathGlyphBase.prototype);
ArrowGlyph.prototype.min=function(){return this._min};ArrowGlyph.prototype.max=function(){return this._max};ArrowGlyph.prototype.height=function(){return this._height};
ArrowGlyph.prototype.drawPath=function(a){var b=this._min,c=this._max,d=this._height;if(this._parallel){var e=d/2,h=0.4*d;this._sw?(a.moveTo(b+e,d-h),a.lineTo(b+e,d),a.lineTo(b,e),a.lineTo(b+e,0),a.lineTo(b+e,h)):(a.moveTo(b,d-h),a.lineTo(b,h));this._ne?(a.lineTo(c-e,h),a.lineTo(c-e,0),a.lineTo(c,e),a.lineTo(c-e,d),a.lineTo(c-e,d-h)):(a.lineTo(c,h),a.lineTo(c,d-h))}else{var e=(b+c)/2,h=0.4*(c-b),l=d/3;this._ne?(a.moveTo(b+h,l),a.lineTo(b,l),a.lineTo(e,0),a.lineTo(c,l),a.lineTo(c-h,l)):(a.moveTo(b+
h,0),a.lineTo(c-h,0));this._sw?(a.lineTo(c-h,d-l),a.lineTo(c,d-l),a.lineTo(e,d),a.lineTo(b,d-l),a.lineTo(b+h,d-l)):(a.lineTo(c-h,d),a.lineTo(b+h,d))}a.closePath()};function TooManyGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._fill=d;this._stroke=e}TooManyGlyph.prototype.min=function(){return this._min};TooManyGlyph.prototype.max=function(){return this._max};TooManyGlyph.prototype.height=function(){return this._height};
TooManyGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};
TooManyGlyph.prototype.draw=function(a){this._fill&&(a.fillStyle=this._fill,a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var b=2;b<this._height;b+=3)a.moveTo(this._min,b),a.lineTo(this._max,b);a.stroke()}};function TextGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._fill=d;this._string=e;this._textLen=GLOBAL_GC.measureText(e).width}
TextGlyph.prototype.min=function(){return this._min};TextGlyph.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};TextGlyph.prototype.height=function(){return this._height};TextGlyph.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,this._min,this._height-4)};TextGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"text",this._string,{x:this._min,y:this._height-4})};
function SequenceGlyph(a,b,c,d,e,h,l){this._min=a;this._max=b;this._height=c;this._seq=d;this._ref=e;this._scheme=h;this._quals=l}SequenceGlyph.prototype.min=function(){return this._min};SequenceGlyph.prototype.max=function(){return this._max};SequenceGlyph.prototype.height=function(){return this._height};SequenceGlyph.prototype.alphaForQual=function(a){return 0.1+0.9*Math.max(0,Math.min(1*a/30,1))};
SequenceGlyph.prototype.draw=function(a){for(var b=this._seq,c=(this._max-this._min+1)/this._seq.length,d=0;d<b.length;++d){var e=b.substr(d,1).toUpperCase(),h=baseColors[e];h||(h="gray");"mismatch"===this._scheme&&this._ref&&(h=this._ref.substr(d,1).toUpperCase(),h="N"===h?"gray":h===e?"black":"red");a.fillStyle=h;this._quals&&(h=this._quals.charCodeAt(d)-33,a.save(),a.globalAlpha=this.alphaForQual(h));8<=c?a.fillText(e,this._min+d*c,8):a.fillRect(this._min+d*c,0,c,this._height);this._quals&&a.restore()}};
SequenceGlyph.prototype.toSVG=function(){for(var a=this._seq,b=(this._max-this._min+1)/this._seq.length,c=makeElementNS(NS_SVG,"g"),d=0;d<a.length;++d){var e=a.substr(d,1).toUpperCase(),h=baseColors[e];h||(h="gray");"mismatch"===this._scheme&&this._ref&&(h=this._ref.substr(d,1).toUpperCase(),h="N"===h?"gray":h===e?"black":"red");var l=1;this._quals&&(l=this._quals.charCodeAt(d)-33,l=this.alphaForQual(l));8<=b?c.appendChild(makeElementNS(NS_SVG,"text",e,{x:this._min+d*b,y:8,fill:h,fillOpacity:l})):
c.appendChild(makeElementNS(NS_SVG,"rect",null,{x:this._min+d*b,y:0,width:b,height:this._height,fill:h,fillOpacity:l}))}return c};function TranslatedGlyph(a,b,c,d){this.glyph=a;this._height=d;this._x=b;this._y=c}TranslatedGlyph.prototype.height=function(){return this._height?this._height:this.glyph.height()+this._y};TranslatedGlyph.prototype.min=function(){return this.glyph.min()+this._x};TranslatedGlyph.prototype.max=function(){return this.glyph.max()+this._x};TranslatedGlyph.prototype.minY=function(){return this._y};
TranslatedGlyph.prototype.maxY=function(){return this._y+this.glyph.height()};TranslatedGlyph.prototype.draw=function(a){a.save();a.translate(this._x,this._y);this.glyph.draw(a);a.restore()};TranslatedGlyph.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};function PointGlyph(a,b,c,d){this._x=a;this._y=b;this._height=c;this._fill=d}PointGlyph.prototype.min=function(){return this._x-2};
PointGlyph.prototype.max=function(){return this._x+2};PointGlyph.prototype.height=function(){return this._height};PointGlyph.prototype.draw=function(a){a.save();a.globalAlpha=0.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,1.5,0,6.29);a.fill();a.restore()};PointGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};function GridGlyph(a){this._height=a||50}GridGlyph.prototype.notSelectable=!0;
GridGlyph.prototype.min=function(){return-1E5};GridGlyph.prototype.max=function(){return 1E5};GridGlyph.prototype.height=function(){return this._height};GridGlyph.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var b=0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,b);a.stroke();a.restore()};
GridGlyph.prototype.toSVG=function(){for(var a=new SVGPath,b=0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,b);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};function StarGlyph(a,b,c,d,e){PathGlyphBase.call(this,e,d);this._x=a;this._r=b;this._points=c}StarGlyph.prototype=Object.create(PathGlyphBase.prototype);StarGlyph.prototype.min=function(){return this._x-this._r};StarGlyph.prototype.max=function(){return this._x+this._r};
StarGlyph.prototype.height=function(){return 2*this._r};StarGlyph.prototype.drawPath=function(a){for(var b=this._x,c=this._r,d=this._r,e=0;e<this._points;++e){var h=6.28*e/this._points,l=b+d*Math.sin(h),h=c-d*Math.cos(h);0==e?a.moveTo(l,h):a.lineTo(l,h);h=6.28*(e+0.5)/this._points;l=b+0.4*d*Math.sin(h);h=c-0.4*d*Math.cos(h);a.lineTo(l,h)}a.closePath()};function PlimsollGlyph(a,b,c,d,e){this._x=a;this._height=b;this._overhang=c;this._fill=d;this._stroke=e}
PlimsollGlyph.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};
PlimsollGlyph.prototype.toSVG=function(){var a=this._height/2;return makeElementNS(NS_SVG,"g",[makeElementNS(NS_SVG,"circle",null,{cx:this._x,cy:a,r:a-this._overhang}),makeElementNS(NS_SVG,"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};PlimsollGlyph.prototype.min=function(){return this._x-this._height/2};PlimsollGlyph.prototype.max=function(){return this._x+this._height/2};PlimsollGlyph.prototype.height=function(){return this._height};
Browser.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+
this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+this.cookieKey+".ruler-location"]};Browser.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};
Browser.prototype.storeViewStatus=function(){this.cookieKey&&!this.noPersist&&(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0,this.currentSeqMax&&(localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax))};
Browser.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){for(var a=[],b=0;b<this.tiers.length;++b){var c=this.tiers[b];c.dasSource.noPersist||a.push({source:c.dasSource,config:c.config||{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(a);a=[];for(b=0;b<this.hubObjects.length;++b){var c=this.hubObjects[b],d={url:c.hub.url,genome:c.genome};c.credentials&&(d.credentials=c.credentials);c.mapping&&(d.mapping=c.mapping);a.push(d)}localStorage["dalliance."+
this.cookieKey+".hubs"]=JSON.stringify(a);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+".version"]=VERSION.CONFIG}};
Browser.prototype.restoreStatus=function(){if(!this.noPersist){var a=localStorage["dalliance."+this.cookieKey+".version"];if(VERSION.CONFIG==(a?a|0:-100)){var a=localStorage["dalliance."+this.cookieKey+".configHash"]||"",b=hex_sha1(miniJSONify({sources:this.sources,hubs:this.hubs}));if(b!=a)localStorage["dalliance."+this.cookieKey+".configHash"]=b;else{a={};for(b=0;b<this.sources.length;++b){var c=this.sources[b],d=sourceDataURI(c),e=a[d];e||(a[d]=e=[]);e.push(c)}b=localStorage["dalliance."+this.cookieKey+
".view-chr"];c=localStorage["dalliance."+this.cookieKey+".view-start"]|0;e=localStorage["dalliance."+this.cookieKey+".view-end"]|0;b&&c&&e&&(this.chr=b,this.viewStart=c,this.viewEnd=e,b=localStorage["dalliance."+this.cookieKey+".current-seq-length"])&&(this.currentSeqMax=b|0);this.reverseScrolling=(b=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==b;this.reverseKeyScrolling=(b=localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"])&&"true"==b;if(b=localStorage["dalliance."+
this.cookieKey+".ruler-location"])this.rulerLocation=b;if(b=localStorage["dalliance."+this.cookieKey+".sources"]){var h=JSON.parse(b);this.sources=[];this.restoredConfigs=[];for(b=0;b<h.length;++b)for(c=this.sources[b]=h[b].source,this.restoredConfigs[b]=h[b].config,d=sourceDataURI(c),e=a[d]||[],d=0;d<e.length;++d){var l=e[d];sourcesAreEqual(c,l)&&l.featureInfoPlugin&&(c.featureInfoPlugin=l.featureInfoPlugin)}}if(a=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(a)}}}};
Browser.prototype.reset=function(){for(var a=this.tiers.length-1;0<=a;--a)this.removeTier({index:a},!0);for(a=0;a<this.defaultSources.length;++a)this.defaultSources[a].disabled||this.addTier(this.defaultSources[a]);this.setLocation(this.defaultChr,this.defaultStart,this.defaultEnd);updateMolgenisTable(molgenisUrl,this.chr,null)};var __dalliance_sourceAdapterFactories={};function dalliance_registerSourceAdapterFactory(a,b){__dalliance_sourceAdapterFactories[a]=b}
DasTier.prototype.initSources=function(){var a=this,b=new DummyFeatureSource,c;"sequence"==this.dasSource.tier_type?c=this.dasSource.twoBitURI?new TwoBitSequenceSource(this.dasSource):new DASSequenceSource(this.dasSource):b=this.browser.createFeatureSource(this.dasSource);this.featureSource=b;this.sequenceSource=c;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};
Browser.prototype.createFeatureSource=function(a){var b=this.sourceCache.get(a);if(b)return b;if(a.tier_type&&__dalliance_sourceAdapterFactories[a.tier_type])b=(0,__dalliance_sourceAdapterFactories[a.tier_type])(a).features;else if(a.bwgURI||a.bwgBlob)b=new BWGFeatureSource(a);else if(a.bamURI||a.bamBlob)b=new BAMFeatureSource(a);else if(a.bamblrURI)b=new BamblrFeatureSource(a);else if(a.jbURI)b=new JBrowseFeatureSource(a);else if(a.uri||a.features_uri)b=new DASFeatureSource(a);if(a.overlay){var c=
[];b&&c.push(new CachingFeatureSource(b));for(b=0;b<a.overlay.length;++b)c.push(this.createFeatureSource(a.overlay[b]));b=new OverlayFeatureSource(c,a)}a.mapping&&(b=new MappedFeatureSource(b,this.chains[a.mapping]));a.name&&!b.name&&(b.name=a.name);null!=b&&(b=new CachingFeatureSource(b),this.sourceCache.put(a,b));return b};function SourceCache(){this.sourcesByURI={}}
SourceCache.prototype.get=function(a){var b=this.sourcesByURI[sourceDataURI(a)];if(b)for(var c=0;c<b.configs.length;++c)if(sourcesAreEqual(b.configs[c],a))return b.sources[c]};SourceCache.prototype.put=function(a,b){var c=sourceDataURI(a),d=this.sourcesByURI[c];d||(d={configs:[],sources:[]},this.sourcesByURI[c]=d);d.configs.push(a);d.sources.push(b)};var __cfs_id_seed=0;
function CachingFeatureSource(a){var b=this;this.source=a;this.cfsid="cfs"+ ++__cfs_id_seed;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){b.cfsid="cfs"+ ++__cfs_id_seed})}CachingFeatureSource.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};CachingFeatureSource.prototype.search=function(a,b){if(this.source.search)return this.source.search(a,b)};
CachingFeatureSource.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};CachingFeatureSource.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};CachingFeatureSource.prototype.getScales=function(){return this.source.getScales()};CachingFeatureSource.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};
CachingFeatureSource.prototype.addChangeListener=function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};CachingFeatureSource.prototype.findNextFeature=function(a,b,c,d){this.source.findNextFeature(a,b,c,d)};CachingFeatureSource.prototype.quantFindNextFeature=function(a,b,c,d,e){this.source.quantFindNextFeature(a,b,c,d,e)};CachingFeatureSource.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};
CachingFeatureSource.prototype.fetch=function(a,b,c,d,e,h,l){if(null==h)throw"pool is null...";var m=h.awaitedFeatures[this.cfsid];m||(m=new Awaited,h.awaitedFeatures[this.cfsid]=m,this.source.fetch(a,b,c,d,e,h,function(a,b,c){m.res||m.provide({status:a,features:b,scale:c})}));m.await(function(a){l(a.status,a.features,a.scale)})};function FeatureSourceBase(){this.busy=0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}
FeatureSourceBase.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);a(this.readiness)};FeatureSourceBase.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(b){console.log(b)}};FeatureSourceBase.prototype.addActivityListener=function(a){this.activityListeners.push(a)};FeatureSourceBase.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};
function DASFeatureSource(a){this.dasSource=a;this.busy=0;this.activityListeners=[]}DASFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};DASFeatureSource.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};DASFeatureSource.prototype.getStyleSheet=function(a){this.dasSource.stylesheet(function(b){a(b)},function(){a(null,"Couldn't fetch DAS stylesheet")})};
DASFeatureSource.prototype.fetch=function(a,b,c,d,e,h,l){if(e&&0==e.length)l(null,[],d);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return l(null,this.cachedStaticFeatures,this.cachedStaticScale);var m=!1!==this.dasSource.maxbins;e={type:e};m&&(e.maxbins=1+((c-b)/d|0));var p=this;p.busy++;p.notifyActivity();this.dasSource.features(new DASSegment(a,b,c),e,function(a,b){p.busy--;p.notifyActivity();var c=d;m||(c=0.1);!b&&p.dasSource.dasStaticFeatures&&
(p.cachedStaticFeatures=a,p.cachedStaticScale=c);l(b,a,c)})}};
DASFeatureSource.prototype.findNextFeature=this.sourceFindNextFeature=function(a,b,c,d){if(this.dasSource.capabilities&&0<=arrayIndexOf(this.dasSource.capabilities,"das1:adjacent-feature")){var e=this;if(this.dasAdjLock)return dlog("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(b|0)+":"+(0<c?"F":"B")};if(b=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=b;thisTier.dasSource.features(null,a,function(a){e.dasAdjLock=!1;0<a.length&&null!=a[0]&&(dlog("DAS adjacent seems to be working..."),
d(a[0]))})}};function DASSequenceSource(a){this.dasSource=a;this.awaitedEntryPoints=new Awaited;var b=this;this.dasSource.entryPoints(function(a){b.awaitedEntryPoints.provide(a)})}DASSequenceSource.prototype.fetch=function(a,b,c,d,e){this.dasSource.sequence(new DASSegment(a,b,c),function(a){return 1==a.length?e(null,a[0]):e("Didn't get sequence")})};
DASSequenceSource.prototype.getSeqInfo=function(a,b){this.awaitedEntryPoints.await(function(c){for(var d=0;d<c.length;++d)if(c[d].name==a)return b({length:c[d].end});return b()})};function TwoBitSequenceSource(a){var b=this;this.source=a;this.twoBit=new Awaited;makeTwoBit(new URLFetchable(a.twoBitURI),function(a,d){d?dlog(d):b.twoBit.provide(a)})}
TwoBitSequenceSource.prototype.fetch=function(a,b,c,d,e){this.twoBit.await(function(d){d.fetch(a,b,c,function(d,h){if(h)return e(h,null);var p=new DASSequence(a,b,c,"DNA",d);return e(null,p)})})};TwoBitSequenceSource.prototype.getSeqInfo=function(a,b){this.twoBit.await(function(c){c.getSeq(a)?c.getSeq(a).length(function(a){b({length:a})}):b()})};DASFeatureSource.prototype.getScales=function(){return[]};var bwg_preflights={};
function BWGFeatureSource(a){FeatureSourceBase.call(this);var b=this;this.readiness="Connecting";this.bwgSource=this.opts=a;b.bwgHolder=new Awaited;if(this.opts.preflight){var c=bwg_preflights[this.opts.preflight];if(!c){c=new Awaited;bwg_preflights[this.opts.preflight]=c;var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(200==d.status?c.provide("success"):c.provide("failure"))};d.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(d.withCredentials=
!0);d.send("")}c.await(function(a){"success"===a&&b.init()})}else b.init()}BWGFeatureSource.prototype=Object.create(FeatureSourceBase.prototype);
BWGFeatureSource.prototype.init=function(){var a=this,b,c;this.bwgSource.bwgURI?(b=makeBwgFromURL,c=this.bwgSource.bwgURI):(b=makeBwgFromFile,c=this.bwgSource.bwgBlob);b(c,function(b,c){c?(a.error=c,a.readiness=null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(b),a.readiness=null,a.notifyReadiness(),"bigbed"==b.type&&b.getExtraIndices(function(b){a.extraIndices=b}))},this.opts.credentials)};
BWGFeatureSource.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&0<this.extraIndices.length){a.search=[];for(var b=0;b<this.extraIndices.length;++b)a.search.push(this.extraIndices[b].field)}return a};
BWGFeatureSource.prototype.fetch=function(a,b,c,d,e,h,l){var m=this;this.bwgHolder.await(function(h){if(null==h)return l(m.error||"Can't access binary file",null,null);var q;q=!e||0==e.length||0<=arrayIndexOf(e,"density");m.opts.clientBin&&(q=!1);if("bigwig"==h.type||q||"undefined"!==typeof m.opts.forceReduction){q=-1;for(var r=0;r<h.zoomLevels.length;++r)if(h.zoomLevels[r].reduction<=d)q=r;else break;"undefined"!==typeof m.opts.forceReduction&&(q=m.opts.forceReduction);q=0>q?h.getUnzoomedView():
h.getZoomedView(q)}else q=h.getUnzoomedView();m.busy++;m.notifyActivity();q.readWigData(a,b,c,function(a){m.busy--;m.notifyActivity();var d=1E9;if("bigwig"===h.type){var e=(c-b)/a.length/2;e<d&&(d=e)}if(m.opts.link)for(e=0;e<a.length;++e){var q=a[e];q.label&&(q.links=[new DASLink("Link",m.opts.link.replace(/\$\$/,q.label))])}l(null,a,d)})})};
BWGFeatureSource.prototype.quantFindNextFeature=function(a,b,c,d,e){var h=this;h.busy++;h.notifyActivity();this.bwgHolder.res.thresholdSearch(a,b,c,d,function(a,b){h.busy--;h.notifyActivity();return e(a,b)})};BWGFeatureSource.prototype.findNextFeature=function(a,b,c,d){var e=this;e.busy++;e.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,b,c,function(a){e.busy--;e.notifyActivity();0<a.length&&null!=a[0]&&d(a[0])})};
BWGFeatureSource.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var b=[1],c=0;c<a.zoomLevels.length;++c)b.push(a.zoomLevels[c].reduction);return b}return null};BWGFeatureSource.prototype.search=function(a,b){return this.extraIndices&&0!=this.extraIndices.length?this.extraIndices[0].lookup(a,b):b(null,"No indices available")};
BWGFeatureSource.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(b){b&&b.schema&&b.definedFieldCount<b.schema.fields.length&&a(function(a,d){for(var e=b.definedFieldCount;e<b.schema.fields.length;++e){var h=b.schema.fields[e];d.add(h.comment,a[h.name])}})})};
BWGFeatureSource.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(b){if(!b)return a(null,"bbi error");var c=new DASStylesheet;if("bigbed"==b.type){var d=new DASStyle;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="blue";d.HEIGHT=8;d.BUMP=!0;d.LABEL=!0;d.ZINDEX=20;c.pushStyle({type:"bigwig"},null,d);d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="red";d.HEIGHT=10;d.BUMP=!0;d.ZINDEX=20;c.pushStyle({type:"bb-translation"},null,d);d=new DASStyle;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="white";
d.HEIGHT=10;d.ZINDEX=10;d.BUMP=!0;d.LABEL=!0;c.pushStyle({type:"bb-transcript"},null,d);d=new DASStyle;d.glyph="HISTOGRAM";d.COLOR1="white";d.COLOR2="black";d.HEIGHT=30;c.pushStyle({type:"density"},null,d)}else d=new DASStyle,d.glyph="HISTOGRAM",d.COLOR1="white",d.COLOR2="black",d.HEIGHT=30,c.pushStyle({type:"default"},null,d);12==b.definedFieldCount&&14<=b.fieldCount&&(c.geneHint=!0);return a(c)})};function BamblrFeatureSource(a){this.bamblr=a.bamblrURI}BamblrFeatureSource.prototype.getScales=function(){return[]};
BamblrFeatureSource.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"default"},null,c);return a(b)};
BamblrFeatureSource.prototype.fetch=function(a,b,c,d,e,h,l){var m=d|0;1>m&&(m=1);(new URLFetchable(this.bamblr+"?seq="+a+"&min="+b+"&max="+c+"&rez="+m)).fetch(function(c){if(null==c)dlog("failing bamblr");else{c=new Int32Array(c);for(var d=[],e=0;e<c.length;++e){var h=new DASFeature;h.min=b+e*m;h.max=h.min+m-1;h.segment=a;h.type="bamblr";h.score=c[e];d.push(h)}l(null,d,m)}})};
function BAMFeatureSource(a){FeatureSourceBase.call(this);var b=this;this.bamSource=a;this.opts={credentials:a.credentials,preflight:a.preflight};this.bamHolder=new Awaited;if(this.opts.preflight){var c=bwg_preflights[this.opts.preflight];if(!c){c=new Awaited;bwg_preflights[this.opts.preflight]=c;var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(200==d.status?c.provide("success"):c.provide("failure"))};d.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&
(d.withCredentials="true");d.send("")}c.await(function(a){"success"===a&&b.init()})}else b.init()}BAMFeatureSource.prototype=Object.create(FeatureSourceBase.prototype);
BAMFeatureSource.prototype.init=function(){var a=this,b,c;this.bamSource.bamBlob?(b=new BlobFetchable(this.bamSource.bamBlob),c=new BlobFetchable(this.bamSource.baiBlob)):(b=new URLFetchable(this.bamSource.bamURI,{credentials:this.opts.credentials}),c=new URLFetchable(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials}));makeBam(b,c,function(b){a.readiness=null;a.notifyReadiness();a.bamHolder.provide(b)})};
BAMFeatureSource.prototype.fetch=function(a,b,c,d,e,h,l){var m=this;m.busy++;m.notifyActivity();this.bamHolder.await(function(d){d.fetch(a,b,c,function(a,b){m.busy--;m.notifyActivity();if(b)l(b,null,null);else{for(var c=[],d=0;d<a.length;++d){var e=a[d];if(!(e.flag&4)){var h=e.seq.length;if(e.cigar)for(var h=0,p=parseCigar(e.cigar),w=0;w<p.length;++w){var x=p[w];if("M"==x.op||"D"==x.op)h+=x.cnt}p=new DASFeature;p.min=e.pos+1;p.max=e.pos+h;p.segment=e.segment;p.type="bam";p.id=e.readName;p.notes=["Sequence="+
e.seq,"CIGAR="+e.cigar,"MQ="+e.mq];p.cigar=e.cigar;p.seq=e.seq;p.quals=e.quals;c.push(p)}}l(null,c,1E9)}})})};BAMFeatureSource.prototype.getScales=function(){return 1E9};
BAMFeatureSource.prototype.getStyleSheet=function(a){this.bamHolder.await(function(b){b=new DASStylesheet;var c=new DASStyle;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"density"},"low",c);b.pushStyle({type:"density"},"medium",c);c=new DASStyle;c.glyph="__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};
function MappedFeatureSource(a,b){this.source=a;this.mapping=b;this.activityListeners=[];this.busy=0}MappedFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};MappedFeatureSource.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};MappedFeatureSource.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};MappedFeatureSource.prototype.getScales=function(){return this.source.getScales()};
MappedFeatureSource.prototype.fetch=function(a,b,c,d,e,h,l){var m=this;m.busy++;m.notifyActivity();this.mapping.sourceBlocksForRange(a,b,c,function(b){0==b.length?(m.busy--,m.notifyActivity(),l("No mapping available for this regions",[],d)):(b=b[0],m.source.fetch(b.name,b.start,b.end,d,e,h,function(b,c,d){m.busy--;m.notifyActivity();var e=[];if(c)for(var h=0;h<c.length;++h){var p=c[h],z=p.segment;0==z.indexOf("chr")&&(z=z.substr(3));var w=m.mapping.mapPoint(z,p.min),z=m.mapping.mapPoint(z,p.max);
w&&z&&w.seq==z.seq&&w.seq==a?(p.segment=w.seq,p.min=w.pos,p.max=z.pos,p.min>p.max&&(z=p.max,p.max=p.min,p.min=z),w.flipped&&("-"==p.orientation?p.orientation="+":"+"==p.orientation&&(p.orientation="-")),e.push(p)):p.parts&&0<p.parts.length&&e.push(p)}l(b,e,d)}))})};function DummyFeatureSource(){}DummyFeatureSource.prototype.getScales=function(){return null};DummyFeatureSource.prototype.fetch=function(a,b,c,d,e,h,l){return l(null,[],1E9)};
DummyFeatureSource.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};function DummySequenceSource(){}DummySequenceSource.prototype.fetch=function(a,b,c,d,e){return e(null,null)};function JBrowseFeatureSource(a){this.store=new JBrowseStore(a.jbURI,a.jbQuery)}JBrowseFeatureSource.prototype.getScales=function(){return null};
JBrowseFeatureSource.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="green";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;b.pushStyle({type:"default"},null,c);return a(b)};JBrowseFeatureSource.prototype.fetch=function(a,b,c,d,e,h,l){e&&0==e.length?l(null,[],d):this.store.features(new DASSegment(a,b,c),{},function(a,b){l(b,a,1E5)})};function sourceAdapterIsCapable(a,b){return a.capabilities?a.capabilities()[b]:!1}
function JBrowseStore(a,b){this.base=a;this.query=b}var topLevelResp;
JBrowseStore.prototype.features=function(a,b,c){url=this.base+"/features/"+a.name;b=[];this.query&&b.push(this.query);a.isBounded&&(b.push("start="+a.start),b.push("end="+a.end));0<b.length&&(url=url+"?"+b.join("&"));var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==d.readyState)if(300<=d.status)c(null,"Error code "+d.status);else{var b=JSON.parse(d.response).features,h=[];for(fi=0;fi<b.length;++fi){var l=b[fi],m=new DASFeature;m.segment=a;m.min=(l.start|0)+1;m.max=l.end|0;l.name&&(m.label=
l.name);m.type=l.type||"unknown";h.push(m)}c(h)}};d.open("GET",url,!0);d.responseType="text";d.send("")};function EnsemblFeatureSource(a){this.source=a;this.base=a.uri||"http://beta.rest.ensembl.org";this.species=a.species||"human";this.activityListeners=[];this.busy=0;this.type="string"===typeof a.type?[a.type]:a.type||["regulatory"]}EnsemblFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};
EnsemblFeatureSource.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};
EnsemblFeatureSource.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="__NONE";0<=this.type.indexOf("exon")&&b.pushStyle({type:"transcript"},null,c);(0<=this.type.indexOf("exon")||0<=this.type.indexOf("transcript"))&&b.pushStyle({type:"gene"},null,c);c=new DASStyle;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="red";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=10;b.pushStyle({type:"cds"},null,c);c=new DASStyle;c.glyph="SQUARE";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";b.pushStyle({type:"variation",
method:".+_UTR_variant"},null,c);c=new DASStyle;c.glyph="TRIANGLE";c.DIRECTION="S";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";b.pushStyle({type:"variation",method:"missense_variant"},null,c);c=new DASStyle;c.glyph="TRIANGLE";c.DIRECTION="N";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";b.pushStyle({type:"variation",method:"splice_.+_variant"},null,c);c=new DASStyle;c.glyph="STAR";c.POINTS=6;c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";b.pushStyle({type:"variation",method:"regulatory_region_variant"},null,
c);c=new DASStyle;c.glyph="PLIMSOLL";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="rgb(50,80,255)";c.STROKECOLOR="black";b.pushStyle({type:"variation"},null,c);c=new DASStyle;c.glyph="SQUARE";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";b.pushStyle({type:"indel",method:".+_UTR_variant"},null,c);c=new DASStyle;c.glyph="TRIANGLE";c.DIRECTION="S";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";b.pushStyle({type:"indel",method:"missense_variant"},null,c);c=new DASStyle;c.glyph="TRIANGLE";
c.DIRECTION="N";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";b.pushStyle({type:"indel",method:"splice_.+_variant"},null,c);c=new DASStyle;c.glyph="STAR";c.POINTS=6;c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";b.pushStyle({type:"indel",method:"regulatory_region_variant"},null,c);c=new DASStyle;c.glyph="PLIMSOLL";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";c.STROKECOLOR="black";b.pushStyle({type:"indel"},null,c);c=new DASStyle;c.glyph="BOX";c.FGCOLOR=
"black";c.BGCOLOR="orange";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;b.pushStyle({type:"default"},null,c);return a(b)};EnsemblFeatureSource.prototype.getScales=function(){return[]};
EnsemblFeatureSource.prototype.fetch=function(a,b,c,d,e,h,l){var m=this;url=this.base+"/feature/region/"+this.species+"/"+a+":"+b+"-"+c;b=[];for(c=0;c<this.type.length;++c)b.push("feature="+this.type[c]);b.push("content-type=application/json");url=url+"?"+b.join(";");var p=new XMLHttpRequest;p.onreadystatechange=function(){if(4==p.readyState)if(m.busy--,m.notifyActivity(),300<=p.status){var b="Error code "+p.status;try{var c=JSON.parse(p.response);c.error&&(b=c.error)}catch(d){}l(b,null)}else{b=JSON.parse(p.response);
c=[];for(fi=0;fi<b.length;++fi){var e=b[fi],h=[],u=new DASFeature;u.segment=a;u.min=e.start|0;u.max=e.end|0;u.type=e.feature_type||"unknown";u.id=e.ID;if(e.Parent){var z=new DASGroup;z.id=e.Parent;u.groups=[z]}e.strand&&(0>e.strand?u.orientation="-":0<e.strand&&(u.orientation="+"));e.consequence_type&&(u.method=e.consequence_type);e.alt_alleles&&(h.push("Alleles="+e.alt_alleles.join("/")),1<e.alt_alleles.length&&(e.alt_alleles[1].length!=e.alt_alleles[0].length||"-"==e.alt_alleles[1])&&(u.type="indel"));
0<h.length&&(u.notes=h);c.push(u)}l(null,c)}};m.busy++;m.notifyActivity();p.open("GET",url,!0);p.responseType="text";p.send("")};dalliance_registerSourceAdapterFactory("ensembl",function(a){return{features:new EnsemblFeatureSource(a)}});
function OverlayFeatureSource(a,b){this.sources=a;this.opts=b||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(var c=0;c<this.sources.length;++c)this.initN(c);this.merge="concat"==b.merge?OverlayFeatureSource_merge_concat:OverlayFeatureSource_merge_byKey}
OverlayFeatureSource.prototype.initN=function(a){var b=this.sources[a],c=this;this.business[a]=0;b.addActivityListener&&b.addActivityListener(function(b){c.business[a]=b;c.notifyActivity()});b.addChangeListener&&b.addChangeListener(function(){c.notifyChange()});b.addReadinessListener&&b.addReadinessListener(function(b){c.readiness[a]=b;c.notifyReadiness()})};OverlayFeatureSource.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);this.notifyReadinessListener(a)};
OverlayFeatureSource.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)this.notifyReadinessListener(this.readinessListeners[a])};OverlayFeatureSource.prototype.notifyReadinessListener=function(a){for(var b=null,c=0;c<this.readiness.length;++c)if(null!=this.readiness[c]){b=this.readiness[c];break}try{a(b)}catch(d){console.log(d)}};OverlayFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};
OverlayFeatureSource.prototype.notifyActivity=function(){for(var a=0,b=0;b<this.business.length;++b)a+=this.business[b];for(b=0;b<this.activityListeners.length;++b)try{this.activityListeners[b](a)}catch(c){console.log(c)}};OverlayFeatureSource.prototype.addChangeListener=function(a){this.changeListeners.push(a)};OverlayFeatureSource.prototype.notifyChange=function(){for(var a=0;a<this.changeListeners.length;++a)try{this.changeListeners[a](this.busy)}catch(b){console.log(b)}};
OverlayFeatureSource.prototype.getScales=function(){return this.sources[0].getScales()};OverlayFeatureSource.prototype.getStyleSheet=function(a){return this.sources[0].getStyleSheet(a)};OverlayFeatureSource.prototype.capabilities=function(){var a={},b=this.sources[0];b.capabilities&&(a=shallowCopy(b.capabilities()));for(b=1;b<this.sources.length;++b){var c=this.sources[b];c.capabilities&&(c=c.capabilities(),c.search&&(a.search=c.search))}return a};
OverlayFeatureSource.prototype.search=function(a,b){for(var c=0;c<this.sources.length;++c)if(sourceAdapterIsCapable(this.sources[c],"search"))return this.sources[c].search(a,b)};OverlayFeatureSource.prototype.fetch=function(a,b,c,d,e,h,l){l=new OverlayBaton(this,l,this.sources.length);for(var m=0;m<this.sources.length;++m)this.fetchN(l,m,a,b,c,d,e,h)};OverlayFeatureSource.prototype.fetchN=function(a,b,c,d,e,h,l,m){this.sources[b].fetch(c,d,e,h,l,m,function(c,d,e){return a.completed(b,c,d,e)})};
OverlayFeatureSource.prototype.quantFindNextFeature=function(a,b,c,d,e){return this.sources[0].quantFindNextFeature(a,b,c,d,e)};OverlayFeatureSource.prototype.findNextFeature=function(a,b,c,d){return this.sources[0].findNextFeature(a,b,c,d)};function OverlayBaton(a,b,c){this.source=a;this.callback=b;this.count=c;this.statusCount=this.returnCount=0;this.returns=[];this.features=[];this.statuses=[];this.scale=null}
OverlayBaton.prototype.completed=function(a,b,c,d){if(null==this.scale||0==a)this.scale=d;if(this.returns[a])throw"Multiple returns for source "+a;this.returns[a]=!0;this.returnCount++;this.features[a]=c;b&&(this.statuses[a]=b,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){a="";for(b=0;b<this.count;++b)if(c=this.statuses[b])0<a.length&&(a+=", "),a+=c;return this.callback(a,null,this.scale)}this.callback(null,this.source.merge(this.features),this.scale)}};
OverlayFeatureSource.prototype.getDefaultFIPs=function(a){for(var b=0;b<this.sources.length;++b){var c=this.sources[b];c.getDefaultFIPs&&c.getDefaultFIPs(a)}};OverlayFeatureSource.prototype.keyForFeature=function(a){return""+a.min+".."+a.max};
function OverlayFeatureSource_merge_byKey(a){for(var b=[],c=1;c<a.length;++c){for(var d={},e=a[c],h=0;h<e.length;++h)d[this.keyForFeature(e[h])]=e[h];b.push(d)}c=[];a=a[0];for(h=0;h<a.length;++h){for(var l=a[h],m=0;m<b.length;++m)if(d=b[m],e=d[this.keyForFeature(l)])for(var p in e)"score"===p?l.score2=e.score:"min"!==p&&"max"!==p&&"segment"!==p&&"_cachedStyle"!==p&&(l[p]=e[p]);c.push(l)}return c}
function OverlayFeatureSource_merge_concat(a){for(var b=[],c=0;c<a.length;++c)for(var d=a[c],e=this.sources[c].name,h=0;h<d.length;++h){var l=d[h];l.method=e;b.push(l)}return b}function updateMolgenisTable(a,b,c){if(null==c||"mutation"==c.typeId)a="/plugin/genomebrowser/data?segment="+b,null!=c&&(a=a+"&mutation="+c.id),$.ajax({url:a,type:"GET",dataType:"json",success:function(a){},error:function(a,b,c){console.log("jqXHR : "+a+" text status : "+b+" error : "+c)}})}
var MAX_WBITS=15,DEF_WBITS=MAX_WBITS,MAX_MEM_LEVEL=9,MANY=1440,BMAX=15,PRESET_DICT=32,Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_SYNC_FLUSH=2,Z_FULL_FLUSH=3,Z_FINISH=4,Z_DEFLATED=8,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_ERRNO=-1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_VERSION_ERROR=-6,METHOD=0,FLAG=1,DICT4=2,DICT3=3,DICT2=4,DICT1=5,DICT0=6,BLOCKS=7,CHECK4=8,CHECK3=9,CHECK2=10,CHECK1=11,DONE=12,BAD=13,inflate_mask=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],
IB_TYPE=0,IB_LENS=1,IB_STORED=2,IB_TABLE=3,IB_BTREE=4,IB_DTREE=5,IB_CODES=6,IB_DRY=7,IB_DONE=8,IB_BAD=9,fixed_bl=9,fixed_bd=5,fixed_tl=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,
7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,
9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,
125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,
82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,
8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,
0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,
9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],fixed_td=[80,
5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,
129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function ZStream(){}ZStream.prototype.inflateInit=function(a,b){a||(a=DEF_WBITS);b&&(b=!1);this.istate=new Inflate;return this.istate.inflateInit(this,b?-a:a)};ZStream.prototype.inflate=function(a){return null==this.istate?Z_STREAM_ERROR:this.istate.inflate(this,a)};
ZStream.prototype.inflateEnd=function(){if(null==this.istate)return Z_STREAM_ERROR;var a=istate.inflateEnd(this);this.istate=null;return a};ZStream.prototype.inflateSync=function(){return istate.inflateSync(this)};ZStream.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};function Inflate(){this.was=[0]}
Inflate.prototype.inflateReset=function(a){if(null==a||null==a.istate)return Z_STREAM_ERROR;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?BLOCKS:METHOD;a.istate.blocks.reset(a,null);return Z_OK};Inflate.prototype.inflateEnd=function(a){null!=this.blocks&&this.blocks.free(a);this.blocks=null;return Z_OK};
Inflate.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),Z_STREAM_ERROR;this.wbits=b;a.istate.blocks=new InfBlocks(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return Z_OK};
Inflate.prototype.inflate=function(a,b){var c,d;if(null==a||null==a.istate||null==a.next_in)return Z_STREAM_ERROR;b=b==Z_FINISH?Z_BUF_ERROR:Z_OK;for(c=Z_BUF_ERROR;;)switch(a.istate.mode){case METHOD:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;if(((a.istate.method=a.next_in[a.next_in_index++])&15)!=Z_DEFLATED){a.istate.mode=BAD;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=BAD;a.msg="invalid window size";a.istate.marker=
5;break}a.istate.mode=FLAG;case FLAG:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;d=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<8)+d)%31){a.istate.mode=BAD;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(d&PRESET_DICT)){a.istate.mode=BLOCKS;break}a.istate.mode=DICT4;case DICT4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=DICT3;case DICT3:if(0==a.avail_in)return c;c=b;a.avail_in--;
a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=DICT2;case DICT2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=DICT1;case DICT1:if(0==a.avail_in)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=DICT0;return Z_NEED_DICT;case DICT0:return a.istate.mode=BAD,a.msg="need dictionary",a.istate.marker=0,Z_STREAM_ERROR;
case BLOCKS:c=a.istate.blocks.proc(a,c);if(c==Z_DATA_ERROR){a.istate.mode=BAD;a.istate.marker=0;break}c==Z_OK&&(c=b);if(c!=Z_STREAM_END)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=DONE;break}a.istate.mode=CHECK4;case CHECK4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=CHECK3;case CHECK3:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&
255)<<16&16711680;a.istate.mode=CHECK2;case CHECK2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=CHECK1;case CHECK1:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=BAD;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=DONE;case DONE:return Z_STREAM_END;case BAD:return Z_DATA_ERROR;default:return Z_STREAM_ERROR}};
Inflate.prototype.inflateSetDictionary=function(a,b,c){var d=0,e=c;if(null==a||null==a.istate||a.istate.mode!=DICT0)return Z_STREAM_ERROR;if(a._adler.adler32(1,b,0,c)!=a.adler)return Z_DATA_ERROR;a.adler=a._adler.adler32(0,null,0,0);e>=1<<a.istate.wbits&&(e=(1<<a.istate.wbits)-1,d=c-e);a.istate.blocks.set_dictionary(b,d,e);a.istate.mode=BLOCKS;return Z_OK};var mark=[0,0,255,255];
Inflate.prototype.inflateSync=function(a){var b,c,d;if(null==a||null==a.istate)return Z_STREAM_ERROR;a.istate.mode!=BAD&&(a.istate.mode=BAD,a.istate.marker=0);if(0==(b=a.avail_in))return Z_BUF_ERROR;c=a.next_in_index;for(d=a.istate.marker;0!=b&&4>d;)a.next_in[c]==mark[d]?d++:d=0!=a.next_in[c]?0:4-d,c++,b--;a.total_in+=c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=d;if(4!=d)return Z_DATA_ERROR;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=
BLOCKS;return Z_OK};Inflate.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?Z_STREAM_ERROR:a.istate.blocks.sync_point()};var INFBLOCKS_BORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];
function InfBlocks(a,b,c){this.hufts=new Int32Array(3*MANY);this.window=new Uint8Array(c);this.end=c;this.checkfn=b;this.mode=IB_TYPE;this.reset(a,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new InfCodes;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new InfTree}
InfBlocks.prototype.reset=function(a,b){b&&(b[0]=this.check);this.mode==IB_CODES&&this.codes.free(a);this.mode=IB_TYPE;this.read=this.write=this.bitb=this.bitk=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};
InfBlocks.prototype.proc=function(a,b){var c,d,e,h,l,m,p;h=a.next_in_index;l=a.avail_in;d=this.bitb;e=this.bitk;m=this.write;for(p=m<this.read?this.read-m-1:this.end-m;;)switch(this.mode){case IB_TYPE:for(;3>e;){if(0!=l)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b);l--;d|=(a.next_in[h++]&255)<<e;e+=8}c=d&7;this.last=c&1;switch(c>>>1){case 0:d>>>=3;e-=3;c=e&7;d>>>=c;e-=c;this.mode=IB_LENS;break;case 1:var q=
new Int32Array(1),r=new Int32Array(1),t=[],s=[];inflate_trees_fixed(q,r,t,s,a);this.codes.init(q[0],r[0],t[0],0,s[0],0,a);d>>>=3;e-=3;this.mode=IB_CODES;break;case 2:d>>>=3;e-=3;this.mode=IB_TABLE;break;case 3:return d>>>=3,e-=3,this.mode=BAD,a.msg="invalid block type",b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b)}break;case IB_LENS:for(;32>e;){if(0!=l)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=l,
a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b);l--;d|=(a.next_in[h++]&255)<<e;e+=8}if((~d>>>16&65535)!=(d&65535))return this.mode=BAD,a.msg="invalid stored block lengths",b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b);this.left=d&65535;d=e=0;this.mode=0!=left?IB_STORED:0!=this.last?IB_DRY:IB_TYPE;break;case IB_STORED:if(0==l)return this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=
h-a.next_in_index,a.next_in_index=h,write=m,this.inflate_flush(a,b);if(0==p&&(m==end&&0!=read&&(m=0,p=m<this.read?this.read-m-1:this.end-m),0==p&&(this.write=m,b=this.inflate_flush(a,b),m=this.write,p=m<this.read?this.read-m-1:this.end-m,m==this.end&&0!=this.read&&(m=0,p=m<this.read?this.read-m-1:this.end-m),0==p)))return this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b);b=Z_OK;c=this.left;c>l&&(c=l);c>p&&(c=p);arrayCopy(a.next_in,
h,window,m,c);h+=c;l-=c;m+=c;p-=c;if(0!=(this.left-=c))break;this.mode=0!=this.last?IB_DRY:IB_TYPE;break;case IB_TABLE:for(;14>e;){if(0!=l)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b);l--;d|=(a.next_in[h++]&255)<<e;e+=8}this.table=c=d&16383;if(29<(c&31)||29<(c>>5&31))return this.mode=IB_BAD,a.msg="too many length or distance symbols",b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,
a.next_in_index=h,this.write=m,this.inflate_flush(a,b);c=258+(c&31)+(c>>5&31);if(null==this.blens||this.blens.length<c)this.blens=new Int32Array(c);else for(p=0;p<c;p++)this.blens[p]=0;d>>>=14;e-=14;this.index=0;mode=IB_BTREE;case IB_BTREE:for(;this.index<4+(this.table>>>10);){for(;3>e;){if(0!=l)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b);l--;d|=(a.next_in[h++]&255)<<e;e+=8}this.blens[INFBLOCKS_BORDER[this.index++]]=
d&7;d>>>=3;e-=3}for(;19>this.index;)this.blens[INFBLOCKS_BORDER[this.index++]]=0;this.bb[0]=7;c=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(c!=Z_OK)return b=c,b==Z_DATA_ERROR&&(this.blens=null,this.mode=IB_BAD),this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,write=m,this.inflate_flush(a,b);this.index=0;this.mode=IB_DTREE;case IB_DTREE:for(;;){c=this.table;if(!(this.index<258+(c&31)+(c>>5&31)))break;for(c=this.bb[0];e<c;){if(0!=l)b=
Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b);l--;d|=(a.next_in[h++]&255)<<e;e+=8}c=this.hufts[3*(this.tb[0]+(d&inflate_mask[c]))+1];r=this.hufts[3*(this.tb[0]+(d&inflate_mask[c]))+2];if(16>r)d>>>=c,e-=c,this.blens[this.index++]=r;else{p=18==r?7:r-14;for(q=18==r?11:3;e<c+p;){if(0!=l)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,
b);l--;d|=(a.next_in[h++]&255)<<e;e+=8}d>>>=c;e-=c;q+=d&inflate_mask[p];d>>>=p;e-=p;p=this.index;c=this.table;if(p+q>258+(c&31)+(c>>5&31)||16==r&&1>p)return this.blens=null,this.mode=IB_BAD,a.msg="invalid bit length repeat",b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b);r=16==r?this.blens[p-1]:0;do this.blens[p++]=r;while(0!=--q);this.index=p}}this.tb[0]=-1;q=new Int32Array(1);r=new Int32Array(1);t=new Int32Array(1);
s=new Int32Array(1);q[0]=9;r[0]=6;c=this.table;c=this.inftree.inflate_trees_dynamic(257+(c&31),1+(c>>5&31),this.blens,q,r,t,s,this.hufts,a);if(c!=Z_OK)return c==Z_DATA_ERROR&&(this.blens=null,this.mode=BAD),b=c,this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b);this.codes.init(q[0],r[0],this.hufts,t[0],this.hufts,s[0],a);this.mode=IB_CODES;case IB_CODES:this.bitb=d;this.bitk=e;a.avail_in=l;a.total_in+=h-a.next_in_index;a.next_in_index=
h;this.write=m;if((b=this.codes.proc(this,a,b))!=Z_STREAM_END)return this.inflate_flush(a,b);b=Z_OK;this.codes.free(a);h=a.next_in_index;l=a.avail_in;d=this.bitb;e=this.bitk;m=this.write;p=m<this.read?this.read-m-1:this.end-m;if(0==this.last){this.mode=IB_TYPE;break}this.mode=IB_DRY;case IB_DRY:this.write=m;b=this.inflate_flush(a,b);m=this.write;if(this.read!=this.write)return this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b);
mode=DONE;case IB_DONE:return b=Z_STREAM_END,this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b);case IB_BAD:return b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b);default:return b=Z_STREAM_ERROR,this.bitb=d,this.bitk=e,a.avail_in=l,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,b)}};
InfBlocks.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};InfBlocks.prototype.set_dictionary=function(a,b,c){arrayCopy(a,b,window,0,c);this.read=this.write=c};InfBlocks.prototype.sync_point=function(){return this.mode==IB_LENS};
InfBlocks.prototype.inflate_flush=function(a,b){var c,d,e;d=a.next_out_index;e=this.read;c=(e<=this.write?this.write:this.end)-e;c>a.avail_out&&(c=a.avail_out);0!=c&&b==Z_BUF_ERROR&&(b=Z_OK);a.avail_out-=c;a.total_out+=c;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,e,c));arrayCopy(this.window,e,a.next_out,d,c);d+=c;e+=c;e==this.end&&(e=0,this.write==this.end&&(this.write=0),c=this.write-e,c>a.avail_out&&(c=a.avail_out),0!=c&&b==Z_BUF_ERROR&&(b=Z_OK),a.avail_out-=
c,a.total_out+=c,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,e,c)),arrayCopy(this.window,e,a.next_out,d,c),d+=c,e+=c);a.next_out_index=d;this.read=e;return b};var IC_START=0,IC_LEN=1,IC_LENEXT=2,IC_DIST=3,IC_DISTEXT=4,IC_COPY=5,IC_LIT=6,IC_WASH=7,IC_END=8,IC_BADCODE=9;function InfCodes(){}InfCodes.prototype.init=function(a,b,c,d,e,h,l){this.mode=IC_START;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=d;this.dtree=e;this.dtree_index=h;this.tree=null};
InfCodes.prototype.proc=function(a,b,c){var d,e,h=0,l=0,m=0,p,q,r,m=b.next_in_index;p=b.avail_in;h=a.bitb;l=a.bitk;q=a.write;for(r=q<a.read?a.read-q-1:a.end-q;;)switch(this.mode){case IC_START:if(258<=r&&10<=p&&(a.bitb=h,a.bitk=l,b.avail_in=p,b.total_in+=m-b.next_in_index,b.next_in_index=m,a.write=q,c=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b),m=b.next_in_index,p=b.avail_in,h=a.bitb,l=a.bitk,q=a.write,r=q<a.read?a.read-q-1:a.end-q,c!=Z_OK)){this.mode=
c==Z_STREAM_END?IC_WASH:IC_BADCODE;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=IC_LEN;case IC_LEN:for(d=this.need;l<d;){if(0!=p)c=Z_OK;else return a.bitb=h,a.bitk=l,b.avail_in=p,b.total_in+=m-b.next_in_index,b.next_in_index=m,a.write=q,a.inflate_flush(b,c);p--;h|=(b.next_in[m++]&255)<<l;l+=8}d=3*(this.tree_index+(h&inflate_mask[d]));h>>>=this.tree[d+1];l-=this.tree[d+1];e=this.tree[d];if(0==e){this.lit=this.tree[d+2];this.mode=IC_LIT;break}if(0!=(e&16)){this.get=
e&15;this.len=this.tree[d+2];this.mode=IC_LENEXT;break}if(0==(e&64)){this.need=e;this.tree_index=d/3+this.tree[d+2];break}if(0!=(e&32)){this.mode=IC_WASH;break}this.mode=IC_BADCODE;b.msg="invalid literal/length code";c=Z_DATA_ERROR;a.bitb=h;a.bitk=l;b.avail_in=p;b.total_in+=m-b.next_in_index;b.next_in_index=m;a.write=q;return a.inflate_flush(b,c);case IC_LENEXT:for(d=this.get;l<d;){if(0!=p)c=Z_OK;else return a.bitb=h,a.bitk=l,b.avail_in=p,b.total_in+=m-b.next_in_index,b.next_in_index=m,a.write=q,
a.inflate_flush(b,c);p--;h|=(b.next_in[m++]&255)<<l;l+=8}this.len+=h&inflate_mask[d];h>>=d;l-=d;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=IC_DIST;case IC_DIST:for(d=this.need;l<d;){if(0!=p)c=Z_OK;else return a.bitb=h,a.bitk=l,b.avail_in=p,b.total_in+=m-b.next_in_index,b.next_in_index=m,a.write=q,a.inflate_flush(b,c);p--;h|=(b.next_in[m++]&255)<<l;l+=8}d=3*(this.tree_index+(h&inflate_mask[d]));h>>=this.tree[d+1];l-=this.tree[d+1];e=this.tree[d];if(0!=(e&16)){this.get=
e&15;this.dist=this.tree[d+2];this.mode=IC_DISTEXT;break}if(0==(e&64)){this.need=e;this.tree_index=d/3+this.tree[d+2];break}this.mode=IC_BADCODE;b.msg="invalid distance code";c=Z_DATA_ERROR;a.bitb=h;a.bitk=l;b.avail_in=p;b.total_in+=m-b.next_in_index;b.next_in_index=m;a.write=q;return a.inflate_flush(b,c);case IC_DISTEXT:for(d=this.get;l<d;){if(0!=p)c=Z_OK;else return a.bitb=h,a.bitk=l,b.avail_in=p,b.total_in+=m-b.next_in_index,b.next_in_index=m,a.write=q,a.inflate_flush(b,c);p--;h|=(b.next_in[m++]&
255)<<l;l+=8}this.dist+=h&inflate_mask[d];h>>=d;l-=d;this.mode=IC_COPY;case IC_COPY:for(d=q-this.dist;0>d;)d+=a.end;for(;0!=this.len;){if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,c=a.inflate_flush(b,c),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=h,a.bitk=l,b.avail_in=p,b.total_in+=m-b.next_in_index,b.next_in_index=m,a.write=q,a.inflate_flush(b,c);a.window[q++]=a.window[d++];r--;d==a.end&&
(d=0);this.len--}this.mode=IC_START;break;case IC_LIT:if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,c=a.inflate_flush(b,c),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=h,a.bitk=l,b.avail_in=p,b.total_in+=m-b.next_in_index,b.next_in_index=m,a.write=q,a.inflate_flush(b,c);c=Z_OK;a.window[q++]=this.lit;r--;this.mode=IC_START;break;case IC_WASH:7<l&&(l-=8,p++,m--);a.write=q;c=a.inflate_flush(b,
c);q=a.write;if(a.read!=a.write)return a.bitb=h,a.bitk=l,b.avail_in=p,b.total_in+=m-b.next_in_index,b.next_in_index=m,a.write=q,a.inflate_flush(b,c);this.mode=IC_END;case IC_END:return c=Z_STREAM_END,a.bitb=h,a.bitk=l,b.avail_in=p,b.total_in+=m-b.next_in_index,b.next_in_index=m,a.write=q,a.inflate_flush(b,c);case IC_BADCODE:return c=Z_DATA_ERROR,a.bitb=h,a.bitk=l,b.avail_in=p,b.total_in+=m-b.next_in_index,b.next_in_index=m,a.write=q,a.inflate_flush(b,c);default:return c=Z_STREAM_ERROR,a.bitb=h,a.bitk=
l,b.avail_in=p,b.total_in+=m-b.next_in_index,b.next_in_index=m,a.write=q,a.inflate_flush(b,c)}};InfCodes.prototype.free=function(a){};
InfCodes.prototype.inflate_fast=function(a,b,c,d,e,h,l,m){var p,q,r,t,s,v,u,z,w,x,A,B;v=m.next_in_index;u=m.avail_in;t=l.bitb;s=l.bitk;z=l.write;w=z<l.read?l.read-z-1:l.end-z;a=inflate_mask[a];x=inflate_mask[b];do{for(;20>s;)u--,t|=(m.next_in[v++]&255)<<s,s+=8;p=t&a;q=c;r=d;B=3*(r+p);if(0==(b=q[B]))t>>=q[B+1],s-=q[B+1],l.window[z++]=q[B+2],w--;else{do{t>>=q[B+1];s-=q[B+1];if(0!=(b&16)){b&=15;A=q[B+2]+(t&inflate_mask[b]);t>>=b;for(s-=b;15>s;)u--,t|=(m.next_in[v++]&255)<<s,s+=8;p=t&x;q=e;r=h;B=3*(r+
p);b=q[B];do if(t>>=q[B+1],s-=q[B+1],0!=(b&16)){for(b&=15;s<b;)u--,t|=(m.next_in[v++]&255)<<s,s+=8;p=q[B+2]+(t&inflate_mask[b]);t>>=b;s-=b;w-=A;if(z>=p)p=z-p,l.window[z++]=l.window[p++],l.window[z++]=l.window[p++],A-=2;else{p=z-p;do p+=l.end;while(0>p);b=l.end-p;if(A>b){A-=b;if(0<z-p&&b>z-p){do l.window[z++]=l.window[p++];while(0!=--b)}else arrayCopy(l.window,p,l.window,z,b),z+=b;p=0}}do l.window[z++]=l.window[p++];while(0!=--A);break}else if(0==(b&64))p+=q[B+2],p+=t&inflate_mask[b],B=3*(r+p),b=q[B];
else return m.msg="invalid distance code",A=m.avail_in-u,A=s>>3<A?s>>3:A,u+=A,v-=A,s-=A<<3,l.bitb=t,l.bitk=s,m.avail_in=u,m.total_in+=v-m.next_in_index,m.next_in_index=v,l.write=z,Z_DATA_ERROR;while(1);break}if(0==(b&64)){if(p+=q[B+2],p+=t&inflate_mask[b],B=3*(r+p),0==(b=q[B])){t>>=q[B+1];s-=q[B+1];l.window[z++]=q[B+2];w--;break}}else{if(0!=(b&32))return A=m.avail_in-u,A=s>>3<A?s>>3:A,u+=A,v-=A,s-=A<<3,l.bitb=t,l.bitk=s,m.avail_in=u,m.total_in+=v-m.next_in_index,m.next_in_index=v,l.write=z,Z_STREAM_END;
m.msg="invalid literal/length code";A=m.avail_in-u;A=s>>3<A?s>>3:A;u+=A;v-=A;s-=A<<3;l.bitb=t;l.bitk=s;m.avail_in=u;m.total_in+=v-m.next_in_index;m.next_in_index=v;l.write=z;return Z_DATA_ERROR}}while(1)}}while(258<=w&&10<=u);A=m.avail_in-u;A=s>>3<A?s>>3:A;v-=A;l.bitb=t;l.bitk=s-(A<<3);m.avail_in=u+A;m.total_in+=v-m.next_in_index;m.next_in_index=v;l.write=z;return Z_OK};function InfTree(){}
InfTree.prototype.huft_build=function(a,b,c,d,e,h,l,m,p,q,r){var t,s,v,u,z,w,x,A,B;w=0;s=c;do this.c[a[b+w]]++,w++,s--;while(0!=s);if(this.c[0]==c)return l[0]=-1,m[0]=0,Z_OK;z=m[0];for(v=1;v<=BMAX&&0==this.c[v];v++);u=v;z<v&&(z=v);for(s=BMAX;0!=s&&0==this.c[s];s--);q=s;z>s&&(z=s);m[0]=z;for(m=1<<v;v<s;v++,m<<=1)if(0>(m-=this.c[v]))return Z_DATA_ERROR;if(0>(m-=this.c[s]))return Z_DATA_ERROR;this.c[s]+=m;this.x[1]=v=0;w=1;for(x=2;0!=--s;)this.x[x]=v+=this.c[w],x++,w++;w=s=0;do 0!=(v=a[b+w])&&(this.v[this.x[v]++]=
s),w++;while(++s<c);c=this.x[q];w=this.x[0]=s=0;b=-1;A=-z;for(B=x=this.u[0]=0;u<=q;u++)for(a=this.c[u];0!=a--;){for(;u>A+z;){b++;A+=z;B=q-A;B=B>z?z:B;if((t=1<<(v=u-A))>a+1&&(t-=a+1,x=u,v<B))for(;++v<B&&!((t<<=1)<=this.c[++x]);)t-=this.c[x];B=1<<v;if(this.hn[0]+B>MANY)return Z_DATA_ERROR;this.u[b]=x=this.hn[0];this.hn[0]+=B;0!=b?(this.x[b]=s,this.r[0]=v,this.r[1]=z,v=s>>>A-z,this.r[2]=x-this.u[b-1]-v,arrayCopy(this.r,0,p,3*(this.u[b-1]+v),3)):l[0]=x}this.r[1]=u-A;w>=c?this.r[0]=192:r[w]<d?(this.r[0]=
256>this.v[w]?0:96,this.r[2]=this.v[w++]):(this.r[0]=h[this.v[w]-d]+16+64,this.r[2]=e[this.v[w++]-d]);t=1<<u-A;for(v=s>>>A;v<B;v+=t)arrayCopy(this.r,0,p,3*(x+v),3);for(v=1<<u-1;0!=(s&v);v>>>=1)s^=v;s^=v;for(v=(1<<A)-1;(s&v)!=this.x[b];)b--,A-=z,v=(1<<A)-1}return 0!=m&&1!=q?Z_BUF_ERROR:Z_OK};
InfTree.prototype.inflate_trees_bits=function(a,b,c,d,e){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,d,this.hn,this.v);if(a==Z_DATA_ERROR)e.msg="oversubscribed dynamic bit lengths tree";else if(a==Z_BUF_ERROR||0==b[0])e.msg="incomplete dynamic bit lengths tree",a=Z_DATA_ERROR;return a};
InfTree.prototype.inflate_trees_dynamic=function(a,b,c,d,e,h,l,m,p){this.initWorkArea(288);this.hn[0]=0;h=this.huft_build(c,0,a,257,cplens,cplext,h,d,m,this.hn,this.v);if(h!=Z_OK||0==d[0])return h==Z_DATA_ERROR?p.msg="oversubscribed literal/length tree":h!=Z_MEM_ERROR&&(p.msg="incomplete literal/length tree",h=Z_DATA_ERROR),h;this.initWorkArea(288);h=this.huft_build(c,a,b,0,cpdist,cpdext,l,e,m,this.hn,this.v);return h!=Z_OK||0==e[0]&&257<a?(h==Z_DATA_ERROR?p.msg="oversubscribed distance tree":h==
Z_BUF_ERROR?(p.msg="incomplete distance tree",h=Z_DATA_ERROR):h!=Z_MEM_ERROR&&(p.msg="empty distance tree with lengths",h=Z_DATA_ERROR),h):Z_OK};function inflate_trees_fixed(a,b,c,d,e){a[0]=fixed_bl;b[0]=fixed_bd;c[0]=fixed_tl;d[0]=fixed_td;return Z_OK}
InfTree.prototype.initWorkArea=function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),this.c=new Int32Array(BMAX+1),this.r=new Int32Array(3),this.u=new Int32Array(BMAX),this.x=new Int32Array(BMAX+1));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;b<BMAX+1;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;arrayCopy(this.c,0,this.u,0,BMAX);arrayCopy(this.c,0,this.x,0,BMAX+1)};
var testArray=new Uint8Array(1),hasSubarray="function"===typeof testArray.subarray,hasSlice=!1;function arrayCopy(a,b,c,d,e){if(0!=e){if(!a)throw"Undef src";if(!c)throw"Undef dest";0==b&&e==a.length?arrayCopy_fast(a,c,d):hasSubarray?arrayCopy_fast(a.subarray(b,b+e),c,d):1==a.BYTES_PER_ELEMENT&&100<e?arrayCopy_fast(new Uint8Array(a.buffer,a.byteOffset+b,e),c,d):arrayCopy_slow(a,b,c,d,e)}}function arrayCopy_slow(a,b,c,d,e){for(var h=0;h<e;++h)c[d+h]=a[b+h]}
function arrayCopy_fast(a,b,c){b.set(a,c)}var ADLER_BASE=65521,ADLER_NMAX=5552;
function adler32(a,b,c,d){if(null==b)return 1;var e=a&65535;a=a>>16&65535;for(var h;0<d;){h=d<ADLER_NMAX?d:ADLER_NMAX;for(d-=h;16<=h;)e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,h-=16;if(0!=h){do e+=b[c++]&255,a+=e;while(0!=--h)}e%=ADLER_BASE;
a%=ADLER_BASE}return a<<16|e}
function jszlib_inflate_buffer(a,b,c,d){a=b?new Uint8Array(a,b,c):new Uint8Array(a);c=new ZStream;c.inflateInit(DEF_WBITS,!0);c.next_in=a;c.next_in_index=0;c.avail_in=a.length;a=[];for(var e=0;;){var h=new Uint8Array(32E3);c.next_out=h;c.next_out_index=0;c.avail_out=h.length;var l=c.inflate(Z_NO_FLUSH);if(l!=Z_OK&&l!=Z_STREAM_END)throw c.msg;if(0!=c.avail_out){var m=new Uint8Array(h.length-c.avail_out);arrayCopy(h,0,m,0,h.length-c.avail_out);h=m}a.push(h);e+=h.length;if(l==Z_STREAM_END)break}d&&(d[0]=
(b||0)+c.next_in_index);if(1==a.length)return a[0].buffer;b=new Uint8Array(e);for(c=d=0;c<a.length;++c)e=a[c],arrayCopy(e,0,b,d,e.length),d+=e.length;return b.buffer}
(function(){function a(){s.call(document.querySelectorAll("input[type=range]"),c);(new MutationObserver(function(a){a.forEach(function(a){a.addedNodes&&s.call(a.addedNodes,function(a){b(a);a.childElementCount&&s.call(a.querySelectorAll("input"),b)})})})).observe(document,{childList:!0,subtree:!0})}function b(a){"input"==a.localName&&"range"!=a.type&&"range"==a.getAttribute("type")&&c(a)}function c(a){function b(a){var c=(parseFloat(getComputedStyle(this,0).width)-p.width)/T;c&&(N+=(a.clientX-L)/c,
L=a.clientX,C=!0,this.value=N)}function c(){this.removeEventListener("mousemove",b,!0);this.removeEventListener("mouseup",c,!0)}function e(){J||(this.style.boxShadow=m?"inset 0 0 20px rgba(0,127,255,.1), 0 0 1px rgba(0,127,255,.4)":"0 0 0 2px #fb0")}function h(a){return!isNaN(a)&&+a==parseFloat(a)}function s(){K=h(a.min)?+a.min:0;O=h(a.max)?+a.max:100;O<K&&(O=100<K?K:100);Q=h(a.step)&&0<a.step?+a.step:1;T=O-K;F(!0)}function F(b){D||G||(H=a.getAttribute("value"));h(H)||(H=(K+O)/2);H=Math.round((H-
K)/Q)*Q+K;H<K?H=K:H>O&&(H=K+~~(T/Q)*Q);C&&H!=I&&a.dispatchEvent(v);C=!1;if(b||H!=I)I=H,d(a,{background:"-moz-element(#__sliderthumb__) "+(T?100*((H-K)/T):0)+"% no-repeat, "+q})}var D,G,C,J,I,N,L,K,O,Q,T,H=a.value;l||(l=document.body.appendChild(document.createElement("hr")),d(l,{"-moz-appearance":m?"scale-horizontal":"scalethumb-horizontal",display:"block",visibility:"visible",opacity:1,position:"fixed",top:"-999999px"}),document.mozSetImageElement("__sliderthumb__",l));var M=function(){return""+
H};a.__defineGetter__("value",M);a.__defineSetter__("value",function U(b){H=""+b;D=!0;F();delete a.value;a.value=H;a.__defineGetter__("value",M);a.__defineSetter__("value",U)});a.__defineGetter__("type",function(){return"range"});["min","max","step"].forEach(function(b){a.hasAttribute(b)&&(G=!0);a.__defineGetter__(b,function(){return this.hasAttribute(b)?this.getAttribute(b):""});a.__defineSetter__(b,function(a){null===a?this.removeAttribute(b):this.setAttribute(b,a)})});a.readOnly=!0;d(a,r);s();
(new MutationObserver(function(b){b.forEach(function(b){"value"!=b.attributeName?(s(),G=!0):D||(H=a.getAttribute("value"),F())})})).observe(a,t);a.addEventListener("mousedown",function(a){J=!0;setTimeout(function(){J=!1},0);if(!a.button&&T){var d=(parseFloat(getComputedStyle(this,0).width)-p.width)/T;if(d){var e=a.clientX-this.getBoundingClientRect().left-p.width/2-(H-K)*d;Math.abs(e)>p.radius&&(C=!0,this.value-=-e/d);N=H;L=a.clientX;this.addEventListener("mousemove",b,!0);this.addEventListener("mouseup",
c,!0)}}},!0);a.addEventListener("keydown",function(a){36<a.keyCode&&41>a.keyCode&&(e.call(this),C=!0,this.value=H+(38==a.keyCode||39==a.keyCode?Q:-Q))},!0);a.addEventListener("focus",e,!0);a.addEventListener("blur",function(){this.style.boxShadow=""},!0)}function d(a,b){for(var c in b)a.style.setProperty(c,b[c],"important")}var e=document.createElement("input");try{if(e.type="range","range"==e.type)return}catch(h){return}e.style.background="linear-gradient(red, red)";if(e.style.backgroundImage&&"MozAppearance"in
e.style&&document.mozSetImageElement&&this.MutationObserver){var l,m="MacIntel"==navigator.platform,p={radius:m?9:6,width:m?22:12,height:m?16:20},q="linear-gradient(transparent "+(m?"6px, #999 6px, #999 7px, #ccc 8px, #bbb 9px, #bbb 10px, transparent 10px":"9px, #999 9px, #bbb 10px, #fff 11px, transparent 11px")+", transparent)",r={"min-width":p.width+"px","min-height":p.height+"px","max-height":p.height+"px",padding:"0 0 "+(m?"2px":"1px"),border:0,"border-radius":0,cursor:"default","text-indent":"-999999px"},
t={attributes:!0,attributeFilter:["min","max","step","value"]},s=Array.prototype.forEach,v=document.createEvent("HTMLEvents");v.initEvent("change",!0,!1);"loading"==document.readyState?document.addEventListener("DOMContentLoaded",a,!0):a()}})();
