<!doctype html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/bootstrap-datetimepicker.min.css" rel="stylesheet">
        <link href="../css/jquery-ui-1.9.2.custom.min.css" rel="stylesheet">
        <link href="../css/select2.css" rel="stylesheet">
        <link href="../css/iThing-min.css" rel="stylesheet">
        <link href="../css/molgenis-controls.css" rel="stylesheet">
        <link href="../css/molgenis.css" rel="stylesheet">
        <script src="../js/jquery-2.1.1.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script src="../js/jquery-ui-1.9.2.custom.min.js"></script>
        <script src="../js/moment-with-locales.min.js"></script>
        <script src="../js/bootstrap-datetimepicker.min.js"></script>
        <script src="../js/handlebars.min.js"></script>
        <script src="../js/select2.min.js"></script>
        <script src="../js/jQEditRangeSlider-min.js"></script>        
        <script src="../js/molgenis.js"></script>
        <script src="../js/molgenis-noreact-control.js"></script>
        <script src="../js/molgenis-noreact-filter.js"></script>
    </head>
    <body>
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-6">
					<div role="tabpanel">
						<!-- Nav tabs -->
						<ul class="nav nav-tabs" role="tablist">
							<li role="presentation" class="active"><a href="#novalue"
								aria-controls="home" role="tab" data-toggle="tab">No Value</a></li>
							<li role="presentation"><a href="#values"
								aria-controls="profile" role="tab" data-toggle="tab">Values</a></li>
						</ul>
	
						<!-- Tab panes -->
						<div class="tab-content">
							<div role="tabpanel" class="tab-pane active" id="novalue">
								<div id="input-container"></div>
							</div>
							<div role="tabpanel" class="tab-pane" id="values">
                                <div id="value-input-container"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-6">
					<h1 id="query-result-header"></h1>
					<span id="query-result" style="white-space: pre;"></span>
				</div>
			</div>
		</div>
		<script id="attr-filter-form-template" type="text/x-handlebars-template">
        <form class="form-horizontal">
	        <div class="form-group">
	            <label for="something" class="col-md-4 control-label">{{name}}: {{type}}</label>
	            <div class="col-md-8" id="{{name}}{{type}}-filter-container">
	            </div>
	        </div>
        </form>
        </script>
	    <script>
	    $(function() {
	    	var template = Handlebars.compile($("#attr-filter-form-template").html());
	    	
	    	var query = {
	    		'xdate': JSON.parse('{"operator":"NESTED","nestedRules":[{"field":"xdate","operator":"GREATER_EQUAL","value":"2015-01-21"},{"operator":"OR"},{"field":"xdate","operator":"LESS_EQUAL","value":"2015-01-22"},{"operator":"OR"},{"operator":"NESTED","nestedRules":[{"field":"xdate","operator":"GREATER_EQUAL","value":"2015-01-23"},{"operator":"AND"},{"field":"xdate","operator":"LOWER_EQUAL","value":"2015-01-24"}]}]}')
	    	}
	    	$.get('/api/v1/org_molgenis_test_TypeTest/meta?expand=attributes').done(function(meta) {
	    		var $container = $('#input-container');
	    		for(var key in meta.attributes) {
	    			var attr = meta.attributes[key];
	    			if(attr.name === 'id') continue;
	    			
	    		    var type = 'x';
	    		    $container.append(template({
	    		    	name: attr.name,
	    		    	type: type
	    		    }));
	    		    try {
		    		    molgenis.filters.create(attr, {
	                        'onQueryChange' : function(q) {
	                            $('#query-result-header').html('Filter query: ');
	                        	$('#query-result').html(JSON.stringify(q, null, '\t'));
	                        }
	                    }, $('#' + attr.name + type + '-filter-container'));
	    		    } catch(err) {
	    		    console.log(err);
	    		    }
	    		}
	    		
	    		var $valueContainer = $('#value-input-container');
	    		for(var key in meta.attributes) {
                    var attr = meta.attributes[key];
                    if(attr.name === 'id') continue;
                    
                    var type = 'x';
                    $valueContainer.append(template({
                        name: attr.name,
                        type: type
                    }));
                    //try {
                        molgenis.filters.create(attr, {
                            'onQueryChange' : function(q) {
                                $('#query-result-header').html('Filter query: ');
                                $('#query-result').html(JSON.stringify(q, null, '\t'));
                            }
                        }, $('#' + attr.name + type + '-value-filter-container'));
                    //} catch(err) {
                        //console.log(err);
                    //}
                }
	    	});	
		});
		</script>
	</body>
</html>